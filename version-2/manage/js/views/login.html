<login>

  <div id="authenticate">
    <form class="login-form" onsubmit={ submit }>
      <div class="form-group">
        <div class="input-group">
          <span class="input-group-addon"><span class="icon icon-envelope"></span></span>
          <input type="email" id="email" name="email" class="form-control" placeholder="Email" required>
        </div>
      </div>
      <div class="form-group">
        <div class="input-group">
          <span class="input-group-addon"><span class="icon icon-lock"></span></span>
          <input type="password" id="password" name="password" class="form-control" placeholder="Password" required>
        </div>
      </div>
      <div class="checkbox">
        <label>
          <input id="remember" type="checkbox" checked> Remember me
        </label>
      </div>
      <div class="row">
        <button class="btn btn-primary col-sm-6 col-sm-offset-3">Log In</button>
      </div>
    </form>
  </div>

  <script>
    _.log('Login:init()')
    var self = this,
      uri = location.host + location.pathname

    submit(e) {
      var data = {
        email: self.email.value,
        password: self.password.value
      }
      _.log('login:auth() ', data)
      _.loader()      
      api.auth(data, function() {
        if (self.remember.checked) {          
          localStorage[uri] = JSON.stringify(data)
        }
        _.loader(true)
        self.parent.update()        
        riot.route(self.parent.afterAuth || 'dashboard')
        afterAuth = null      
      })
    }

    self.on("mount", function() {
      if (!localStorage[uri]) return
      var data = JSON.parse(localStorage[uri])
      self.email.value = data.email
      self.password.value = data.password
      self.submit()      
    })

    _.loader(true)
    riot.route('dashboard')
  </script>
</login>