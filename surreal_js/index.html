<!DOCTYPE html>
<html lang="ru-RU">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  margin: 0;
  padding: 0;
  border: 0;
  outline: 0;
  font-size: 100%;
  vertical-align: baseline;
  background: transparent
}
body {
  line-height: 1.4;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
menu,
nav,
section {
  display: block
}
nav ul {
  list-style: none
}
blockquote,
q {
  quotes: none
}
blockquote:before,
blockquote:after,
q:before,
q:after {
  content: none
}
a {
  margin: 0;
  padding: 0;
  font-size: 100%;
  vertical-align: baseline;
  background: transparent
}
ins {
  background-color: #ff9;
  color: #000;
  text-decoration: none
}
mark {
  background-color: #ff9;
  color: #000;
  font-style: italic;
  font-weight: 700
}
del {
  text-decoration: line-through
}
abbr[title],
dfn[title] {
  border-bottom: 1px dotted;
  cursor: help
}
table {
  border-collapse: collapse;
  border-spacing: 0
}
hr {
  display: block;
  height: 1px;
  border: 0;
  margin: 1em 0;
  padding: 0
}
input,
select,
td {
  vertical-align: middle
}
,
td {
  margin: 0;
  padding: 0;
  border: 0;
  outline: 0;
  font-size: 100%
}
body {
  margin: 0;
  padding: 0;
  font-family: Verdana, sans-serif
}
*,
body {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  -webkit-focus-ring-color: rgba(0, 0, 0, 0);
  outline: 0;
  -webkit-text-size-adjust: none
}
input,
textarea {
  -moz-user-select: text;
  -o-user-select: text;
  -khtml-user-select: text;
  -webkit-user-select: text;
  user-select: text;
  resize: none
}
img {
  border: 0;
  vertical-align: top
}
p {
  -moz-hyphens: auto;
  -webkit-hyphens: auto;
  -ms-hyphens: auto;
  hyphens: auto
}
.hidden {
  display: none!important
}
.visibility {
  visibility: hidden
}
.table {
  display: table;
  margin: 0 auto;
  width: 100%;
  table-layout: fixed
}
.tr {
  display: table-row;
  height: 100%
}
.td {
  display: table-cell;
  vertical-align: middle;
  text-align: center;
  height: 100%
}
.animation {
  -webkit-transition: background-color .7s, color 1s, opacity .5s;
  -ms-transition: background-color .7s, color 1s, opacity .5s;
  -o-transition: background-color .7s, color 1s, opacity .5s;
  -moz-transition: background-color .7s, color 1s, opacity .5s;
  transition: background-color .7s, color 1s, opacity .5s
}
.no_script_message {
  display: block;
  text-align: center;
  font-size: 1em;
  line-height: 1.3;
  color: #000;
  background: #DFDFDF;
  border-bottom: 1px solid #AAAAAB
}
.no_script_message {
  font-size: 12px
}
}
.button_scroll_up {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  opacity: 0;
  width: 7em;
  text-align: center;
  cursor: pointer;
  background: rgba(239, 246, 255, .6);
  -webkit-transition: opacity .7s;
  -ms-transition: opacity .7s;
  -o-transition: opacity .7s;
  -moz-transition: opacity .7s;
  transition: opacity .7s
}
.button_scroll_up:hover {
  opacity: 1;
  box-shadow: 1px 1px 5px #999
}
.button_scroll_up__hidden {
  display: none
}
@media screen and (min-width: 400px) and (max-width: 900px) {
  .button_scroll_up {
    width: 4em
  }
}
@media screen and (max-width: 399px) {
  .button_scroll_up {
    display: none
  }
}
.article {
  display: block;
  width: 100%;
  max-width: 45em;
  margin: 2em auto;
  overflow: hidden
}
.article__header,
.article__subtitle {
  font-size: 2em;
  font-weight: 400;
  color: #0ba5b7
}
.article__header {
  font-size: 5em;
  line-height: .9;
  color: #000
}
.article__image_container {
  margin: 1em auto
}
.article__image {
  display: block;
  width: auto;
  max-width: 100%;
  margin: 0 auto .5em;
  vertical-align: top
}
.article__image_explanation {
  font-size: .9em;
  font-style: italic;
  text-align: center;
  color: #444
}
.article,
.article__code {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box
}
.article__link,
.article__paragraph,
.article__list_item,
.article__enumerate_item {
  font-weight: 400;
  line-height: 1.3;
  text-align: left;
  color: #000
}
.article__paragraph {
  font-size: 1em;
  margin: .5em 0;
  text-indent: 2em
}
.article__list_item {
  margin-left: 4em;
  margin-bottom: 4px;
  list-style-type: none
}
.article__list_item:before {
  margin-right: 1em;
  margin-left: -2em;
  content: '-'
}
.article__enumerate_item {
  margin-left: 2.5em;
  margin-bottom: 4px
}
.article__link {
  text-decoration: underline;
  color: #00f
}
.article__link:hover {
  text-decoration: none
}
.article__list,
.article__enumerate {
  margin-top: .5em
}
.article__selection {
  font-family: CondensedLight, Verdana, sans-serif;
  font-size: 1.5em;
  display: block;
  margin-top: .5em;
  text-align: center;
  color: #000
}
.article__code {
  font-family: Courier;
  font-size: 1em;
  display: block;
  overflow: hidden;
  width: 100%;
  margin: .5em auto;
  padding: 5px;
  line-height: 1.3;
  border: 1px solid #e1e1e8;
  border-radius: 5px;
  background-color: #f7f7f9
}
.article .article__comment {
  font-size: .8em;
  margin-top: 2em;
  margin-bottom: .5em;
  text-indent: 0;
  color: #444
}
@media screen and (max-width: 850px) {
  .article {
    padding: 0 .5em
  }
  .article__header {
    font-size: 2em
  }
  .article__link,
  .article__paragraph,
  .article__list_item,
  .article__enumerate_item,
  .article__code {
    font-size: 15px;
  }
  .article__code {
    overflow-x: scroll
  }
}
@media screen and (max-width: 400px) {
  .article__image {
    width: 100%;
    max-width: 15em
  }
  .article__selection {
    font-size: 1.2em;
    font-weight: 400
  }
  .article__list_item,
  .article__enumerate_item {
    margin-left: 2em
  }
}
.article__note {
  margin-top: 3em;
  margin-left: 2em;
  padding: 1em 2em;
  border-left: 1px solid #eee;
  background-color: #fafafa;
  overflow: hidden
}
.article__link_note,
.article__paragraph_note,
.article__list_item_note,
.article__enumerate_item_note {
  font-weight: 400;
  line-height: 1.3;
  text-align: left;
  font-style: italic;
  font-size: 12px;
  color: #666
}
.article__paragraph_note {
  margin: .5em 0;
  text-indent: 2em
}
.article__list_item_note {
  margin-left: 4em;
  margin-bottom: 4px;
  list-style-type: none
}
.article__list_item_note:before {
  margin-right: 1em;
  margin-left: -2em;
  content: "-"
}
.article__enumerate_item_note {
  margin-left: 2em;
  margin-bottom: 4px
}
.article__link_note {
  text-decoration: underline;
  color: #666
}
.article__link_note:hover {
  text-decoration: none
}
.article__list_note,
.article__enumerate_note {
  margin-top: .5em
}
@media screen and (max-width: 500px) {
  .article__note {
    margin-top: 1em;
    margin-left: 0;
    padding: 1em
  }
  .article__list_item_note,
  .article__enumerate_item_note {
    margin-left: 2em
  }
}
.list_of_contents__item {
  white-space: nowrap;
  padding: .5em;
  overflow: hidden;
  position: relative
}
.list_of_contents__position,
.list_of_contents__name,
.list_of_contents__point,
.list_of_contents__score {
  display: inline-block;
  position: relative;
  height: 1em;
  *height: 1.3em;
  vertical-align: top
}
.list_of_contents__position {
  text-align: right;
  padding-right: .5em
}
.list_of_contents__name {
  padding-right: .5em
}
.list_of_contents__point {
  position: absolute;
  top: .5em;
  left: 3em;
  right: .5em;
  width: 100%;
  height: 1em
}
.list_of_contents__score {
  position: absolute;
  top: .5em;
  right: 0;
  padding: 0 .5em
}
.list_of_contents__item {
  padding: 0 .5em .5em 0
}
.list_of_contents__point,
.list_of_contents__score {
  top: 0
}
.list_of_contents__position,
.list_of_contents__name,
.list_of_contents__point,
.list_of_contents__score {
  color: #333;
  border-bottom: 1px solid #fff
}
.list_of_contents__name,
.list_of_contents__score {
  background-color: #fff
}
.list_of_contents__name {
  color: #108DB9
}
.list_of_contents__point {
  background-image: url(images/list_of_contents.png);
  background-repeat: repeat-x;
  background-position: bottom left
}
.list_of_contents__position {
  width: 1.5em
}
.table_em {
  width: 100%
}
.table_em__tr,
.table_em__tr__blue,
.table_em__tr__red {
  -webkit-transition: background-color .5s;
  -ms-transition: background-color .5s;
  -o-transition: background-color .5s;
  -moz-transition: background-color .5s;
  transition: background-color .5s
}
.table_em__td_em,
.table_em__td_px,
.table_em__td_char,
.table_em__td_code,
.table_em__head_td_em,
.table_em__head_td_px {
  font-size: .8em;
  text-align: center;
  padding: .5em 0;
  border-bottom: 1px solid #AAA;
  border-right: 1px solid #DDD
}
.table_em__comment {
  color: #777
}
.table_em__td_px,
.table_em__head_td_px,
.table_em__td_code,
.table_em__head_td_code {
  border-right: 2px solid #999;
  background-color: #EEE
}
.table_em__head_td_em,
.table_em__head_td_px,
.table_em__head_td_char,
.table_em__head_td_code {
  color: #fff;
  background-color: #777
}
.table_em__td_px:last-child,
.table_em__head_td_px:last-child,
.table_em__td_code:last-child,
.table_em__head_td_code:last-child {
  border-right: 0
}
.table_em__tr {
  background-color: rgba(255, 255, 255, .9)
}
.table_em__tr__grey {
  color: #000;
  background: #DDD
}
.table_em__tr__blue {
  background: #E4F7FF
}
.table_em__tr__red {
  background: #FBC2C2
}
.table_em__tr:hover,
.table_em__tr__blue:hover,
.table_em__tr__red:hover {
  background: #CEFFC9
}
.table_em__td_char {
  width: 20%
}
.table_em__td_code {
  width: 5%
}
.report__container,
.report__footer {
  margin: 2em auto;
  display: block;
  width: 100%;
  max-width: 50em
}
.report__footer {
  border-top: 1px dotted #AAA;
  padding-top: 1em
}
.report__title {
  font-size: 2em;
  margin-bottom: .5em;
  font-weight: 400;
  color: #0ba5b7
}
.report__video {}.report__signature {
  text-align: right;
  color: #555;
  font-size: .8em;
  line-height: 1.5
}
.report__link {
  color: #00f;
  text-decoration: underline
}
.report__link:hover {
  text-decoration: none
}
.report__description {
  padding: .5em 0 0
}
.report__description_p {
  text-align: left;
  font-size: .8em;
  text-indent: 2em;
  line-height: 1.5;
  margin-bottom: 5px;
  color: #555
}
@media screen and (max-width: 500px) {
  .report__footer {
    border-top: 1px solid #AAA
  }
}
.title__container {
  margin: 1em auto;
  max-width: 45em
}
.title__item_header,
.title__item_subtitle {
  color: #00f;
  text-decoration: underline
}
.title__item_header:hover,
.title__item_subtitle:hover {
  text-decoration: none
}
.title__item_header {
  color: #000;
  margin-top: 1em
}
.title__item_subtitle {
  margin-left: 2em
}
.title__group_item {
  border-left: 1px solid #AAA;
  margin-left: 2.1em;
  margin-bottom: .5em
}
.title__group_item .list_of_contents__item:last-child {
  padding-bottom: 0;
  margin-bottom: .5em
}
.title__group_item .title__item_subtitle {
  margin-left: .5em
}
.article__paragraph_2ch {
  margin: .5em 0;
  font-weight: 400;
  line-height: 1.3;
  text-align: right;
  font-size: .9em;
  color: #999
}
.title__author {
  font-weight: 400;
  text-align: right;
  color: #777;
  font-size: 1em;
  margin-top: 1em
}
</style>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <link href="http://bakhirev.biz/book/images/favicon.ico" rel="shortcut icon" type="image/x-icon"><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="address=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><!--[if IE]><meta http-equiv="imagetoolbar" content="no"/><meta http-equiv="MSThemeCompatible" content="no"/><![endif]-->
    <title>Сюрреализм на JavaScript</title>
    <meta name="description" content="Книга о разработке игр и приложений на JavaScript. В книге встречается множество отсылок к авторам различных публикаций и экспертам frontend-разработки. Также затрагивается тема кросплатформенной разработки на JavaScript для различных устройств, XSS атаки, обфуская кода, и конвертирования HTML в EXE, HTA, CHM и т.п."><meta name="keywords" content="сюрреализм на JavaScript, DHTML, HTML5, CSS, html, script, учебник, книги, примеры, справочник, книга по javascript, игры html5, frontend, веб-разработка, фронтенд, разработка, создание игры, мини игры, скачать, 3d, конструктор игр, исходники, браузерная игра, CHM, HTA, EXE, APK, EPUB, FB2, читать, верстка html, gamedev, js, jquery, DOM, рендер, игры на CSS, архитектура, игровые движки, русский игровой движок"><meta name="author" content="Бахирев Алексей Михайлович"><meta name="copyright" content="(c) Бахирев Алексей Михайлович"><meta http-equiv="Reply-to" content="alexey-bakhirev@yandex.ru"><meta name="application-name" content="Сюрреализм на JavaScript"><meta name="msapplication-tooltip" content="Книга о разработке игр и приложений на JavaScript. В книге встречается множество отсылок к авторам различных публикаций и экспертам frontend-разработки. Также затрагивается тема кросплатформенной разработки на JavaScript для различных устройств, XSS атаки, обфуская кода, и конвертирования HTML в EXE, HTA, CHM и т.п."><meta property="og:title" content="Сюрреализм на JavaScript"><meta property="og:description" content="Книга о разработке игр и приложений на JavaScript. В книге встречается множество отсылок к авторам различных публикаций и экспертам frontend-разработки. Также затрагивается тема кросплатформенной разработки на JavaScript для различных устройств, XSS атаки, обфуская кода, и конвертирования HTML в EXE, HTA, CHM и т.п."><meta property="og:image" content="http://bakhirev.biz/book/images/icons/social/custom_icon_256.png"><meta property="og:site_name" content="Сюрреализм на JavaScript"><meta property="og:url" content="http://bakhirev.biz/book/index.html"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Сюрреализм на JavaScript"><meta name="twitter:description" content="Книга о разработке игр и приложений на JavaScript. Также затрагиваются темы XSS атак, обфускации кода, и конвертирования HTML в EXE, HTA, CHM и т.п."><meta name="twitter:creator" content="Бахирев Алексей Михайлович"><meta name="twitter:image:src" content="http://bakhirev.biz/book/images/icons/social/custom_icon_256.png"><meta name="twitter:domain" content="bakhirev.biz"><meta name="twitter:site" content="bakhirev.biz/book/index.html"><meta itemprop="name" content="Сюрреализм на JavaScript"><meta itemprop="description" content="Книга о разработке игр и приложений на JavaScript. В книге встречается множество отсылок к авторам различных публикаций и экспертам frontend-разработки. Также затрагивается тема кросплатформенной разработки на JavaScript для различных устройств, XSS атаки, обфуская кода, и конвертирования HTML в EXE, HTA, CHM и т.п."><meta itemprop="image" content="http://bakhirev.biz/book/images/icons/social/custom_icon_256.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="apple-touch-startup-image" href="http://bakhirev.biz/book/images/icons/apple/startup.png"><link rel="apple-touch-icon" href="http://bakhirev.biz/book/images/icons/apple/touch-icon-iphone.png"><link rel="apple-touch-icon" sizes="76x76" href="http://bakhirev.biz/book/images/icons/apple/touch-icon-ipad.png"><link rel="apple-touch-icon" sizes="120x120" href="http://bakhirev.biz/book/images/icons/apple/touch-icon-iphone-retina.png"><link rel="apple-touch-icon" sizes="152x152" href="http://bakhirev.biz/book/images/icons/apple/touch-icon-ipad-retina.png"><meta name="msapplication-window" content="width=400;height=300"><meta name="msapplication-TileColor" content="#990000"><meta name="msapplication-TileImage" content="images/icons/windows/custom_icon_144.png"><meta name="msapplication-square70x70logo" content="images/icons/windows/custom_icon_70.png"><meta name="msapplication-square150x150logo" content="images/icons/windows/custom_icon_150.png"><meta name="msapplication-square310x310logo" content="images/icons/windows/custom_icon_310.png"><meta name="msapplication-wide310x150logo" content="images/icons/windows/custom_icon_310x150.png"></script><script>﻿(function(a,i,l) {"use strict";a=["article","aside","audio","button","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","main","mark","menu","meter","nav","output","progress","section","source","summary","time","video","wbr"];for(i=0,l=a.length;i<l;i++) document.createElement(a[i]);})();</script></head><body><noscript class="no_script_message"> У вас отключен JavaScript. Сайт может отображаться некорректно. Рекомендуем включить JavaScript.</noscript><article class="article"><h1 class="article__header">Сюрреализм на JavaScript</h1><br><h2 class="title__author">Алексей Бахирев</h2></article><article class="article"><h2 class="article__subtitle">Содержание</h2><div class="title__container" id="title"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#SDPcG">Введение</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#quXvB">Архитектура игровых движков</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#mGpKD">История</a></span><span class="list_of_contents__score">1</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#bWexm">Архитектура</a></span><span class="list_of_contents__score">2</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#xlRhY">Стрельба</a></span><span class="list_of_contents__score">3</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#mJnBx">Мини-игры</a></span><span class="list_of_contents__score">4</span></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#fOJqD">Классы и фабрики</a></span><span class="list_of_contents__score">5</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#sHBui">Стандартизация интерфейсов</a></span><span class="list_of_contents__score">6</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#dhlXv">Как сохранить и загрузить объекты</a></span><span class="list_of_contents__score">7</span></div></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#sDoij">Разделение рендера</a></span><span class="list_of_contents__score">8</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#YmsPw">Реализация рендера в игровом движке StalinGrad</a></span><span class="list_of_contents__score">9</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#Tcsbr">Советы по организации рендера</a></span><span class="list_of_contents__score">10</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#Fpaci">Квадратный интерфейс</a></span><span class="list_of_contents__score">11</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#FHfUG">Рендер кривых</a></span><span class="list_of_contents__score">12</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#lGrdT">Работа со спрайтами</a></span><span class="list_of_contents__score">13</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#xXtMW">Кэширование и догрузка ресурсов камеры</a></span><span class="list_of_contents__score">14</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#gquZW">Реестр элементов</a></span><span class="list_of_contents__score">15</span></div></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#Uspja">Работа под нагрузкой</a></span><span class="list_of_contents__score">16</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#tNGYY">Сетка и динамические массивы</a></span><span class="list_of_contents__score">17</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#flVwH">Создание карты уровня</a></span><span class="list_of_contents__score">18</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#yXLOB">Рассинхронизация таймеров</a></span><span class="list_of_contents__score">19</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#OgsgS">Кроссплатформенная разработка</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#HlXqc">История</a></span><span class="list_of_contents__score">20</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#MTtwo">JS в CHM, HTA, EXE</a></span><span class="list_of_contents__score">21</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#URgCF">Разработка</a></span><span class="list_of_contents__score">22</span></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#StwTP">API устройств</a></span><span class="list_of_contents__score">23</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#yXtVc">Мобильные телефоны</a></span><span class="list_of_contents__score">24</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#EuFhX">Touch-экраны</a></span><span class="list_of_contents__score">25</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#fzdyp">Телевизоры</a></span><span class="list_of_contents__score">26</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#mHgGa">Портирование игры с браузера в TV</a></span><span class="list_of_contents__score">27</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#DMJuR">Клавиатура</a></span><span class="list_of_contents__score">28</span></div></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#HahOS">Синхронизация устройств</a></span><span class="list_of_contents__score">29</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#kTwws">Проблемы разработки под Android</a></span><span class="list_of_contents__score">30</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#mYmmk">Хэш-контроллеры</a></span><span class="list_of_contents__score">31</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#WWUhw">Мелкие оптимизации и костыли</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#RHwvY">Уменьшение вложенности</a></span><span class="list_of_contents__score">32</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#KWrmn">Текстовые вставки в код</a></span><span class="list_of_contents__score">33</span></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#wBSrS">Ресайз</a></span><span class="list_of_contents__score">34</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#LDIeg">Зачем использовать EM вместо PX?</a></span><span class="list_of_contents__score">35</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#oInCp">Вставка CSS через JS</a></span><span class="list_of_contents__score">36</span></div></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#cUsms">Конечные автоматы на CSS</a></span><span class="list_of_contents__score">37</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#VtPWv">Правила работы с DOM</a></span><span class="list_of_contents__score">38</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#huBkF">БЭМ</a></span><span class="list_of_contents__score">39</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#PywoZ">JS в PNG</a></span><span class="list_of_contents__score">40</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#xNpsl">Сжатие кода</a></span><span class="list_of_contents__score">41</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#AGTsQ">Защита от сервера</a></span><span class="list_of_contents__score">42</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#UHghQ">Данные через CSS</a></span><span class="list_of_contents__score">43</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#UdIEK">Игра в 0 строк кода</a></span><span class="list_of_contents__score">44</span></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#OwNLh">JSON запросов и параметров</a></span><span class="list_of_contents__score">45</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#rphJw">Модуль colors и консоль</a></span><span class="list_of_contents__score">46</span></div></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#xRDLv">Теги и костыли, о которых забывают</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#BmMnK">СЕО-теги</a></span><span class="list_of_contents__score">47</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#EGiRK">Теги в head</a></span><span class="list_of_contents__score">48</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#hAiHK">Теги полей ввода, ссылки, таблицы</a></span><span class="list_of_contents__score">49</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#WsdiU">Хаки для IE</a></span><span class="list_of_contents__score">50</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#vrsiZ">Верстка писем</a></span><span class="list_of_contents__score">51</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#csVAq">XSS, CSRF и т.п.</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#nzZQP">XSS</a></span><span class="list_of_contents__score">52</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#iEVNh">Обфускация</a></span><span class="list_of_contents__score">53</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#IDSRz">CSRF</a></span><span class="list_of_contents__score">54</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#EEbxO">DDOS</a></span><span class="list_of_contents__score">55</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#RWgrF">Сlickjacking</a></span><span class="list_of_contents__score">56</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#dcbzy">Клавиатурные шпионы</a></span><span class="list_of_contents__score">57</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#VVEQQ">Какие уязвимости стоит искать</a></span><span class="list_of_contents__score">58</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#APhKz">Пре-продакшн</a></span><span class="list_of_contents__score"></span></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#MmlJN">Логика локализации приложения</a></span><span class="list_of_contents__score">59</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#HIxNQ">Плохая логика локализации</a></span><span class="list_of_contents__score">60</span></div></div><div class="title__group_item"><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#ApVdY">Классическая сборка</a></span><span class="list_of_contents__score">61</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#hqulR">Заморозка и инкрементальные обновления</a></span><span class="list_of_contents__score">62</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#ZbpsZ">Генерация ресурсов</a></span><span class="list_of_contents__score">63</span></div></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#mKZSM">Автотесты через API фреймворка</a></span><span class="list_of_contents__score">64</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#zsjho">Offtop</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#pXWEI">Сертификация JavaScript-разработчиков</a></span><span class="list_of_contents__score">65</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#YnDrs">Собеседование JS-программистов</a></span><span class="list_of_contents__score">66</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#QysVn">Задача на выделение N комментариев</a></span><span class="list_of_contents__score">67</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#MQqRm">Задача на быстрый поиск</a></span><span class="list_of_contents__score">68</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#WklLM">Использованные источники</a></span><span class="list_of_contents__score">69</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#urBWa">Рекомендуемые материалы</a></span><span class="list_of_contents__score">70</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#CtAVH">Заключение</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_header" href="http://bakhirev.biz/book/#WnZJF">Приложение</a></span><span class="list_of_contents__score"></span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#oidLN">Формулы расчета столкновений</a></span><span class="list_of_contents__score">71</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#Vudxt">Вопросы на собеседовании</a></span><span class="list_of_contents__score">72</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#lLlKK">Ответы на вопросы</a></span><span class="list_of_contents__score">73</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#qWlyR">Таблица кодов кнопок клавиатуры</a></span><span class="list_of_contents__score">74</span></div><div class="list_of_contents__item"><span class="list_of_contents__point"></span><span class="list_of_contents__name"><a class="title__item_subtitle" href="http://bakhirev.biz/book/#hkZDx">Таблицы соответствия размеров в EM и PX</a></span><span class="list_of_contents__score">75</span></div></div></article>
<main id="main"><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="SDPcG"></a><h2 class="article__subtitle">Введение</h2><p class="article__paragraph">Эта книга рассчитана, в основном, на опытных веб-разработчиков, которые делают сайты не один год. В книге встречается множество отсылок к авторам различных публикаций и экспертам фронтенд-разработки. Многие темы описаны с расчетом на запас опыта и знаний у читателя.</p><p class="article__paragraph">Если вы читаете эту книгу в электронном виде на мобильном устройстве с маленьким дисплеем, возможно, многие иллюстрации и скриншоты будут в ненадлежащем качестве. В таком случае вам следует приобрести печатный экземпляр или найти электронную версию для просмотра на более широком экране.</p><p class="article__paragraph">Если вы собрали эту книгу из исходного JSON-файла — поздравляю! Если вы не знали, что книга есть в формате JSON и захотели её собрать — ссылку на файл можно найти в конце.</p><p class="article__paragraph">В любом проекте есть баги, а в любой книге — опечатки и ошибочные суждения. Помните об этом, т.к. и эта книга не является исключением из правил.</p><p class="article__paragraph">P.S.: Дизайн действительно «подозрительно похож» на журнал «Frontender Magazine» (<a href="http://frontender.info/" class="article__link">http://frontender.info/</a>).</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="quXvB"></a><h1 class="article__header">Архитектура игровых движков</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="mGpKD"></a><h2 class="article__subtitle">История</h2><p class="article__paragraph">В 1999 году веб только набирал обороты. С одной стороны, к этому времени уже окончилась «война браузеров» 1996-1998 годов, с другой — вакансия JavaScript разработчика выглядела довольно неперспективной. Но даже в то время было несколько фанатов JS, которые пробовали писать на нем игры. Их звали Masahiko Nitanda и Kazuhiro Moriyama. Эти два парня жили в Японии и делали просто восхитительные вещи на JavaScript`е. Они не только пытались копировать игры с Денди, но даже пытались создавать подобие 3D игр в браузере.</p><p class="article__paragraph">Напомню, что дело было в 1999 году, и самым передовым на тот момент считался Internet Explorer 6. Как же им это удавалось? Ну, во-первых, в основе любой системы, прежде всего, лежит архитектура. Именно архитектура и алгоритмы помогают создавать сложные вещи. Во-вторых, они проявили немалую смекалку, чтобы простыми методами, так или иначе, обойти те или иные ограничения платформы. Давайте разберем несколько их приемов.</p><b class="article__selection">JS Flanker</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты игры JS Flanker." data-url="images/history__1.jpg"><figcaption class="article__image_explanation">Рис. 1. Скриншоты игры JS Flanker.</figcaption></figure><p class="article__paragraph">В игре вы управляете самолетом и должны сбивать врагов. Битва идет на водной территории. Особенностью игры было вращение уровня горизонта в зависимости от маневра самолета.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Цветом выделены составные элементы интерфейса игры." data-url="images/history__2.jpg"><figcaption class="article__image_explanation">Рис. 2. Цветом выделены составные элементы интерфейса игры.</figcaption></figure><p class="article__paragraph">В то время не было ни CSS-трансформаций, ни элемента canvas. Для имитации вращения использовался набор картинок, четыре из которых были закрашены по диагонали. Растяжением и сжатием этих картинок можно  имитировать наклон линии горизонта на разный угол и создавать эффект свободного вращения.</p><b class="article__selection">JS Racing</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты игры JS Racing." data-url="images/history__4.jpg"><figcaption class="article__image_explanation">Рис. 3. Скриншоты игры JS Racing.</figcaption></figure><p class="article__paragraph">В игре вы управляете машиной и должны обогнать соперника. Соревнование проходит на различных уровнях. Особенностью игры была имитация 3D-движения по дороге.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Цветом выделены составные элементы интерфейса игры." data-url="images/history__5.jpg"><figcaption class="article__image_explanation">Рис. 4. Цветом выделены составные элементы интерфейса игры.</figcaption></figure><p class="article__paragraph">Для создания данного эффекта дорога сделана из набора картинок, которые растянуты по длине. Чем ближе картинка — тем больше она растянута, и наоборот — дальние картинки сжаты по длине. Эти картинки также постепенно смещаются влево или вправо, имитируя поворот дороги. То же самое касается и всех дополнительных объектов, начиная от соседних машин и заканчивая придорожными деревьями. Чем дальше объект, тем больше он сжат в размерах, чем ближе — тем больше растянут.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншот панели разработчика Internet Explorer при запущенной игре JS Racing. Вы можете видеть свойства элементов, которые постоянно меняются." data-url="images/history__6.jpg"><figcaption class="article__image_explanation">Рис. 5. Скриншот панели разработчика Internet Explorer при запущенной игре JS Racing. Вы можете видеть свойства элементов, которые постоянно меняются.</figcaption></figure><b class="article__selection">DiabloX</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты игры DiabloX." data-url="images/history__7.jpg"><figcaption class="article__image_explanation">Рис. 6. Скриншоты игры DiabloX.</figcaption></figure><p class="article__paragraph">В игре вы управляете космическим кораблем и должны уничтожать другие корабли. Особенностью игры является относительно большой мир (на самом деле очень маленький) и возможность свободно в нем перемещаться (на самом деле это довольно маленькая прямоугольная платформа).</p><p class="article__paragraph">Эффект перемещения по уровню создавался за счет того, что множество картинок меняло свое положение за счет абсолютного позиционирования.</p><p class="article__paragraph">Из этих примеров видно, что для создания элементарной анимации нам достаточно иметь возможность позиционировать и накладывать друг на друга картинки, а также сжимать и растягивать их. Довольно маленьких набор свойств, с точки зрения поддержки браузера, но довольно большие возможности, с точки зрения архитектуры.</p><p class="article__paragraph">Тем не менее, большинство разработчиков в то время ушло в разработку на Flash`е, который предоставлял гораздо более широкие возможности с точки зрения графики. Обратный же отток произошел в момент популяризации бренда HTML5 и появления тега canvas. С одной стороны, к этому моменту уже появилось достаточно качественной литературы, чтобы значительно повысить уровень среднестатистического разработчика. С другой — canvas предоставлял широкие возможности для портирования игр с других языков, т.к. его API аналогично «нормальным» языкам программирования. Разработчик теперь может не только не владеть «магией» работы с DOM, но и быть достаточно «модным», т.к. использует последние, самые «модные технологии».</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="bWexm"></a><h2 class="article__subtitle">Архитектура</h2><p class="article__paragraph">Если вы хотите узнать больше об архитектуре игр, вам следует обратиться к списку литературы в конце. В этой главе лишь вкратце будут представлены основные звенья архитектуры сложных игр. Кроме того, тут совсем не рассматриваются простые игры, в которых все решается набором из десятка функций.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Основные элементы ядра игрового движка: сцена, объекты, камера, дисплей, контроллер." data-url="images/game_architecture_1.jpg"><figcaption class="article__image_explanation">Рис. 7. Основные элементы ядра игрового движка: сцена, объекты, камера, дисплей, контроллер.</figcaption></figure><p class="article__paragraph">Минимальным набором для создания игры являются следующие модули:</p><ul class="article__list"><li class="article__list_item">Сцена. Объект сцены — это то самое место, где будут обитать объекты и происходить различные действия. Сцена — это мир вокруг нас. С ней тесно взаимодействует физический движок, который следит за объектами и обсчитывает их столкновения друг с другом.</li><li class="article__list_item">Фабрика объектов. Её задача — создавать множество объектов, с набором стандартных свойств, для того, чтобы их можно было поместить на сцену. Сюда входят механизмы, отвечающие как за создание персонажей, так и за объекты уровня: бочки, стены, предметы окружения.</li><li class="article__list_item">Камера и дисплей. Задача камеры — находить объекты, которые необходимо отрисовать. Задача дисплея — отрисовывать то, что видит камера. Иногда эти два объекта комбинируют в один, иногда — нет. Если у вас это два разных объекта, тогда перед вами открываются большие возможности с экспериментами по способу рендера картинки.</li><li class="article__list_item">Контроллер. Это тот инструмент, который позволит вам управлять объектами на сцене. Не все выносят его в отдельный модуль. Очень часто встречается архитектура, при которой у всех объектов есть какое-то API для управления ими напрямую.</li></ul><p class="article__paragraph">От реализации этих модулей зависит очень многое в игровом движке, т.к. это его основа. Хорошие движки также включают в себя множество второстепенных модулей: звук, AI, редактор карт и т.п. Ядро движка в данном случае представляет собой всего лишь тонкую прослойку, которая общается с модулями по какому-то стандартизированному API и упрощает пользователю работу с системой. При работе с хорошей системой программист не должен думать о том, как оно работает, обсчитывается, отрисовывается. Он должен лишь работать с игровыми объектами и сценарием игры.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше об архитектуре игровых движков и построении миров, основанных на плитке, можно у следующих авторов:</p><ul class="article__list_note"><li class="article__list_item_note">Секреты разработки игр на macromedia Flash MX<br>Flash MX 2004 Game Design. Jobe Makar<br>(если будете её покупать, ищите самые последние издания)<br><br></li><li class="article__list_item_note">Курс лекций «From Junior To Senior»<br>Андрея Короткова<br><a href="http://www.youtube.com/user/megadrone86/videos" class="article__link_note">http://www.youtube.com/user/megadrone86/videos</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="xlRhY"></a><h2 class="article__subtitle">Стрельба</h2><p class="article__paragraph">При разработке архитектуры вам, практически всегда, придется делать выбор между возможностью масштабировать и доделать в срок. Большинство вопросов носят исключительно философский характер, и над ними можно думать достаточно много времени, несмотря на то, что реализация будет укладываться в десяток строк кода. Рассмотрим ситуацию, когда один персонаж стреляет в другого.</p><b class="article__selection">Как задать полет пули?</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="В простом случае необходимо сделать выборку объектов пересекающихся с прямой, выходящей из ствола оружия." data-url="images/game_weapon_1.jpg"><figcaption class="article__image_explanation">Рис. 8. В простом случае необходимо сделать выборку объектов пересекающихся с прямой, выходящей из ствола оружия.</figcaption></figure><p class="article__paragraph">Мы можем взять вектор и моментально вычислить все объекты, которые с ним пересекаются. Это просто, быстро, но не интересно. Такой метод хорошо подойдет, если стрельба будет вестись из автомата и скорость пуль будет практически мгновенной. Совсем другое дело — по-честному создать объект пули и перепроверить все объекты, с которыми она столкнется. Для реализации нам потребуется написать больше кода, но зато мы сможем стрелять ракетами и наблюдать за тем, как они плавно и грациозно летят с одного конца карты на другой. А ещё мы можем заменить ракеты на кирпичи и мгновенно создать режим строительства в игре, чтобы игроки могли строить баррикады на поле боя. Но опять же — последний пункт даст хорошую масштабируемость, но вероятность сдать проект до дедлайна резко снизится. Кроме того, любой функционал содержит ошибки. Чем больше функционал — тем больше ошибок в нем будет.</p><b class="article__selection">Как умрет персонаж?</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="При сложной архитектуре создается объект снаряда, который обсчитывается отдельно. Кроме того, урон от попадания снаряда может наносить какой-либо дополнительный объект (например, взрывная волна)." data-url="images/game_weapon_2.jpg"><figcaption class="article__image_explanation">Рис. 9. При сложной архитектуре создается объект снаряда, который обсчитывается отдельно. Кроме того, урон от попадания снаряда может наносить какой-либо дополнительный объект (например, взрывная волна).</figcaption></figure><p class="article__paragraph">Персонаж сел в машину. Через секунду в лобовое стекло влетела ракета, и возник вопрос: «Кто и от чего умрет?». Выбрав простой способ, мы нанесем максимальный урон машине и уничтожим все объекты внутри. Но опять же — не интересно. В момент взрыва ракеты мы можем создать объект взрывной волны, который будет постепенно расширяться и наносить урон другим объектам. Также можно отдельно посчитать урон для машины и для пассажиров. Согласитесь, что если внутри сидит терминатор, то даже максимальный урон оставит его целым и невредимым. Опять же, создав объект взрывной волны — мы запросто можем на его основе создавать дымовые шашки, которые вместо урона, будут заполнять уровень дымом и понижать видимость.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="mJnBx"></a><h2 class="article__subtitle">Мини-игры</h2><p class="article__paragraph">Год назад мы делали браузерную онлайн-игру для мобильников про пиратов. У каждого игрока был свой корабль. Игровое поле — карта, размером 100 на 100 ячеек. Пользователи могли плавать между островами, выполнять различные квесты и вести торговлю. Также внутри игры было две мини-игры. Первая представляла собой казино. Игроки могли делать ставки и получать небольшой доход. Вторая — режим боя между кораблями. Игрок мог стрелять из пушки в соседние корабли. В мини-игре был доступен чат, в котором игроки могли обмениваться оскорблениями в адрес друг друга, а также в него выводилась информация о ходе боя. Выбор пушки и цели был сделан в виде двух каруселей, которые можно было проматывать туда-сюда.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты двух мини-игр в HTML-игре про пиратов." data-url="images/game_mini.jpg"><figcaption class="article__image_explanation">Рис. 10. Скриншоты двух мини-игр в HTML-игре про пиратов.</figcaption></figure><p class="article__paragraph">К сожалению, проект закрылся быстрее, чем вышел в продакшн. Было потрачено зря полгода разработки. Но самая главная ошибка была допущена при проектировании архитектуры и создании мини-игр. Если бы они имели строгое API и возможность быть использованными вне контекста основной игры — даже при закрытом проекте мы получили бы какой-то результат на выходе. Их можно было бы собрать в две отдельных сборки и продавать сами по себе. Поэтому, работая над основным проектом, всегда закладывайте возможность в случае краха максимально эффективно использовать имеющиеся наработки.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="fOJqD"></a><h2 class="article__subtitle">Классы и фабрики</h2><p class="article__paragraph">При создании игр возникает необходимость создания множества разнообразных объектов. Для достижения этой цели используется наследование на прототипах. Как выглядит классический пример класса при таком подходе:</p><pre class="article__code">function animal() {
  ...
}

animal.prototype.left = function() {
  ...
}

animal.prototype.right = function() {
  ...
}</pre><p class="article__paragraph">Этот и аналогичные примеры вы можете встретить во множестве книг, описывающих ООП на JavaScript. Но что делать, когда нам нужно получить много объектов разных классов? При подходе, описанном выше, нам нужно создать множество классов. В результате у нас могут возникнуть трудности с последующей поддержкой проекта, поиском багов и пониманием того, как все это работает. Выходом из данной ситуации является использование фабрики.</p><p class="article__paragraph">В С++ фабрика объектов может создавать только объекты определенного типа, которые используют единый интерфейс. Самым главным преимуществом данного паттерна в С++ является упрощение создания объектов различных классов, использующих единый интерфейс. В JavaScript мы можем отойти от этого ограничения и в одном месте получать объекты с абсолютно разным набором свойств и методов.</p><p class="article__paragraph">Для построения прозрачной структуры нашего приложения составим список всех свойств и список всех прототипов, разбитых на группы. Например:</p><pre class="article__code">var properties = {
  speed: {
    x: 0,
    y: 0
    limit: {
      x: 10,
      y: 10
    }
  },
  acceleration: {
    x: 0,
    y: 0
  },
  live: {
    health: 100,
    killing: 0,
    level: 0
  }
};

var prototypes = {
  left: function() {
    ...
  },
  right: function() {
    ...
  }
};</pre><p class="article__paragraph">Чтобы заказать какой-либо объект на фабрике, нам всего-навсего необходимо указать список свойств и список прототипов, которые должен унаследовать объект. Например:</p><pre class="article__code">var objectA = factory([
    "physics",  // Массив свойств
    "live"
  ], [
    "left"    // Массив прототипов
  ]);
var objectB = factory([
    "live",
    "acceleration"
  ], [
    "right"
  ]);</pre><p class="article__paragraph">Что же произойдет на фабрике? Примерно следующее:</p><pre class="article__code">var object = {};

// наследуем свойства
for(var name in properties) {
  object[name] = properties[name];
}

// наследуем методы
for(var method in prototypes) {
  object.prototype[method] = prototype[method];
}</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Сборка объекта на фабрике. В зависимости от списка конфигов, объект унаследует разный набор свойств и прототипов." data-url="images/game_class_create_1.jpg"><figcaption class="article__image_explanation">Рис. 11. Сборка объекта на фабрике. В зависимости от списка конфигов, объект унаследует разный набор свойств и прототипов.</figcaption></figure><p class="article__paragraph">На самом деле реальный механизм будет немного сложнее. Например, нужно будет перебрать свойства на наличие вложенных объектов, присвоить какие-то стандартные значения, проверить валидность входных данных, научиться динамически создавать, сохранять и доставать запрашиваемые классы, но основная суть не изменится.</p><p class="article__paragraph">Остается решить последнюю проблему — красиво описать свойства всех классов и объектов в простом виде. Это можно сделать, используя все те же списки. Рассмотрим это на примере класса блоков:</p><pre class="article__code">var classList = {
  ...
  block: {
  _properties: [   // Список общих свойств,
    "skin",      // которые наследуют все блоки
    "dimensions",  // данного класса
    "physics",
    "coordinates",
    "type"
  ],
  _prototypes: [],   // Список общих прототипов,
             // которые наследуют все блоки
             // данного класса
  _common: {     // Список значений по умолчанию
    _properties: {
      move: false  // Свойство move у всех блоков будет false
    }
  },
  floor: {       // Далее идет описание различных объектов класса
    roughness: 0.37  // и их индивидуальных свойств
  },
  gold: {
    roughness: 0.34
  },
  sand: {
    roughness: 0.44  // Вы можете видеть, что у разных блоков,
  },         // разная шероховатость поверхности
  water: {
    roughness: 0.25
  }
  }
};</pre><p class="article__paragraph">Имея подобный список классов и объектов, мы также можем автоматически создать API. Например:</p><pre class="article__code">block.gold();  // создать блок золота
block.sand();  // создать блок песка
block.water(); // создать блок воды</pre><p class="article__paragraph">Таким образом, мы получили фабрику, размер кода которой не меняется, вне зависимости от количества и разнообразия объектов в игре, и три списка типа JSON:</p><ul class="article__list"><li class="article__list_item">Список свойств</li><li class="article__list_item">Список методов</li><li class="article__list_item">Список классов и объектов этих классов</li></ul><p class="article__paragraph">Списки удобны тем, что их просто менять, просто покрывать документацией, а также при увеличении числа объектов у нас не увеличивается количество кода (т.к. списки — это конфиги). Получается, что, написав один раз код фабрики, мы можем создавать сотни разнообразных объектов, с прозрачной структурой, совершенно не путаясь в них.</p><p class="article__paragraph">Пример файла документации свойств:</p><pre class="article__code">var properties = {
  physics: {
    speed: {
      x: "Скорость по оси X",
      y: "Скорость по оси Y",
      limit: {
        x: "Предел скорости по оси X, который объект может развить самостоятельно.",
        y: "Предел скорости по оси Y, который объект может развить самостоятельно."
      }
    },
    acceleration: {
      x: "Постоянное ускорение по оси X. Сохраняется между тиками...",
      y: "Постоянное ускорение по оси Y. Сохраняется между тиками..."
    },
  },
  live: {
    health:  "Максимальное здоровье объекта.",
    killing: "Количество убийств, совершенных объектом.",
    level:   "Уровень прокачки объекта."
  }
};</pre><p class="article__paragraph">Кроме того, используя списки, легко создавать новые виды объектов. Для этого, всего-навсего, надо вызывать фабрику с разными параметрами. Например, у нас есть машина, и нам необходимо сделать из неё танк. Для этого мы можем добавить в описание машины пачку прототипов, отвечающих за оружие. Таким образом, получим некую машину с оружием, а по сути — танк.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример задания на сборку двух объектов: машины и танка. Первый аргумент — список свойств, второй — список прототипов, третий — класс и тип объекта. Объект машины легко расширяется до танка, унаследовав прототип оружия." data-url="images/game_class_create_2.jpg"><figcaption class="article__image_explanation">Рис. 12. Пример задания на сборку двух объектов: машины и танка. Первый аргумент — список свойств, второй — список прототипов, третий — класс и тип объекта. Объект машины легко расширяется до танка, унаследовав прототип оружия.</figcaption></figure><b class="article__selection">Как убедиться, что наша фабрика работает правильно?</b><p class="article__paragraph">Для этого нам необходимо создать несколько объектов, запустить дебагер и посмотреть адреса свойств и методов объектов в памяти.</p><ul class="article__list"><li class="article__list_item">Адреса всех свойств должны отличаться, т.к. они уникальны для каждого объекта.</li><li class="article__list_item">Адреса всех методов должны совпадать, т.к. методы общие у всех объектов.</li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="sHBui"></a><h2 class="article__subtitle">Стандартизация интерфейсов</h2><p class="article__paragraph">Стандартизация интерфейсов объектов помогает писать общие модули для работы с ними. Суть метода заключается в том, чтобы привести API всех объектов к некому общему стандартному виду, несмотря на их отличия между собой. Рассмотрим метод на примере.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Стандартизация API. Персонаж может обратиться к любому предмету, если названия методов у разных объектов совпадают." data-url="images/game_class_standart_1.jpg"><figcaption class="article__image_explanation">Рис. 13. Стандартизация API. Персонаж может обратиться к любому предмету, если названия методов у разных объектов совпадают.</figcaption></figure><b class="article__selection">Проблема</b><p class="article__paragraph">Есть некий игровой персонаж и мир вокруг него. Когда игрок зажимает кнопку «использовать», возможны как минимум две ситуации:</p><ul class="article__list"><li class="article__list_item">Персонаж находится около оружия. В этом случае он должен поместить оружие в рюкзак.</li><li class="article__list_item">Персонаж находится около транспорта. В этом случае он должен сесть за руль.</li></ul><b class="article__selection">Решение</b><ul class="article__list"><li class="article__list_item">При нажатии кнопки «использовать» мы ищем все объекты вблизи нашего персонажа.</li><li class="article__list_item">Далее мы начинаем перебирать объекты, начиная от самого ближнего, и проверять, есть ли у них метод use().</li><li class="article__list_item">Если предмет с таким методом найден, прокидываем туда нашего персонажа и завершаем поиск.</li></ul><p class="article__paragraph">Понятно, что метод use() у оружия и транспорта будет отличаться, но как реализовать это в момент наследования прототипов на фабрике?</p><p class="article__paragraph">Ответ очень простой. Необходимо составить список замены и перед присвоением имени метода проверить, нет ли его в списке. Например:</p><pre class="article__code">// некий список замены названий методов прототипов
var replaceList = {
  ...
  weapon: "use",
  transport: "use"
}

// кусок фабрики, который отвечает за наследование прототипов
for(var method in prototypes) {
  var name = replaceList[method] || method;
  object.prototype[name] = prototype[method];
}</pre><p class="article__paragraph">Таким образом, несмотря на то, что оружие наследовало прототип «weapon», а транспорт — «transport», в прототипах объектов будет всего один метод use(), за которым у каждого объекта будут скрываться какие-то свои функции. Такой вот полиморфизм.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="dhlXv"></a><h2 class="article__subtitle">Как сохранить и загрузить объекты</h2><p class="article__paragraph">Теперь, когда у нас есть большой мир с множеством разных объектов (представьте себе Minecraft), настало время решить следующую задачу — реализация функций «сохранить / загрузить».</p><p class="article__paragraph">На первый взгляд все просто. Т.к. у нас есть множество объектов, мы можем преобразовать их в строку (JSON.stringify), но тут есть две проблемы:</p><ul class="article__list"><li class="article__list_item">Объекты могут обладать множеством связей</li><li class="article__list_item">Цепочки прототипов будут потеряны</li></ul><p class="article__paragraph">Разберем решение каждой задачи по отдельности.</p><b class="article__selection">Запрет на хранение объектов</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Все объекты хранятся в одном месте. Система оперирует только их идентификаторами." data-url="images/game_class_save_1.jpg"><figcaption class="article__image_explanation">Рис. 14. Все объекты хранятся в одном месте. Система оперирует только их идентификаторами.</figcaption></figure><p class="article__paragraph">Суть метода заключается в том, что после создания объекта на фабрике ему будет присвоен некий уникальный ID и он должен попасть в единый реестр объектов. Задача единого реестра — хранить все объекты и по требованию выдавать их по ID. При этом любому модулю и подсистеме запрещается без лишней необходимости использовать объект и строго запрещено сохранять ссылку на него. Вся система оперирует исключительно ID и лишь в особых случаях запрашивает объекты. Это не только помогает устранить утечки памяти, но и позволяет легко разложить все объекты в строку, без переборов вложенности объектов друг в друга. Рассмотрим это на примере.</p><p class="article__paragraph">Человек садится в автобус. Автобус имеет массив пассажиров. По правилам, он должен добавить в массив пассажиров ID вошедшего человека. Если же в массив будет добавлен сам объект человека — мы получим излишнюю вложенность. Это создаст нам много проблем, начиная от мифических утечек памяти, заканчивая необходимостью перебора объектов в объектах при загрузке. Кроме того, если пассажир автобуса умрет по какой-либо причине в момент поездки, нам придётся извлекать труп. Если же мы храним только ID пассажира, при извлечении объектов мы увидим, что пассажир с таким ID больше не существует, и перейдем к следующей итерации.</p><p class="article__paragraph">Или другой пример, связанный с системой хранения вещей персонажа:</p><p class="article__paragraph">Марио берет монетку и кладет её в массив рюкзака. На самом деле Марио должен положить в свой рюкзак только ID монетки. Если он где-то будет её использовать, система запросит сам объект монетки из реестра, но она обязана будет удалить локальную ссылку на него сразу после завершения своих действий.</p><p class="article__paragraph">Также эта система помогает избежать багов при рендере. Например, когда мы по какой-то причине удаляем весь мир, а камера запрашивает какой-либо объект. В случае наличия реестра она поймет, что объекта больше не существует, и удалит все свои настройки, связанные с этим ID.</p><b class="article__selection">Восстановление цепочек прототипов</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Объект, восстановленный из строки, должен отправиться на фабрику, где вновь унаследует все прототипы по сохраненному списку." data-url="images/game_class_save_2.jpg"><figcaption class="article__image_explanation">Рис. 15. Объект, восстановленный из строки, должен отправиться на фабрику, где вновь унаследует все прототипы по сохраненному списку.</figcaption></figure><p class="article__paragraph">При переводе объекта в строку мы потеряем прототипы, которыми обладал объект. Поэтому перед преобразованием необходимо добавить объекту свойство prototype_list и перечислить в нем все прототипы, которыми обладал объект (притом сделать это необходимо ещё на фабрике, т.к. после у всех объектов будет типовой интерфейс, который ничего не сообщит об их истинной начинке).</p><p class="article__paragraph">Далее при операции загрузки мы будем вновь отправлять объекты на фабрику, но только уже в цех реставрации. Там объекты будут проходить только вторую часть работы — наследование прототипов по списку.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="sDoij"></a><h2 class="article__subtitle">Разделение рендера</h2><p class="article__paragraph">Делить код на отдельные модули — очень хорошая идея, которая отражена во множестве программных продуктов и практик программирования. Но в реальной жизни код большей части игр, с которыми мне приходилось сталкиваться, представлял собой единую простыню минимум в 500 строк, где все функции шли вперемешку. Проблем от такого подхода в разработке очень много, но мы рассмотрим только одну — «разделение рендера».</p><p class="article__paragraph">Если ваша игра имеет какой-то API, то вы можете реализовать рендер множеством различных методов. Это может быть как canvas, так и DOM, SVG, и даже ANSI-символы. Более того, в зависимости от платформы вы можете выбирать между тем или иным вариантом рендера. Таким образом, ваша игра будет более стабильна, и вы сможете охватить большее количество платформ. Для примера мы разберем работу рендера на примере одного игрового движка.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="YmsPw"></a><h2 class="article__subtitle">Реализация рендера в игровом движке StalinGrad</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Игровой мир и объект камеры (обозначен красной обводкой)." data-url="images/game_render_algorithm_0.jpg"><figcaption class="article__image_explanation">Рис. 16. Игровой мир и объект камеры (обозначен красной обводкой).</figcaption></figure><p class="article__paragraph">Основной рендер в движке реализован средствами DOM, т.к. DOM работает стабильно практически везде. Объект камеры перемещается по игровому миру и составляет список объектов, которые сталкиваются с ним. Далее этот список отправляется в другой модуль, который, собственно, и занимается отрисовкой персонажей. Объект экрана представляет собой «слоеный пирог» из нескольких DIV-элементов, наложенных друг на друга.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Дисплей можно представить в виде театральной сцены с несколькими слоями декораций на разном уровне." data-url="images/game_render_algorithm_1.jpg"><figcaption class="article__image_explanation">Рис. 17. Дисплей можно представить в виде театральной сцены с несколькими слоями декораций на разном уровне.</figcaption></figure><p class="article__paragraph">Самый дальний слой отвечает за смену дня и ночи. Задавая ему заливку синим или черным цветом, мы можем имитировать ход суток в игре. Кроме того, мы можем управлять оттенками и делать переходы плавными, создавая эффекты рассвета или заката.</p><p class="article__paragraph">Второй — отвечает за смену погоды. В ясный период он пустой. Если начинается дождь — элементу в background-image ставится соответствующий спрайт дождя и меняется по таймеру, создавая иллюзию ливня, снега или легкого ветерка.</p><p class="article__paragraph">Третий DIV — основной. Именно он отвечает за отрисовку игровых объектов. Стоит заметить, что его можно заменить на canvas, не трогая остальные части. Первыми на этот экран выводятся элементы окружения и заднего плана. Вторыми — игровые персонажи. В последнюю очередь накладываются специальные элементы уровня, которые должны отображаться на переднем плане. Таким образом, мы можем создавать потайные ходы, водопады, эффекты стекла (если будем ставить полупрозрачные спрайты).</p><p class="article__paragraph">Следующий DIV вновь отвечает за погодные явления. Это может быть как абсолютно новый экран, так и второй экран (в этом случае у него должен меняться z-index в зависимости от погоды). Создание нового погодного экрана поможет создать вам эффекты ветра, града и тумана, которые могут идти в комбинации с дождем или снегом.</p><p class="article__paragraph">Далее идет особый слой — трипы. Если нам необходимо наложить особый эффект (например, состояние алкогольного или наркотического опьянения персонажа), вы можете подготовить набор полупрозрачных спрайтов, аналогичных различным эффектам в Instagram. Практика использования CSS3-анимации показала, что она дает более плохой визуальный эффект. Но если вы используете рендер на canvas, у вас безусловно есть гораздо больший простор для создания различных эффектов трипа.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример различных эффектов, наложенных на дисплей." data-url="images/game_render_algorithm_2.jpg"><figcaption class="article__image_explanation">Рис. 18. Пример различных эффектов, наложенных на дисплей.</figcaption></figure><p class="article__paragraph">Последним по позиции, но не по значению, идет защитный экран. Его задача — блокировать все клики (особенно остро стоит проблема на мобильных устройствах) и случайные выделения (которые также блокируются набором CSS-свойств).</p><p class="article__paragraph">Каждый объект мира может быть отрисован как с помощью DIV-элемента, так и с помощью IMG. DIV-элемент является отличным решением для отрисовки больших стен, которые заливаются однообразной текстурой и не нуждаются в масштабировании графики. IMG-элементы нужны для отрисовки персонажей и единичных небольших блоков. Им можно задать любую картинку и не придется дополнительно следить за её масштабом. Кроме того, на очень старых устройствах, где не работает background-position, именно с помощью отдельных картинок персонажей и применения IMG-элементов можно создавать анимацию.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример работы рендера на DOM в Internet Explorer 7" data-url="images/game_render_algorithm_3.jpg"><figcaption class="article__image_explanation">Рис. 19. Пример работы рендера на DOM в Internet Explorer 7</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="Tcsbr"></a><h2 class="article__subtitle">Советы по организации рендера</h2><b class="article__selection">Инвертируйте координату по оси Y</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Думать в перевернутых координатах трудно и бессмысленно." data-url="images/game_render_recommendations_2.jpg"><figcaption class="article__image_explanation">Рис. 20. Думать в перевернутых координатах трудно и бессмысленно.</figcaption></figure><p class="article__paragraph">Практически все системы для вывода графики, практически во всех языках, приучают программистов считать сверху вниз, т.к. координата 0 по оси Y находится вверху. Чтобы не ломать себе мозг при создании игры, вы можете написать небольшую функцию, которая позволит делать инверсию координат автоматически. Тогда вы сможете спокойно думать и легко осознавать внутренние игровые процессы. К сожалению, в своей практике я неоднократно сталкивался с тем, что некоторые программисты предпочитают писать весь код игры в перевернутых координатах. Это создает большие трудности при попытке осмыслить их код и произвести рефакторинг.</p><b class="article__selection">Дисплей должен быть резиновым</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример работы дисплея в игровом движке StalinGrad." data-url="images/game_render_recommendations_1.jpg"><figcaption class="article__image_explanation">Рис. 21. Пример работы дисплея в игровом движке StalinGrad.</figcaption></figure><p class="article__paragraph">Т.к. мы не можем знать размер экрана пользователя, мы должны всегда делать рендер «резиной». В случае использования рендера на DOM вам стоит все размеры выводить в процентах относительно экрана. Это довольно легко сделать, написав небольшую функцию, которая будет конвертировать размеры объектов при рендере. Но, заменив строгие пиксели на проценты, вы получите хорошие перспективы к масштабируемости и переносу приложения на различные устройства.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="Fpaci"></a><h2 class="article__subtitle">Квадратный интерфейс</h2><p class="article__paragraph">Квадратный интерфейс очень хорошо вписывается в любой экран при любом положении и занимает максимально доступное для него место. С квадратом — вам не стоит думать о книжной или альбомной ориентации экрана.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты игр с квадратным интерфейсом" data-url="images/game_render_square_1.jpg"><figcaption class="article__image_explanation">Рис. 22. Скриншоты игр с квадратным интерфейсом</figcaption></figure><p class="article__paragraph">Т.к. нам необходимо занять 100% площади, а квадрат — это только часть, скорее всего вам придется пойти на некоторые уловки. Ниже представлены два варианта интерфейса. У нас есть квадратный центр, в котором разворачиваются события игры, и две полоски с элементами управления по бокам.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример того, как использовать 100% площади экрана при интерфейсе заданного формата." data-url="images/game_render_square_2.jpg"><figcaption class="article__image_explanation">Рис. 23. Пример того, как использовать 100% площади экрана при интерфейсе заданного формата.</figcaption></figure><p class="article__paragraph">Вы можете постоянно отслеживать соотношения сторон и выравнивать получившийся прямоугольник, но две черные полоски по бокам все равно будут выглядеть не очень презентабельно. Чтобы закрыть их, вы можете немного раздвинуть элементы, сместив пустоту к центральной части, и залить её фоном центральной части с небольшим затемнением. Несмотря на то, что это будут мертвые зоны и никаких действий в них происходить не будет, зрительно картина будет смотреться гораздо лучше. Кроме того, вы можете программным путем добавить какие-либо действия в боковые области, оставив для игры, по сути, только центральный квадрат.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример мертвых зон, которые не используются в игре и могут быть обрезаны при уменьшении экрана." data-url="images/game_render_square_3.jpg"><figcaption class="article__image_explanation">Рис. 24. Пример мертвых зон, которые не используются в игре и могут быть обрезаны при уменьшении экрана.</figcaption></figure><p class="article__paragraph">На примере выше вы можете видеть различные декорации, но ни персонаж игрока, ни боты никогда не покинут центральной части экрана. Это очень удобно, т.к. при книжной ориентации мы потеряем эти области, но, по сути, интерфейс игры не уменьшится.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="FHfUG"></a><h2 class="article__subtitle">Рендер кривых</h2><p class="article__paragraph">Побывав на нескольких конференциях по разработке на JavaScript, я неоднократно слушал доклады о фреймворке D3 и его применении в инфографике. Но про поддержку старых браузеров докладчики умалчивали. Два года назад мы столкнулись с проблемой вывода графиков при создании финансовых отчетов для наших азиатских партнеров. Дело в том, что у них стоял старый Internet Explorer, в котором даже использование SVG-графики было невозможно. Кроме того, год назад мы разрабатывали онлайн-игру для мобильников, в которой на игровом поле (оно было основано полностью на верстке) необходимо было рисовать траекторию кораблей. Т.к. мы поддерживали в том числе и очень старые телефоны, задача должна была быть решена только средствами DOM.</p><p class="article__paragraph">Мы создавали несколько IMG-элементов с абсолютным позиционированием относительно родительского элемента. Координаты высчитывались по формуле, и мы могли рисовать какие угодно линии. Возможно, это не всегда приемлемо, но, по крайней мере, такой подход решил проблему вывода траектории кораблей в игре и создания динамических графиков в финансовых онлайн-отчетах.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="При клике на карту скрипт считал траекторию и количество необходимых точек. После этого IMG-элементы добавлялись в контейнер и позиционировались." data-url="images/game_render_curve.jpg"><figcaption class="article__image_explanation">Рис. 25. При клике на карту скрипт считал траекторию и количество необходимых точек. После этого IMG-элементы добавлялись в контейнер и позиционировались.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="lGrdT"></a><h2 class="article__subtitle">Работа со спрайтами</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Общий вид HTML-игры «Кот-апокалипсис»" data-url="images/game_render_sprite_1.jpg"><figcaption class="article__image_explanation">Рис. 26. Общий вид HTML-игры «Кот-апокалипсис»</figcaption></figure><p class="article__paragraph">Как-то под Новый год один из партнеров прислал нам игру на HTML для размещения на сайте для мобильников. Т.к. игра была рассчитана только под один размер экрана (640х800), а у мобильников экраны разные, мне поставили задачу подготовить игру ещё для двух экранов. На первый взгляд игра была довольно простой. На поле с холмами появлялись разные плохие персонажи, по которым нужно было кликать, тем самым убивая их. Также был один положительный персонаж, по которому кликать было нельзя. Но игра таила пару сюрпризов.</p><b class="article__selection">Как не надо делать спрайты</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Спрайты персонажей HTML-игры «Кот-апокалипсис»" data-url="images/game_render_sprite_2.jpg"><figcaption class="article__image_explanation">Рис. 27. Спрайты персонажей HTML-игры «Кот-апокалипсис»</figcaption></figure><p class="article__paragraph">Первая проблема была в том, как были отрисованы персонажи. Это была большая PNG-лента, на которой вплотную были картинки разных котов, отличающихся размером и формой. Рендер был сделан через DOM. На DIV с помощью background-position натягивался спрайт нужного персонажа. Соответственно, когда дизайнеры прислали новые ресурсы с более мелкими спрайтами, координаты background-position перестали совпадать, и их нужно было переписать. Кроме того, т.к. персонажи были разного размера и склеены вплотную, нельзя было писать координаты, просто прибавляя какую-то величину для каждого персонажа. Приходилось в Paint`е мерить координаты и лишь потом переносить их в CSS. Это были совершенно случайные цифры, и их невозможно было автоматически рассчитать по какой-либо формуле.</p><p class="article__paragraph">Через месяц менеджеры приняли решение выпустить копию игры, но немного другой тематики. Дизайнеры прислали новые спрайты для разных экранов. К сожалению, новые персонажи по размерам абсолютно не совпадали со старыми, и вновь пришлось взять в руки Paint и калькулятор. На этот раз также увеличилось количество персонажей в игре. На замену графики ушло несколько дней.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Спрайты персонажей HTML-игры «Эротический огород»" data-url="images/game_render_sprite_3.jpg"><figcaption class="article__image_explanation">Рис. 28. Спрайты персонажей HTML-игры «Эротический огород»</figcaption></figure><p class="article__paragraph">Потом я узнал, что есть программы, которые самостоятельно склеивают картинки в спрайт и подставляют нужные координаты в CSS...</p><p class="article__paragraph">Если вам приходится использовать спрайты (например, чтобы увеличить скорость загрузки), то постарайтесь соблюсти ряд требований, которые могут значительно упростить поддержку продукта джуниорам и уменьшить количество багов:</p><ul class="article__list"><li class="article__list_item">Отведите всем картинкам одинаковую часть площади спрайта. Установите четкие размеры этой площади, чтобы можно было легко исправлять координаты персонажей. Например, если каждая новая картинка идет стабильно через 100px, то мы легко можем посчитать, что позиция шестой картинки будет начинаться с 600px.</li><li class="article__list_item">Оставляйте зазор минимум в 1px между картинками на спрайте, т.к. на мобильниках при применении CSS-анимации графика может немного поплыть и края спрайта будут либо размазаны, либо будет видна небольшая полоска от соседней картинки на спрайте.</li><li class="article__list_item">Растягивайте конечное изображение (background-size: 100% 100%), чтобы можно было просто подменить исходный спрайт и все объекты остались на своих местах и заняли все доступное им пространство.</li></ul><section class="article__note"><p class="article__paragraph_note">Внимание! По данной теме также есть альтернативное мнение. Спрайты уменьшают нагрузку на сервер, и количество конфигов на «живом» проекте, необходимых для хранения анимации, также значительно сокращается.</p></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="xXtMW"></a><h2 class="article__subtitle">Кэширование и догрузка ресурсов камеры</h2><p class="article__paragraph">Вне зависимости от того, каким способом мы осуществляем отрисовку мира, при онлайн-работе приложения мы можем поймать баг, связанный со скоростью загрузки ресурсов. Наиболее ярко выражена проблема, если мы делаем отрисовку версткой и для анимации персонажей подгружаем множество разных картинок. Суть в том, что спрайт может не успеть загрузиться до того, как его заменит следующий спрайт, или до того, как он перестанет быть нужен.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Ситуация, когда персонаж лишь частично вошел в край кадра и быстро вышел из зоны видимости." data-url="images/game_render_cache_1.jpg"><figcaption class="article__image_explanation">Рис. 29. Ситуация, когда персонаж лишь частично вошел в край кадра и быстро вышел из зоны видимости.</figcaption></figure><p class="article__paragraph">Например, мы меняем по кругу 10 картинок, притом через смену атрибута src у IMG. Если мы будем менять атрибут слишком быстро, картинки могут не успевать загружаться, и браузер будет бросать загрузку предыдущей картинки и начинать грузить следующую. Более того, если мы будем использовать отрисовку через так называемые CSS-спрайты (сдвиг фона через background-position), баг останется, просто станет редко воспроизводимым. Он будет появляться тогда, когда некий уникальный объект с богатой анимацией будет мелькать на краю экрана и быстро пропадать из поля видимости. Его изображение может быть удалено ещё до момента окончания загрузки спрайта. Та же самая проблема будет и на объекте canvas при плохой архитектуре. Притом это не является багом браузера, т.к. он делает все абсолютно логично. Если ресурс нужен — он его грузит, если не нужен — бросает загрузку и удаляет данные. Закэшировать требуемую картинку тоже невозможно, пока она хотя бы один раз не будет загружена полностью.</p><p class="article__paragraph">Во всех старых играх на JavaScript разработчики использовали предварительную загрузку картинок. Т.к. мы имеем очень много объектов, часть которых может вообще не понадобиться, то предварительная загрузка, для нашего случая, может быть не очень адекватна. Опять же в случае слабого интернет-канала лучше грузить ресурсы по мере их необходимости. В любом случае решение о предзагрузке остается на совести разработчика, а по функционалу мы добавим механизм догрузки спрайтов, чтобы получать спрайты, которые не успели загрузиться в отведенное им время.</p><b class="article__selection">Разберем схему</b><p class="article__paragraph">Камера запрашивает у реестра картинку с неким URL`ом. Модуль смотрит, есть ли у него эта картинка. Если есть — отдает её, если нет — ставит в очередь на загрузку. При первом вызове картинка также не успеет подгрузиться и не будет показана на экране, зато при следующем вызове она уже будет загружена. Кроме того, не будет 404`х ошибок и быстрой смены запрашиваемых ресурсов.</p><p class="article__paragraph">Ещё раз повторюсь — это не копирование функционала кэша браузера! Ресурсы не попадают в кэш браузера, если они не успели догрузиться, а скрипт уже запросил следующую пачку ресурсов.</p><p class="article__paragraph">Модуль догрузки основан на объекте вида:</p><pre class="article__code">{
  images_block_sand: new Image()
  ...
}</pre><p class="article__paragraph">Названия свойств в таком объекте генерируются по URL`у, а их значение — объект картинки с заданным атрибутом src.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="gquZW"></a><h2 class="article__subtitle">Реестр элементов</h2><p class="article__paragraph">Суть трюка в том, чтобы вместо удаления элемента — делать его невидимым и переиспользовать в будущем. Например, есть некая игра, в которой персонаж бежит по игровому миру. Рендер осуществляется версткой через DOM. Каждый N миллисекунд происходит:</p><ul class="article__list"><li class="article__list_item">Добавление новых элементов</li><li class="article__list_item">Обновление стилей старых элементов</li><li class="article__list_item">Удаление элементов, вышедших за пределы видимости</li></ul><p class="article__paragraph">Чтобы ускорить процесс отрисовки, мы храним ссылки на элементы и делаем проверку необходимости изменений, перед тем как обратиться к DOM. Но мы также можем убрать ещё одно ненужное действие.</p><p class="article__paragraph">Давайте рассмотрим жизненный путь типичного изображения кирпича на экране:</p><ul class="article__list"><li class="article__list_item">Создать DOM-элемент DIV (createElement)</li><li class="article__list_item">Вставить его в документ (appendChild)</li><li class="article__list_item">Задать ему класс и координаты</li><li class="article__list_item">Обновлять координаты по мере движения персонажа</li><li class="article__list_item">Удалить элемент (removeChild)</li></ul><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример работы рендера на DOM при переиспользовании элементов." data-url="images/game_render_register_1.jpg"><figcaption class="article__image_explanation">Рис. 30. Пример работы рендера на DOM при переиспользовании элементов.</figcaption></figure><p class="article__paragraph">Теперь вместо удаления элемента присвоим ему класс hidden, где:</p><pre class="article__code">.hidden {
  display: none
}</pre><p class="article__paragraph">В какой-то момент на экране появляется изображение другого кирпича, для которого также можно использовать DIV. Имея один скрытый DIV в запасе, мы можем переиспользовать его, начав наш алгоритм сразу с шага 3. Т.к. количество элементов при рендере игры обычно плавает в диапазоне от 20 до 50 штук, то такая оптимизация даст нам хороший прирост производительности.</p><p class="article__paragraph">Логика переиспользования DOM-элементов вынесена в отдельный модуль в игровом движке StalinGrad. Вы можете использовать его либо написать свой с аналогичным алгоритмом оптимизации. Также следует учесть, что родительский элемент, в рассматриваемой выше задаче, у всех используемых объектов был один и тот же. Если нам необходимо организовать работу модуля для двух независимых  дисплеев, то следует также передавать какой-либо ID родительского элемента. Это позволит модулю правильно отдавать дочерние элементы для повторного использования.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="Uspja"></a><h2 class="article__subtitle">Работа под нагрузкой</h2><p class="article__paragraph">Работа игры — это всегда работа под нагрузкой, т.к. постоянно приходится делать расчеты для физики и анимации за фиксированный короткий промежуток времени. По сути, код крутится в бесконечном цикле. Если мы не будем укладываться в отведенное нам время одной итерации, игра начнет подвисать, и пользователь не захочет в неё играть. Мало того, что JavaScript сам по себе медленный язык, так мы ещё и ограничены в быстродействии браузером клиента. Поэтому выбор оптимальных алгоритмов — для нас очень важен. Далее будет рассмотрен ряд методик, которые позволят быстрее обрабатывать столкновения, использовать меньше памяти и равномерно распределять пиковые нагрузки.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="tNGYY"></a><h2 class="article__subtitle">Сетка и динамические массивы</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример покрытия уровня сеткой." data-url="images/game_array_2.jpg"><figcaption class="article__image_explanation">Рис. 31. Пример покрытия уровня сеткой.</figcaption></figure><p class="article__paragraph">При разработке игры мы должны обсчитывать столкновения объектов. Т.к. объектов у нас может быть очень много, то было бы неплохо обсчитывать столкновение только с ближайшими объектами к заданному. Для этого разработчики игр применяют следующий алгоритм:</p><ul class="article__list"><li class="article__list_item">Задается большой двухмерный массив с определенным шагом.</li><li class="article__list_item">Все объекты на карте помещаются в этот массив. Координаты объектов позволяют посчитать индексы ячеек массива, в которых они должны расположиться.</li><li class="article__list_item">Когда нам необходимо проверить некий объект на столкновение с другими — мы берем только его соседей по ячейке.</li></ul><p class="article__paragraph">Таким образом, количество расчетов у нас может сократиться в разы. Но в JavaScript`е возникает другая проблема — создание массива.</p><p class="article__paragraph">Если у нас есть игровой мир размером 5000х5000 px (при условии, что персонажи размером примерно 25x25px) и мы выбрали шаг нашей ячейки равным 100px, тогда у нас получится двумерный массив 500x500 — это 25 000 ячеек. При создании такого массива браузер может зависнуть (на момент написания этого текста последний Chrome, столкнувшись с подобной задачей, зависал примерно на 2 секунды). Мы можем заставить пользователя ждать в начале игры, показав заставку с загрузкой уровня, либо сделать быстрый старт, изменив алгоритм.</p><p class="article__paragraph">Будем использовать пустой одномерный массив и создавать вложенные ячейки только в момент необходимости. По координатам и размерам объекта, а также шагу сетки, мы можем моментально вычислять индексы ячеек, в которые должен попадать объект. На каждой итерации у нас добавится лишний IF:</p><pre class="article__code">if(!grid[x][y]) {
  grid[x][y] = [];
}</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример создания сетки «на лету»." data-url="images/game_array_3.jpg"><figcaption class="article__image_explanation">Рис. 32. Пример создания сетки «на лету».</figcaption></figure><p class="article__paragraph">Но зато наша сетка будет создаваться постепенно с добавлением новых объектов в нее. Более того, т.к. на карте могут быть пустые места, в которых либо не будет объектов вообще, либо туда никогда не дойдет ни один из персонажей игры, получается, что мы не создадим часть сетки вообще.</p><p class="article__paragraph">Аналогичный выбор вам предстоит сделать, когда будете писать модуль рендера. С одной стороны, вы можете при загрузке уровня подгрузить спрайты всех персонажей наперед, с другой стороны — загружать спрайты по мере надобности. Если у вас большой мир, множество разнообразных объектов и высокая трудность прохождения самой игры — вполне вероятно, что большая часть спрайтов игроку не понадобится, т.к. его персонажа будут постоянно убивать и уровень будет постоянно перезапускаться.</p><p class="article__paragraph">При написании сложной архитектуры на JavaScript вам очень часто предстоит делать выбор между сильными тормозами в начале либо мелкими тормозами позднее. Выбор следует делать исключительно путем проб и ошибок. Для каждого продукта — он свой. Но если у вас небольшое приложение и мало ресурсов, тогда смело загружайте их при старте. Как правило, небольшая задержка на старте остается незамеченной пользователями благодаря анимированной заставке (сплеш-скрин).</p><section class="article__note"><p class="article__paragraph_note">Узнать больше о том, как делать сплеш-скрины средствами CSS, можно тут:</p><ul class="article__list_note"><li class="article__list_item_note">CSS Animation Tricks: State Jumping, Negative Delays, Animating Origin, and More<br>Zach Saucier<br><a href="http://css-tricks.com/css-animation-tricks/" class="article__link_note">http://css-tricks.com/css-animation-tricks/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="flVwH"></a><h2 class="article__subtitle">Создание карты уровня</h2><p class="article__paragraph">Весь текст ниже относится к игровому движку StalinGrad. Это не набор правил или рекомендаций, это рассказ о том, какие принципы закладывались конкретно в этот движок и почему.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример карты уровня." data-url="images/game_render_map_1.jpg"><figcaption class="article__image_explanation">Рис. 33. Пример карты уровня.</figcaption></figure><p class="article__paragraph">Карта уровня должна быть не только интересной игроку, но и обеспечить минимальную нагрузку. Чем меньше объектов использовалось для создания уровня, тем лучше. Мы будем занимать меньше места в памяти, уменьшим число обсчетов столкновений, а также сможем сэкономить ресурсы при рендере. Рассмотрим небольшой пример.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример создания карты с помощью множества объектов." data-url="images/game_render_map_2.jpg"><figcaption class="article__image_explanation">Рис. 34. Пример создания карты с помощью множества объектов.</figcaption></figure><p class="article__paragraph">У нас есть кусок уровня, который состоит из трех разных типов объектов: верхний слой земли, нижний и стена. Мы можем создать множество небольших объектов в форме квадратов и собрать из них уровень, но это не экономно с точки зрения ресурсов. Гораздо выгоднее создать всего три элемента, просто растянув объекты в длинные прямоугольники. С точки зрения рендера — тем более. Мы можем использовать три DIV-элемента и залить их через background-image.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Оптимизация карты уровня за счет уменьшения количества объектов." data-url="images/game_render_map_3.jpg"><figcaption class="article__image_explanation">Рис. 35. Оптимизация карты уровня за счет уменьшения количества объектов.</figcaption></figure><p class="article__paragraph">Практика показала, что интерфейс обычной игры, как правило, не содержит более 50 элементов, а это мало, и браузер сможет легко и быстро производить с ними различные манипуляции.</p><p class="article__paragraph">Следующая проблема, которая стоит перед нами, это текстовая запись нашей карты уровня. В большинстве статей обычно рассматривают пример с двумерным массивом, заполненным нулями и единицами, где нули — пустое место, единица — стена и т.д. Такой формат подойдет для многих игр, но он не масштабируем, т.к. мы изначально закладываем ограничение — мы должны заранее знать размер игрового мира, чтобы задать массив. Выше уже был пример оптимизации с использованием динамических массивов, а значит, мы можем просто составить список объектов на карте и вообще ничего не знать о её размерах.</p><p class="article__paragraph">Чтобы максимально сократить запись, мы должны выделить ключевую информацию об объекте — координаты, габариты, класс и тип. Например:</p><pre class="article__code">(x, y, width, height, className, type);
(0, 0, 25, 30, "block", "sand");</pre><p class="article__paragraph">Также можно предположить, что таких объектов на карте будет несколько и отличаться они будут либо только координатами, либо координатами и габаритами. Тогда можно сохранять в памяти функции параметры прошлого вызова (меморизация). Если функция получит на входе мало аргументов, значит, недостающие она должна взять из прошлого вызова. Например:</p><pre class="article__code">(0, 0, 25, 30, "block", "sand")(25,0)(50,0)(75,0);</pre><p class="article__paragraph">В примере выше мы взяли блок с песком и создали ещё три его копии с другими координатами. Пример с габаритами:</p><pre class="article__code">(0, 0, 25, 30, "block", "sand")(25,0,100,30)(125,0,50,30)(175,0,100,30);</pre><p class="article__paragraph">В примере выше мы взяли блок с песком и создали ещё три его копии с другими координатами и габаритами (длина, высота).</p><p class="article__paragraph">Если функция вызвана только с одним аргументом — то это экземпляр сцены, на которую в следующих вызовах необходимо добавлять объекты. Например:</p><pre class="article__code">StalinGrad.map(world)(125,50,400,25,"block","brick")(125,150)
  (125,175,0,0,"block","floor")(150,200)(475,200)(500,175)
  (525,50)(100,50);</pre><section class="article__note"><p class="article__paragraph_note">Если вам интересно, как создают уровни нормальные мужики в нормальных проектах, почитайте следующего автора:</p><ul class="article__list_note"><li class="article__list_item_note">Дизайн уровней. Теория и практика<br>Михаил Кадиков<br><a href="http://pro.level-design.ru/" class="article__link_note">http://pro.level-design.ru/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="yXLOB"></a><h2 class="article__subtitle">Рассинхронизация таймеров</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Схема работы до опитизации. У каждого объекта персональный таймер." data-url="images/game_timer_1.jpg"><figcaption class="article__image_explanation">Рис. 36. Схема работы до опитизации. У каждого объекта персональный таймер.</figcaption></figure><p class="article__paragraph">Если ваше приложение состоит из большого числа модулей, то, возможно, у вас имеется большое количество таймеров. Эта проблема особенно актуальна для игровых движков, т.к. они могут иметь в своем составе довольно много независимых модулей и объектов с таймерами. Такая ситуация приводит к тому, чтобы начать упорядочивать их работу. Оптимизация состоит из трех ступеней:</p><ul class="article__list"><li class="article__list_item">Один таймер на один модуль.</li><li class="article__list_item">Один таймер на все модули.</li><li class="article__list_item">Рассинхронизация таймеров.</li></ul><b class="article__selection">Один таймер на один модуль</b><p class="article__paragraph">Если у нас есть некий класс, который создает какие-либо объекты, содержащие внутренний таймер, то мы можем вынести этот общий таймер и объединить его для всех объектов. Для этого каждый раз, когда мы будем создавать новый объект класса, мы должны помещать его в некий внутренний массив модуля. Далее по единому таймеру мы сможем обходить этот массив и сразу обновлять все объекты.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Схема работы после опитизации. У всех объектов один общий таймер." data-url="images/game_timer_2.jpg"><figcaption class="article__image_explanation">Рис. 37. Схема работы после опитизации. У всех объектов один общий таймер.</figcaption></figure><p class="article__paragraph">Единственный минус такого подхода состоит в том, что внутри модуля остается ссылка на все объекты, созданные классом. Поэтому при удалении объекта из системы мы также должны удалить его из модуля, в котором он был создан.</p><p class="article__paragraph">Рассмотрим этот алгоритм на примере. В игровом движке StalinGrad есть класс миров. Каждый мир по таймеру обсчитывает физику. Чтобы убрать лишние таймеры мы переписываем модуль миров так, чтобы при создании каждого нового экземпляра класса он заносился в реестр, далее по одному таймеру из реестра брались все миры, и в каждом обсчитывалась физика.</p><p class="article__paragraph">Та же самая ситуация и с другими модулями. Например, каждый экземпляр камеры заносится в реестр, и по единому таймеру обновляются все экземпляры камер.</p><b class="article__selection">Один таймер на все модули</b><p class="article__paragraph">С количеством модулей растет количество таймеров. Чтобы остановить этот рост, мы будем назначать каждому модулю время через реестр времени. Разберем принцип его работы.</p><p class="article__paragraph">Мы берем самый маленький тик (в случае игрового движка StalinGrad это 20 миллисекунд на обсчет физики) и ставим на него таймер. Таймеры всех модулей, у которых тик больше, мы делим на самый маленький тик и получаем число пропусков. Например, у камеры тик 40. Значит, её пропуск 40 / 20 = 2. Значит, камера будет обновляться только при каждом втором вызове.</p><p class="article__paragraph">Есть события с таймером в 1000 миллисекунд, отсюда имеем 1000 / 20 = 50. Следовательно, эти события будут пропускать 49 тиков и выполняться только на 50м. Таким образом, мы получим один таймер, который будет обновлять все модули.</p><b class="article__selection">Рассинхронизация таймеров</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="График нагрузки системы до оптимизации. Нагрузка сосредоточена." data-url="images/game_timer_3.jpg"><figcaption class="article__image_explanation">Рис. 38. График нагрузки системы до оптимизации. Нагрузка сосредоточена.</figcaption></figure><p class="article__paragraph">Есть очень много модулей, которые обновляются по таймеру в 500 и 1000 миллисекунд. Значит 25-й и 50-й тики у нас будут высоконагруженные, а следовательно, совсем не факт, что они успеют отработать в отведенное им время. Т.к. игрок вряд ли заметит разницу между 480, 500 и 520 миллисекунд - мы можем рассинхронизировать часть событий. Тогда мы слегка размажем пик нагрузки на 25-м и 50-м тиках и распределим её на промежутки с 24-го по 26-й и с 49-го по 51-й тик.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="График нагрузки системы после оптимизации. Распределенная нагрузка." data-url="images/game_timer_4.jpg"><figcaption class="article__image_explanation">Рис. 39. График нагрузки системы после оптимизации. Распределенная нагрузка.</figcaption></figure><p class="article__paragraph">Вот пример нескольких модулей, которые попадают под рассинхронизацию в игровом движке: обновление информации об игроке, проверка статуса миссий, обновление погоды, обновление части дня и т.д.</p><section class="article__note"><p class="article__paragraph_note">Многие темы данной главы также раскрыты в:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «Классы и фабрики. Как разобрать и собрать объект с наследованием на прототипах»<br>Бахирев Алексей, Frontend DevConf, Минск<br>19 апреля 2014 года.<br><br></li><li class="article__list_item_note">Доклад «Архитектура игровых движков. Проблемы и их решение на фронтенде»<br>Бахирев Алексей, DevConf, Москва<br>14 июня 2014 года.<br><br></li><li class="article__list_item_note">Доклад «StalinGrad JS. Как создать портальную пушку»<br>Бахирев Алексей, DevConf, Москва<br>14 июня 2014 года.</li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="OgsgS"></a><h1 class="article__header">Кроссплатформенная разработка</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="HlXqc"></a><h2 class="article__subtitle">История</h2><p class="article__paragraph">Первая версия Internet Explorer вышла 16 августа 1995 года и представляла собой переработанную версию браузера Spyglass Mosaic, лицензия на который была выкуплена Microsoft. Ряд инноваций, предложенных Internet Explorer, стали впоследствии использоваться другими браузерами. Среди них элемент HTML iframe, который позволяет встраивать одни HTML-документы в другие (был добавлен в Internet Explorer 3), значок для избранного (favicon), который появился в Internet Explorer 4, и свойство для динамического обновления содержимого элементов innerHTML в Internet Explorer 4. Для Internet Explorer 5 был разработан XMLHttpRequest, который позволил осуществлять HTTP-запросы к серверу без перезагрузки страницы. В этой версии также появился способ захвата и перетаскивания элементов (drag-and-drop), который почти без изменений был стандартизирован в HTML5 и теперь поддерживается почти всеми веб-браузерами.</p><p class="article__paragraph">Т.к. движок браузера может работать отдельно, Microsoft сделал ещё один трюк. Вместо окна браузера они заставили отработать HTML в обычном системном окне и назвали это HTML Application. Так HTML впервые вышел на десктоп. HTA-документ (HTA-приложение) является HTML-документом со встроенными в заголовке атрибутами HTA (соответственно, имеет расширение .hta). Для настройки внешнего вида HTA введён новый тег &lt;hta:application&gt;, который располагается в секции &lt;head&gt; документа HTA. Приложение HTA может быть сделано из обычного файла HTML сменой расширения на .hta.</p><p class="article__paragraph">Обычное приложение HTML ограничено моделью безопасности веб-браузера, например, возможны взаимодействие с сервером, манипулирование объектной моделью страницы (обычно для проверки данных формы и/или создания интересующих визуальных эффектов) и чтение/запись куки. В отличие от этого, HTA запускается как полностью надёжное и безопасное приложение, и, следовательно, имеет больше привилегий в системе, чем обычная HTML-страница. Например, HTA может создавать/редактировать/удалять файлы и записи системного реестра Windows.</p><p class="article__paragraph">Параллельно этому развивались бытовая техника и мобильные технологии. В какой-то момент прогресс достиг уровня, когда на технику стало возможно установить операционную систему. В этот момент на сцену вышел ОС Linux, т.к. был бесплатным и легким. Также у Microsoft появился конкурент в виде движка WebKit, который также был бесплатным. Linux + WebKit начали довольно быстро захватывать рынок. Идею, прежде всего, продвигали маркетологи, под лозунгами «посмотри погоду на холодильнике» или «отправь фотографии в FaceBook прямо с фотоаппарата». Идею Microsoft о том, что веб-страничку можно замаскировать под обычное приложение, начали пускать по кругу снова и снова. Это позволяло маркетологам говорить об инновационных технологиях, а программистам — очень легко создавать функционал, т.к. по сути им нужно было только маскировать окно браузера. С появлением бренда HTML5 идея веб-приложений стала продаваться по утроенной цене. Т.к. WebKit развивался сам по себе, разработчикам достаточно было брать новые версии и лепить ярлык HTML5 на коробки с техникой.</p><p class="article__paragraph">Таким образом мы подошли к 2014 году. В данный момент можно найти огромное количество техники со встроенным браузером (начиная от холодильников и заканчивая автомобилями). Практически везде использован один и тот же движок WebKit. А это значит, что по факту JavaScript стал языком кроссплатформенной разработки. Если вы написали веб-приложение, то оно будет работать везде, где есть адекватный браузер.</p><p class="article__paragraph">Есть ещё один интересный момент, который связан с деятельностью Google. Т.к. их браузер в данный момент является лидером индустрии, а также появляются продукты, связанные с NodeJS, можно заметить, как компания пытается выйти на десктоп, но, в отличие от Microsoft, у неё пока ещё нет «административного ресурса», который бы позволил встроить движок в операционку пользователей и объявить выход задним числом. Программисты вынуждены писать «надстройки», но тем не менее в интернете можно найти статьи с заголовками вроде «Node.js + Chromium = node-webkit: ещё более перспективный вариант второго шага эволюции веборазработчика» или «Новшества node-webkit версии 0.3.6» (выдержка из статьи:  «Roger Wang 14 декабря объявил о выходе новой версии движка node-webkit — созданного в недрах Intel Open Source Technology Center мощного сочетания WebKit и Node.js, позволяющего создавать кросс-платформенные графические приложения методом веборазработки на языках HTML, CSS и JavaScript»). Google и прочих строителей «выхода JS на десктоп» спасает только лишь тот факт, что Microsoft, по какой-то причине, не только сильно ухудшил качество своего браузера по сравнению с конкурентами, но и перестал обновлять движок для запуска HTA файлов, который так и продолжает работать в режиме IE5.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="MTtwo"></a><h2 class="article__subtitle">JS в CHM, HTA, EXE</h2><p class="article__paragraph">Как уже было сказано выше, HTML-странички могут быть конвертированы в большое число разнообразных форматов. Это может быть как PDF, EPUB, XLSX, FB2, так и CHM, APK, EXE и т.п. Но не во всех форматах JavaScript останется работоспособным. Ниже вы можете увидеть пример конвертирования HTML-игры в форматы CHM и EXE.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Вам необходимо добиться стабильной работы в Internet Explorer ранних версий." data-url="images/crossplatform_history_1.jpg"><figcaption class="article__image_explanation">Рис. 40. Вам необходимо добиться стабильной работы в Internet Explorer ранних версий.</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="HTML можно конвертировать в HTA просто сменив расширение." data-url="images/crossplatform_history_2.jpg"><figcaption class="article__image_explanation">Рис. 41. HTML можно конвертировать в HTA просто сменив расширение.</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="HTML можно конвертировать в CHM (например, с помощью htm2chm)." data-url="images/crossplatform_history_3.jpg"><figcaption class="article__image_explanation">Рис. 42. HTML можно конвертировать в CHM (например, с помощью htm2chm).</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="HTA можно конвертировать в EXE (например, с помощью HTML Executable 4)." data-url="images/crossplatform_history_4.jpg"><figcaption class="article__image_explanation">Рис. 43. HTA можно конвертировать в EXE (например, с помощью HTML Executable 4).</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="URgCF"></a><h2 class="article__subtitle">Разработка</h2><p class="article__paragraph">Ключевые моменты кроссплатформенности JavaScript:</p><ul class="article__list"><li class="article__list_item">Практически на любой платформе можно открыть браузер во весь экран без кнопок навигации, загрузить туда страничку и назвать это приложением.</li><li class="article__list_item">Практически на любой платформе можно легко создавать мост между JavaScript и нативным языком. Если вам чего-то не хватило, всегда можно прокинуть мост и дописать с другой стороны.</li><li class="article__list_item">На половине платформ HTML приложение — это всего лишь ZIP-архив и текстовый файл манифеста с описанием неких начальных параметров (название, иконка и т.п.)</li></ul><p class="article__paragraph">Поэтому стабильно действует одна и та же логика:</p><pre class="article__code">if(это компилируется?) {
  WebView на весь экран
} else {
  ZIP архив с манифестом
}</pre><p class="article__paragraph">Примеры сборок приложений на HTML:</p><ul class="article__list"><li class="article__list_item">Мобильные платформы (Android, iOS, Bada и т.п.). Сборка — это приложение с элементом WebView, открытым на весь экран.</li><li class="article__list_item">Расширение и виджеты (Chrome, Opera, Tizen, Smart TV и т.п.). Сборка — это ZIP-архив с текстовым манифестом.</li></ul><p class="article__paragraph">Если у вас есть знакомый разработчик под какую-либо платформу, попросите его накидать простую сборку с WebView компонентом. У него это займет пять минут, а вы, имея такой макет, сможете экспортировать все свои веб-приложения на эту платформу. Как видите, общая схема сборки на самом деле проще, чем кажется:</p><pre class="article__code">Ваше HTML приложение + макет с WebView = сборка под какую-то платформу</pre><p class="article__paragraph">При кроссплатформенной разработке следует учитывать несколько нюансов:</p><ul class="article__list"><li class="article__list_item">Мы не знаем размер окна браузера, который нам будет дан, поэтому вся верстка должна быть резиновой. Например, это может быть десктопное приложение и экран 1024х740, или расширение для браузера размером 400х300, или маленький телефон с экраном 320х240.</li><li class="article__list_item">Мы не знаем ничего о том, что будет или не будет работать, поэтому делаем все максимально просто.</li><li class="article__list_item">Обращаемся к элементам страницы строго по ID.</li><li class="article__list_item">Код модульный, и все вызовы обернуты в try catch. Нужно быть готовым к тому, что у нас будет удален кусок кода или верстки. Все остальное, что не попало под удаление, должно продолжить работу и не привести к отказу системы.</li><li class="article__list_item">Мы не знаем, touch или not touch экран у пользователя.</li><li class="article__list_item">Мы не знаем, есть ли у него клавиатура или мышь. Пользователь мог открыть страницу на планшете или телевизоре, и использовать жесты или пульт дистанционного управления для навигации.</li><li class="article__list_item">Мы не знаем, есть ли у него поддержка cookie или localStorage. Поэтому нужно эти свойства проверять и быть готовым к тому, что их не окажется.</li><li class="article__list_item">Мы не знаем ничего о мощности компьютера. Это может быть восьмиядерный домашний компьютер или слабенький старый мобильный телефон. Нужно оптимизировать алгоритмы работы.</li><li class="article__list_item">Нам ничего не известно о доступе пользователя к интернету. Нужно быть готовым к тому, что доступа в интернет у него не будет. Лучше разрабатывать офлайн-приложения или продумывать возможность офлайн-работы.</li><li class="article__list_item">Мы ничего не знаем о кодировке и языке пользователя. Пишем меньше, заменяем все пентаграммами, делаем интерфейс минималистичным. Если приходится писать — пишем строго на английском, и чем короче, тем лучше. Предложения должны быть простые, чтобы любой переводчик мог перевести их с минимумом ошибок.</li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="StwTP"></a><h2 class="article__subtitle">API устройств</h2><p class="article__paragraph">Если вы хотите написать приложение, которое будет способно работать в различных условиях, вам никогда не следует опираться на API конкретных устройств. API конкретного устройства может быть приятным бонусом, но не более. Всегда описывайте прослойку между кодом вашего приложения и сторонним API. Если API изменится, вы сможете безболезненно перейти на новую версию.</p><p class="article__paragraph">Рассмотрим в качестве примера нарды для телевизора и приложение для Facebook.</p><b class="article__selection">Нарды</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Игра «Нарды» для Smart TV." data-url="images/crossplatform_api_1.jpg"><figcaption class="article__image_explanation">Рис. 44. Игра «Нарды» для Smart TV.</figcaption></figure><p class="article__paragraph">В течение месяца я писал нарды для телевизора. Когда они были готовы, менеджер неожиданно снял задачу и проект прикрыли. Хорошим выходом из ситуации было выпустить игру на других платформах (телефоны, расширение, десктопные браузеры), но это было невозможно, т.к. я совершил следующие ошибки:</p><ul class="article__list"><li class="article__list_item">У меня была фиксированная верстка. Если бы я верстал резиной, размер экрана не имел бы для меня значения.</li><li class="article__list_item">Управление было завязано на API пульта. </li></ul><p class="article__paragraph">По-нормальному, API пульта должно было быть только одним из возможных вариантов управления. Сейчас я использую универсальный модуль, который предоставляет пользователю сразу несколько вариантов управления, от клавиатуры — до touch интерфейса, а на выходе публикует универсальные события: left, right и т.д.</p><b class="article__selection">Фоторедактор</b><p class="article__paragraph">Под Новый год мне поставили задачу написать прототип приложения для Facebook, которое могло бы делать выборку фотографий пользователя и накладывать музыку на различные области изображения. Учитывая прошлый печальный опыт, было совершенно очевидно, что все общение с социальной сетью надо выносить в независимую прослойку. Тогда одно и то же приложение можно будет использовать не только для Facebook, но и для VK, «Одноклассников», «Моего Мира» и других социальных сетей. После сдачи прототипа разработку приложения отменили, но я получил небольшую библиотеку для работы c API соц. сетей, которая предоставляла единый API для работы в нескольких социальных сетях.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="yXtVc"></a><h2 class="article__subtitle">Мобильные телефоны</h2><p class="article__paragraph">Телефоны, при создании сайта, обычно классифицируют по трем типам:</p><ul class="article__list"><li class="article__list_item">Кнопочные, без поддержки touch-событий.</li><li class="article__list_item">С сенсорным экраном, с поддержкой touch-событий.</li><li class="article__list_item">Смартфоны.</li></ul><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Телефоны трех разных типов." data-url="images/phone__type.jpg"><figcaption class="article__image_explanation">Рис. 45. Телефоны трех разных типов.</figcaption></figure><b class="article__selection">Откуда в 2014 году берутся старые кнопочные телефоны? </b><p class="article__paragraph">Наследие прошлых лет. Раньше телефоны могли быть довольно качественными и служить очень долго. Например, есть много историй о Nokia 3310, которую можно было кидать на бетон и забивать ею гвозди в прямом смысле слова. Т.к. они работают и их продали довольно в большом количестве, то до сих пор есть люди, которые ими пользуются.</p><b class="article__selection">Откуда в 2014 году берутся новые кнопочные телефоны?</b><p class="article__paragraph">Производство новых J2ME-телефонов заполняет низший ценовой сегмент рынка. Такие телефоны имеют несколько качественных отличий:</p><ul class="article__list"><li class="article__list_item">Они очень дешевые. Часто их покупают детям и в ситуациях, где есть вероятность лишиться телефона.</li><li class="article__list_item">Такие телефоны потребляют очень мало энергии, и их зарядки может хватать на неделю.</li><li class="article__list_item">Как правило, качество сборки и простота позволяют работать этим телефонам в довольно экстремальных условиях. Их можно кидать в стены, ронять с большой высоты, закапывать и топить без особого ущерба для работоспособности.</li></ul><b class="article__selection">Кто делает сайты для таких телефонов?</b><p class="article__paragraph">Как правило, это очень крупные компании, которые стараются сделать свои сервисы максимально доступными (например, Google, Yandex, Mail). Цена вопроса в этом случае не имеет значения. Кроме того, во всех телефонах есть стандартные закладки, в которых вшит сайт оператора, производителя или компании-вендора. На таких сайтах можно купить различный контент (игры, картинки, мелодии) или оформить какие-либо услуги. Т.к. телефонов производится очень много, то у таких сайтов может быть очень большая нагрузка.</p><p class="article__paragraph">Особенности верстки для простых телефонов:</p><ul class="article__list"><li class="article__list_item">Может не работать JavaScript. Старайтесь использовать его по минимуму.</li><li class="article__list_item">Может не работать позиционирование в CSS (да и вообще многие CSS-свойства).</li><li class="article__list_item">Может не работать даже механизм cookie.</li><li class="article__list_item">У пользователей всегда медленный интернет. Делайте страницы как можно меньше и проще.</li><li class="article__list_item">Пользователь перемещается исключительно по ссылкам (по крайней мере, это удобнее всего). Поэтому старайтесь использовать «якоря» для быстрой навигации по странице. </li><li class="article__list_item">Т.к. очень много вещей может не работать, то, возможно, вам придется верстать по стандартам HTML3</li><li class="article__list_item">На некоторых телефонах очень трудно либо вообще невозможно переключить язык клавиатуры или ответить на СМС, не закрыв страницу браузера. Поэтому в ответных СМС всегда должна быть ссылка для возврата к странице, полей ввода должно быть как можно меньше.</li><li class="article__list_item">Практически на всех простых телефонах невозможно увидеть / изменить адресную строку.</li></ul><b class="article__selection">Как обходят неработающие cookie?</b><p class="article__paragraph">В таких случаях, как правило, на уровне CMS, реализуется механизм, который автоматически дописывает номер сессии пользователя в виде параметра во все ссылки на странице. Например, до:</p><pre class="article__code">http://wap.samsung.ru/games/index.do</pre><p class="article__paragraph">И после:</p><pre class="article__code">http://wap.samsung.ru/games/index.do?id=8592387483239423722732</pre><b class="article__selection">Размеры экрана</b><p class="article__paragraph">Как правило, ширина экрана у большинства кнопочных телефонов соответствует числам: 120, 176, 240, 320 при DPI, равным единице. Но в любом случае верстайте резиной. Неизвестно, какой дисплей будет у телефона. Кроме того, производители Blackberry и Nokia любят выпускать телефоны с альбомным соотношением сторон (ширина дисплея больше высоты).</p><p class="article__paragraph">Устройства с сенсорным экраном ведут себя гораздо лучше, но они тоже далеки от идеала. Более того, ввести что-либо в форму ввода на плохом сенсорном экране гораздо труднее, чем на кнопочном телефоне.</p><p class="article__paragraph">У смартфонов все ещё лучше, и зачастую они не отличаются по поведению от ПК, но стандартные браузеры могут иметь небольшие баги. Например, наша тестовая Nokia Lumia не могла делать position: fixed и давала сбои, если мы что-либо выводили в консоль (console.log / console.dir не должны быть в коде продакшин сборки).</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример вшитого в закладки сайта для продажи контента." data-url="images/api_wap_1.jpg"><figcaption class="article__image_explanation">Рис. 46. Пример вшитого в закладки сайта для продажи контента.</figcaption></figure><p class="article__paragraph">Также часто встречается ошибка, при которой touch-телефону отдается не touch-версия. Проблема в том, что попасть по плотно расположенным ссылкам с плохого touch-экрана очень трудно, т.к. размер пальца многократно превышает размер ссылки. Или же при верстке touch-версии забывают об особенностях браузера, и элемент страницы попадает под элемент управления интерфейса браузера.</p><b class="article__selection">Операторы и контент</b><p class="article__paragraph">Оператор сотовой связи обычно определяется по диапазону IP-адресов, с которых пользователи приходят на сайт. В случае подключения по wi-fi определить оператора практически невозможно. Определять оператора необходимо для того, чтобы иметь возможность выводить разный контент, разным абонентам, по разной цене.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Схема определения оператора и телефона для показа подходящего контента и цены." data-url="images/api_wap_2.jpg"><figcaption class="article__image_explanation">Рис. 47. Схема определения оператора и телефона для показа подходящего контента и цены.</figcaption></figure><p class="article__paragraph">Сам контент может иметь очень много представлений. Например, производители игр должны учитывать, что телефоны отличаются как по размеру экрана, так и по операционной системе. Кроме того, все хотят максимально уменьшить вес конечного билда игры. Поэтому одна игра для J2ME-телефона может иметь до 20 различных сборок в зависимости от модели телефона. Сами телефоны, в таких случаях, обычно разделяются по User-Agent`у и для компактности объединяются в группы, в зависимости от функционала. За каждой игрой в базе закрепляется диапазон поддерживаемых групп.</p><p class="article__paragraph">Аналогичная ситуация начинает появляться и для современных смартфонов. В данный момент в продаже можно найти телефоны с операционкой: Android (версий 2 и 4), iOS, Windows Phone и т.д. Также готовятся к запуску Tizen и FireFox OS. Кроме того, для планшетов и мелких телефонов уже начинают собирать разные сборки, т.к. планшетам необходимы ресурсы в гораздо более высоком качестве, а делать билд для маленьких телефонов тяжеловесным — не имеет смысла. Также производители телефонов могут вносить свои правки и дорабатывать операционные системы под свои аппараты. Поэтому вполне вероятно, что игра легко запускается на телефонах Nokia, но не работает на Fly или Huawei, и наоборот.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Будни мобильного разработчика. Fly — нижняя панель браузера закрыла кнопку «Вверх». Sony — не работают тени и кнопка поиска. Samsung — адресная строка при смене хеша закрывает верхний поиск." data-url="images/api_wap_3.jpg"><figcaption class="article__image_explanation">Рис. 48. Будни мобильного разработчика. Fly — нижняя панель браузера закрыла кнопку «Вверх». Sony — не работают тени и кнопка поиска. Samsung — адресная строка при смене хеша закрывает верхний поиск.</figcaption></figure><p class="article__paragraph">В сети вы можете встретить множество библиотек для «кроссплатформенной» разработки на JavaScript. Но ни одна библиотека, из тех, которыми я пользовался, даже близко не решала основных проблем. Для создания качественного продукта вам в любом случае понадобиться иметь большой набор различных устройств для тестирования.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="EuFhX"></a><h2 class="article__subtitle">Touch-экраны</h2><p class="article__paragraph">При использовании touch-экранов пользователи, как правило, используют не точечные нажатия, а жесты. В результате этого текст на странице, а также элементы управления могут выделиться. Чтобы избежать этого, в CSS вам следует запретить выделение для всего:</p><pre class="article__code">*, body {
  -moz-user-select: -moz-none;
  -o-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="В данном примере вместо раскрытия меню отработало событие выделения текста." data-url="images/touch__6.jpg"><figcaption class="article__image_explanation">Рис. 49. В данном примере вместо раскрытия меню отработало событие выделения текста.</figcaption></figure><p class="article__paragraph">Но это правило не должно распространяться на поля ввода:</p><pre class="article__code">input, textarea {
  -moz-user-select: text;
  -o-user-select: text;
  -khtml-user-select: text;
  -webkit-user-select: text;
  user-select: text;
}</pre><p class="article__paragraph">Кроме того, следует отключить resize у textarea, т.к. она не должна менять свой размер:</p><pre class="article__code">input, textarea {
  resize: none;
}</pre><p class="article__paragraph">Если вы хотите полностью контролировать дизайн своего приложения, не забудьте также отключить автоуменьшение шрифтов:</p><pre class="article__code">*, body {
  -webkit-text-size-adjust: none;
}</pre><p class="article__paragraph">Если браузеру «покажется», что шрифты нужно увеличить, при отсутствии данного стиля iPhone самопроизвольно может изменить размер шрифта при изменении ориентации на альбомную, оставляя размеры всех элементов (не текста) правильными.</p><b class="article__selection">Тормоза и остановка отрисовки при касании экрана</b><p class="article__paragraph">Если у вас есть какая-либо анимация с использованием DOM-элементов, браузер может остановить отрисовку страницы в момент клика на дисплей и продолжить, когда событие завершится.</p><p class="article__paragraph">Это происходит потому, что обычно на элементы вешают только click события, забывая про touch. Телефон, в свою очередь, ждет, пока событие завершится, чтобы попытаться распознать его, и только после этого продолжает работать со страницей.</p><p class="article__paragraph">Чтобы убрать задержку, вам необходимо вместо click-события повесить аналогичное touch-событие, а также сопутствующие события, такие, как touchmove и touchend. Даже если у вас нет callback-функции для них, стоит, по крайней мере, вызвать stopEvent. Таким образом, при клике на дисплей телефон увидит, что JavaScript хочет самостоятельно обработать касание, и сразу вернет управление странице.</p><b class="article__selection">Желтое и синее выделение при клике</b><p class="article__paragraph">При клике на какой-либо элемент страницы все устройства с ОС Android ~2 стремятся выделить элемент желтой заливкой, а устройства с ОС Android ~4 — синей.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Поведение главной страницы Яндекса при тапе на Android 2.3 и 4.3" data-url="images/touch__1.jpg"><figcaption class="article__image_explanation">Рис. 50. Поведение главной страницы Яндекса при тапе на Android 2.3 и 4.3</figcaption></figure><p class="article__paragraph">Желтая заливка убирается путем использования в CSS следующего кода:</p><pre class="article__code">*, body {
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  -webkit-focus-ring-color: rgba(0,0,0,0);
  outline: none;
}</pre><p class="article__paragraph">Синяя заливка исчезнет при перехвате всех touch-событий на элементе (см. пункт «Тормоза и остановка отрисовки при касании экрана»).</p><b class="article__selection">Защитный экран</b><p class="article__paragraph">При удержании пальца на картинке все смартфоны в данный момент предлагают сохранить её, тем самым мешая пользователю взаимодействовать с нашей системой. Для того, чтобы исключить подобные ситуации, используйте защитный прозрачный блок, растянутый на весь экран и имеющий z-index больше, чем у всех остальных элементов анимации, и останавливающий все click- и touch-события, приходящиеся на него. </p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Экран игры на смартфоне при тапе с защитным слоем и без него." data-url="images/touch__4.jpg"><figcaption class="article__image_explanation">Рис. 51. Экран игры на смартфоне при тапе с защитным слоем и без него.</figcaption></figure><p class="article__paragraph">При создании какого-либо приложения в роли защитного экрана обычно выступают элементы контроллера, которые располагаются равномерно на всем экране, препятствуя попаданию событий на нижележащие элементы.</p><p class="article__paragraph">Также на Android`ах блокировать контекстное меню можно при помощи CSS:</p><pre class="article__code">img {
  -webkit-touch-callout: none;
}</pre><b class="article__selection">Экранная клавиатура</b><p class="article__paragraph">При разработке мобильных приложений и сайтов многие разработчики и проектировщики интерфейсов забывают об экранной клавиатуре. Поэтому очень часто случаются ситуации, при которых поля ввода при вводе оказываются не видны для пользователя.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Т.к. поле ввода ника располагается по центру экрана, при появлении экранной клавиатуры оно становится недоступно для пользователя." data-url="images/touch__2.jpg"><figcaption class="article__image_explanation">Рис. 52. Т.к. поле ввода ника располагается по центру экрана, при появлении экранной клавиатуры оно становится недоступно для пользователя.</figcaption></figure><p class="article__paragraph">Если дизайн изначально предполагал книжную ориентацию, то вероятность такой ошибки существенно ниже. Также следует учитывать тот факт, что на разных устройствах экранная клавиатура разная, и может появляться с разных сторон дисплея и занимать как часть экрана, так и весь экран.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="В игре &amp;laquo;Судоку&amp;raquo; нет проблем с экранной клавиатурой за счет удачного расположения поля ввода." data-url="images/touch__3.jpg"><figcaption class="article__image_explanation">Рис. 53. В игре «Судоку» нет проблем с экранной клавиатурой за счет удачного расположения поля ввода.</figcaption></figure><p class="article__paragraph">При использовании элементов input ставьте им тип согласно семантике. Например:</p><pre class="article__code">&lt;input type="text"/&gt;
&lt;input type="email"/&gt;</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Примеры разных экранных клавиатур при смене типа у элемента input." data-url="images/phone__keyboard.jpg"><figcaption class="article__image_explanation">Рис. 54. Примеры разных экранных клавиатур при смене типа у элемента input.</figcaption></figure><p class="article__paragraph">Разница между ними в том, что когда вы будете вводить email, телефон изменит клавиатуру и вынесет знак @ на видное место. Та же схема работает при вводе адреса сайта в адресную строку — телефоны обычно вносят небольшие изменения в раскладку и выводят «.com» для быстрого набора. На момент написания этого текста наилучшие результаты давали смартфоны с операционной системой от Яндекса. В них была стандартная qwerty-клавиатура с одновременным выводом русских и английских символов. Это очень удобно для пользователей, т.к. многие привыкли вводить русские пароли на английской раскладке.</p><b class="article__selection">Скрытие адресной строки</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример скрытия адресной строки с помощью window.scrollTo(0, 1)." data-url="images/touch__8.jpg"><figcaption class="article__image_explanation">Рис. 55. Пример скрытия адресной строки с помощью window.scrollTo(0, 1).</figcaption></figure><p class="article__paragraph">Чтобы скрыть адресную строку на телефонах с операционной системой Android, необходимо увеличить минимальную высоту документа так, чтобы она была больше высоты экрана. Далее следует сделать прокрутку вверх на один пиксель, после чего можно вернуть минимальную высоту в нормальное положение.</p><b class="article__selection">Задержка событий</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Воспроизведение бага: при клике на кнопку назад предыдущая страница восстанавливается слишком быстро и клик отрабатывает также по кнопке &amp;laquo;меню&amp;raquo;, которая имеет те же координаты, что и кнопка &amp;laquo;назад&amp;raquo;." data-url="images/touch__7.jpg"><figcaption class="article__image_explanation">Рис. 56. Воспроизведение бага: при клике на кнопку назад предыдущая страница восстанавливается слишком быстро и клик отрабатывает также по кнопке «меню», которая имеет те же координаты, что и кнопка «назад».</figcaption></figure><p class="article__paragraph">Суть в том, что касание экрана — процесс длительный. Если вы переходите на прошлую страницу, она может довольно быстро восстановиться из кэша, и тогда касание экрана отработает два раза: на исходной странице и на новой (баг воспроизводится не на всех устройствах с touch-экраном). Чтобы решить эту проблему, необходимо вешать обработчики с небольшой задержкой. В первый момент вы инициализируете все скрипты, потом выжидаете полсекунды, и лишь потом вешаете обработчики кликов и touch-событий. Как правило, этого времени хватает, и проблема исчезает.</p><b class="article__selection">Проблема прокрутки</b><p class="article__paragraph">Ещё одной проблемой, которую часто забывают решить веб-разработчики на телефонах, является запоминание позиции при прокрутке страницы.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример ошибки при отсутствии механизма запоминания позиции прокрутки." data-url="images/touch__9.jpg"><figcaption class="article__image_explanation">Рис. 57. Пример ошибки при отсутствии механизма запоминания позиции прокрутки.</figcaption></figure><p class="article__paragraph">Предположим, у вас есть большой список. Вы находитесь в его конце. Открываете новую страницу, а потом, по какой-то причине, решаете вернуться назад к списку. Как правило, разработчики забывают записать значение прокрутки в localStorage, и вместо того, чтобы вернуться в то же место, мы возвращаемся в начало списка.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше о работе с touch-экраном вы можете из:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «Веб-интерфейсы на touch-устройствах»<br>Иван Чашкин, DUMP 2014, Екатеринбург, 14 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link_note">http://fronttalks.ru/2014/13-14march.html</a><br><br></li><li class="article__list_item_note">Доклад «Простые интерфейсы»<br>Бахирев Алексей, IMeetup, Санкт-Петербург, 31 мая 2014 года.</li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="fzdyp"></a><h2 class="article__subtitle">Телевизоры</h2><p class="article__paragraph">В данный момент появляется все больше телевизоров с интернетом, браузером и технологией Smart TV. Это позволяет JavaScript разработчикам освоить ещё одно направление разработки.</p><b class="article__selection">Специфика разработки под телевизор</b><p class="article__paragraph">Любой производитель телевизоров, как правило, предоставляет свою библиотеку и API для работы с пультом. Если не привязываться к библиотеке, то можно использовать стандартное свойство пульта — он может перемещаться по ссылкам, аналогично мобильным телефонам с клавиатурой. Поэтому все элементы управления стоит обернуть в ссылки, чтобы иметь возможность легко переключаться между ними.</p><p class="article__paragraph">В отличие от ПК, те же самые шрифты на TV могут выглядеть непривлекательно. Кроме того, цвета могут оказаться не такими контрастными, как хотелось бы.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример разных пультов для Smart TV." data-url="images/tv__keyboard.jpg"><figcaption class="article__image_explanation">Рис. 58. Пример разных пультов для Smart TV.</figcaption></figure><p class="article__paragraph">Пульты бывают разных видов и форм. В зависимости от производителя пульт может иметь как стандартную раскладку кнопок и прямоугольную форму, так и оригинальную изогнутую форму, touchpad и даже маленькую выдвижную qwerty-клавиатуру. На всех пультах, как правило, имеются:</p><ul class="article__list"><li class="article__list_item">Кнопки «влево», «вправо», «вверх», «вниз»</li><li class="article__list_item">Кнопки «подтвердить» и «отмена»</li><li class="article__list_item">Четыре незапрограммированные кнопки «A», «B», «C», «D»</li></ul><p class="article__paragraph">Старайтесь основной функционал закладывать в первый пункт («влево», «вправо», «вверх», «вниз»), т.к. управление этими кнопками, как правило, самое удобное.</p><b class="article__selection">Альтернативные способы управления</b><p class="article__paragraph">Если у вас есть возможность, вы можете предоставить пользователю альтернативные способы управления вашим приложением:</p><ul class="article__list"><li class="article__list_item">Голосом</li><li class="article__list_item">Жестами</li><li class="article__list_item">Через другое устройство (телефон или ПК)</li></ul><p class="article__paragraph">Также в браузере телевизора, как правило, можно включить управление курсором через пульт. Но, в отличие от мыши, точность перемещения указателя резко падает из-за плохой отзывчивости управления, и пользователи просто промахиваются мимо элементов.</p><b class="article__selection">Цифры удобнее букв</b><p class="article__paragraph">Стоит по возможности сокращать поля ввода текста, а там, где они необходимы, попытаться использовать исключительно цифры (например, поля авторизации пользователя), т.к. ввод текста с пульта медленный и крайне неудобен для пользователя. Если пользователю все-таки необходимо ввести текст, стоит предоставить ему экранную qwerty-клавиатуру, т.к. стандартные клавиатуры от производителей телевизоров очень часто крайне неудобны. Кроме того, также следует подключить механизм подсказок, чтобы пользователю было не обязательно набирать полный текст.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример стандартной системной клавиатуры." data-url="images/tv__keyboard_2.jpg"><figcaption class="article__image_explanation">Рис. 59. Пример стандартной системной клавиатуры.</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример оптимизированной клавиатуры и быстрого поиска." data-url="images/tv__keyboard_1.jpg"><figcaption class="article__image_explanation">Рис. 60. Пример оптимизированной клавиатуры и быстрого поиска.</figcaption></figure><b class="article__selection">Избегайте глубокой вложенности</b><p class="article__paragraph">Навигация в приложении должна быть максимально простой. Постарайтесь избегать полос прокрутки и нагромождения элементов. Учтите, что в повседневной жизни экраны телевизоров, как правило, довольно большие, а расстояние до пользователя может достигать нескольких метров. Делайте элементы крупными и четко указывайте фокус.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример навигации в приложении Яндекса." data-url="images/tv__menu.jpg"><figcaption class="article__image_explanation">Рис. 61. Пример навигации в приложении Яндекса.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="mHgGa"></a><h2 class="article__subtitle">Портирование игры с браузера в TV</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример портирования игры." data-url="images/crossplatform_api_tv2_1.jpg"><figcaption class="article__image_explanation">Рис. 62. Пример портирования игры.</figcaption></figure><b class="article__selection">Задача</b><p class="article__paragraph">Портировать игру, которая представлена в виде расширения для браузера, на телевизор.</p><b class="article__selection">Проблема</b><p class="article__paragraph">У телевизора нет клавиатуры, а следовательно необходимо использовать сторонние библиотеки от производителей телевизоров, для перехвата событий кнопок пульта.</p><b class="article__selection">Решение</b><p class="article__paragraph">Пульт может «ходить» по ссылкам, а следовательно мы можем вывести элементы управления, обернутые в ссылки, и получить поддержку пульта без подключения дополнительных библиотек. Кроме того, этот метод также применим для старых J2ME-телефонов, которые также перемещаются исключительно по ссылкам. Таким образом, с помощью одного трюка мы получаем поддержку сразу для двух абсолютно разных типов устройств.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Переработанная игра для работы на телевизоре." data-url="images/crossplatform_api_tv2_2.jpg"><figcaption class="article__image_explanation">Рис. 63. Переработанная игра для работы на телевизоре.</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="С переработанным управлением игра также доступна на старых J2ME-телефонах." data-url="images/crossplatform_api_tv2_3.jpg"><figcaption class="article__image_explanation">Рис. 64. С переработанным управлением игра также доступна на старых J2ME-телефонах.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="DMJuR"></a><h2 class="article__subtitle">Клавиатура</h2><p class="article__paragraph">Если у вашего приложения есть простой программный интерфейс, его можно без проблем вынести на клавиатуру. Подобным образом поступили разработчики Яндекс.Почты, и теперь для работы с ней не обязательно трогать мышку.</p><p class="article__paragraph">Первое, о чем следует задуматься, это о том, какие кнопки будут отвечать за управление. Выбор нестандартных кнопок на клавиатуре и отсутствие дублирования является очень распространенной проблемой у разработчиков. Поэтому вы должны придерживаться двух правил:</p><ul class="article__list"><li class="article__list_item">Используйте кнопки, которые используются в большинстве приложений, для аналогичных действий (например: стрелки для управления персонажем в игре).</li><li class="article__list_item">Дублируйте функционал для других кнопок, чтобы пользователь наверняка их нашел (например: дублирование стрелок на кнопках «A», «W», «S», «D»).</li></ul><p class="article__paragraph">В идеале при любом положении руки пользователя на клавиатуре он должен нащупывать управление. Для реализации этого функционала можно составлять карту клавиатуры. Например:</p><pre class="article__code">{
  left:  [ 37, 65, 75, 97, 100, 1092 ],
  right: [ 39, 68, 102, 186, 1074 ],
  up:  [ 38, 79, 87, 104 ],
  down:  [ 40, 76, 83, 101 ]
}</pre><p class="article__paragraph">Карта состоит из «событий» и кодов кнопок, которые при нажатии вызывают эти события.</p><b class="article__selection">Баг нескольких одновременных нажатий</b><p class="article__paragraph">С этим багом вы можете столкнуться при разработке игр на JavaScript. Например, у вас есть некий персонаж, которым можно управлять при помощи клавиатуры. Нажимаем «влево», потом зажимаем «вверх». Отпускаем «вверх» (кнопка влево по-прежнему зажата) и персонаж больше не бежит влево. Такая же проблема с комбинацией «влево» + «вправо» — «вправо». Этот баг прежде всего связан с архитектурой приложения.</p><p class="article__paragraph">Выход из ситуации мне подсказал алгоритм старой змейки, в которой использовалось залипание кнопок. При нажатии кнопки информация о направлении записалась в переменную, за которой следит таймер. По сути, между игрой и клавиатурой появился посредник в виде переменной, которая помнит последнее направление. Для нескольких кнопок нам потребуется написать модуль управления. Его алгоритм такой:</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример карты клавиатуры. По горизонтальной оси идут коды кнопок, по вертикальной — callback-функции." data-url="images/keyboard__1.jpg"><figcaption class="article__image_explanation">Рис. 65. Пример карты клавиатуры. По горизонтальной оси идут коды кнопок, по вертикальной — callback-функции.</figcaption></figure><ul class="article__list"><li class="article__list_item">Создаем карту клавиатуры. Это двухмерный массив, в котором по одной оси отложены коды кнопок, а по другой — слушатели, подписанные на эти клавиши.</li></ul><pre class="article__code">var keyMap[37] = [
  callback__1,
  callback__2,
  callback__3
  ...
]</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример массива с историей нажатых клавиш." data-url="images/keyboard__2.jpg"><figcaption class="article__image_explanation">Рис. 66. Пример массива с историей нажатых клавиш.</figcaption></figure><ul class="article__list"><li class="article__list_item">Создаем историю нажатий. Это массив, в который заносятся коды кнопок, в порядке их зажатия. При отжатии — кнопка удаляется из массива.</li><li class="article__list_item">Создаем функцию, которая по таймеру будет обходить историю нажатий и вызывать соответствующие callback-функции по карте клавиатуры.</li></ul><p class="article__paragraph">В игровых движках в качестве callback-функций выступают методы джойстиков, привязанных к клавиатуре. Кроме того, следует фильтровать события, чтобы исключить повторный вызов события при одновременном нажатии двух одинаковых по функционалу кнопок. Одновременно работать могут только события абсолютно разные по функционалу (например, перемещение «вверх» и «влево»).</p><p class="article__paragraph">Схема, с одной стороны, сложная, а с другой — дает отличные перспективы к масштабируемости. Мы можем задавать настройки и перечислять список кнопок, на которые мы хотим подписаться. Так можно сделать игру для двух и более игроков на одной клавиатуре.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="HahOS"></a><h2 class="article__subtitle">Синхронизация устройств</h2><p class="article__paragraph">Трюк синхронизации устройств основан на том, что у вас имеются два устройства (например, TV и ПК) и ввод информации на одном из них ограничен. Рассмотрим его наглядно на примере ниже.</p><b class="article__selection">Проблема</b><p class="article__paragraph">Есть сайт, запущенный на телевизоре. На сайте есть поле ввода текстовой информации (например, email). Т.к. ввод текстовой информации при помощи пульта крайне неудобен, необходимо задействовать другое устройство (телефон или ноутбук) для ввода информации.</p><b class="article__selection">Общий алгоритм решения</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Схема синхронизации устройств. Пользователю показывают ID (1). Производится поиск на другом устройстве (2), и результаты с заданным ID отправляются на сервер (3). Телевизор опрашивает сервер до тех пор, пока не увидит данные (4)." data-url="images/tv__synchronization.jpg"><figcaption class="article__image_explanation">Рис. 67. Схема синхронизации устройств. Пользователю показывают ID (1). Производится поиск на другом устройстве (2), и результаты с заданным ID отправляются на сервер (3). Телевизор опрашивает сервер до тех пор, пока не увидит данные (4).</figcaption></figure><p class="article__paragraph">Телевизор генерирует некий уникальный ID (это может быть как случайный хэш, так и его серийный номер) и начинает с некоторым интервалом опрашивать сервер, нет ли свежих результатов поиска для него.</p><p class="article__paragraph">Используя дополнительное устройство, пользователь ищет информацию на сайте, а в конце мы предлагаем ему отправить результаты на телевизор путем ввода ID в некое поле.</p><p class="article__paragraph">Наш сервер получает ID устройства и результат поиска. Когда телевизор в очередной раз дернет API, сервер отправит ему свежие результаты поиска.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример экрана с кодом для синхронизации." data-url="images/api_tv__synchronization.jpg"><figcaption class="article__image_explanation">Рис. 68. Пример экрана с кодом для синхронизации.</figcaption></figure><b class="article__selection">Рекомендации</b><ul class="article__list"><li class="article__list_item">Если вы предлагаете пользователям воспользоваться смартфоном или планшетом, было бы неплохо вывести QR-код, благодаря которому пользователи бы моментально открыли нужную страницу сайта и приступили к поиску.</li><li class="article__list_item">Если у вас есть возможность вставить ID в ссылку (либо сгенерировать QR-код), необходимо это сделать и избавить пользователя от необходимости ввода ID на дополнительном устройстве.</li><li class="article__list_item">ID устройства не должен быть слишком сложным. Возможно, имеет смысл получать его у сервера в виде простого короткого числа. Короткого числа будет достаточно, т.к. даже при очень большой аудитории маловероятно, что много людей будут использовать этот функционал одновременно.</li></ul><section class="article__note"><p class="article__paragraph_note">Узнать больше о работе с интерфейсами телевизоров вы можете у экспертов юзабилити:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «Как просить деньги через телевизор?»<br>Екатерина Юлина, ProfsoUX, Санкт-Петербург, 26 апреля 2014 года.<br><a href="http://2014.profsoux.ru/papers/56/" class="article__link_note">http://2014.profsoux.ru/papers/56/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="kTwws"></a><h2 class="article__subtitle">Проблемы разработки под Android</h2><p class="article__paragraph">В рабочих проектах нам пришлось отказаться от PhoneGap, потому что возникало много ситуаций, в которых он показывал себя не лучшим образом. Кроме того у нас есть штат Java-разработчиков, которые могут дописывать самые необычные пожелания на стороне платформы.</p><p class="article__paragraph">На Android`е в данный момент нет стандартных HTML-приложений, поэтому, чтобы попасть на платформу, нам нужно создать обычный пустой проект с объектом WebView растянутым на весь экран, в котором будет наша HTML-страничка. В методе onCreate MainActivity пишем:</p><pre class="article__code">vw = (WebView) findViewById(R.id.webview);

/** Отключили вертикальную прокрутку **/
vw.setVerticalScrollBarEnabled(false);

/** Отключили горизонтальную прокрутку **/
vw.setHorizontalScrollBarEnabled(false);

/** Включили JavaScript **/
vw.getSettings().setJavaScriptEnabled(true);

/** Включили localStorage и т.п. **/
vw.getSettings().setDomStorageEnabled(true);

/** Отключили зум, т.к. нормальные приложения
  подобным функционалом не обладают **/
vw.getSettings().setSupportZoom(false);

/** Отключили поддержку вкладок, т.к. пользователь
  должен сидеть в SPA приложении **/
vw.getSettings().setSupportMultipleWindows(false);

/** Отключение контекстных меню по долгому клику **/
vw.setLongClickable(false);

/** в JavaScript`е создается объект API.
  Это будет наш мост в мир Java. **/
vw.addJavascriptInterface(new WebAppInterface(this), "API");

/** загрузили нашу страничку **/
vw.loadUrl("file:///android_asset/index.html");

vw.setWebViewClient(new WebViewClient());</pre><p class="article__paragraph">Все спорные ситуации будем решать на стороне Java. Помните, пишете вы для Bada или Smart TV — всегда есть какой-то стандартный функционал, который позволяет кидать мосты в JavaScript. В нашем случае для Android`а мы кинули экземпляр класса WebAppInterface, а сам класс будет выглядеть так:</p><pre class="article__code">public class WebAppInterface {
  Context mContext;

  WebAppInterface(Context c) {
    mContext = c;
  }

  /** Далее идут методы, которые появятся в JavaScript **/
  @JavascriptInterface
  public void sendSms(String phoneNumber, String message) {
    ... какой-то нативный код
  }
}</pre><p class="article__paragraph">Если у вас возникла необходимость из Java сообщить JavaScript`у какое-либо событие, самый простой способ — изменить URL у WebView:</p><pre class="article__code">vw.loadUrl("javascript: ... какой-либо код на JavaScript");</pre><b class="article__selection">В Android &lt; 4 шрифты могут растянуться</b><p class="article__paragraph">Либо делайте проверки, либо отключите шрифты. Лучше использовать стандартные шрифты и не подгружать свои. Такая проблема возникает на многих устройствах, не только под управлением Android. Например, некоторые модели iPhone могут наоборот — сжимать шрифты.</p><b class="article__selection">Android чувствителен к регистру</b><p class="article__paragraph">Если у вас среди картинок с расширением .jpg имеется картинка с расширением .JPG — вы вряд ли когда-либо заметите разницу в браузере, а вот в WebView картинка не загрузится.</p><b class="article__selection">Android чувствителен к зарезервированным словам</b><p class="article__paragraph">Например, у меня была в assets`ах папка с именем classijizm. Android отказывался собирать проект и не мог внятно объяснить ошибку. Переименовал в klassijizm — заработало. Опять же, в обычном браузере того же Android`а таких проблем не было. При сборке игры для Android ~2 слетели переводы, т.к. в файле локализации внутри JSON объекта был ключ:</p><pre class="article__code">continue: "Продолжить"</pre><p class="article__paragraph">Несмотря на то, что слово continue не является зарезервированным в JavaScript, да и в Android ~4 все работает, тем не менее в Android ~2 это слово писать нельзя.</p><b class="article__selection">Тег audio на Android ~4 не работает</b><p class="article__paragraph">Точнее, он работает в браузере, но не работает, когда вы используете его внутри WebView. Чтобы обойти это ограничение, можно прокинуть мост и переписать на нативном коде. В onCreate добавляем:</p><pre class="article__code">mp = new MediaPlayer();</pre><p class="article__paragraph">А для WebView расширяем JavaScript интерфейс:</p><pre class="article__code">@JavascriptInterface
public void audio(String url) {
  try {
    soundClick = getAssets().openFd(url);
    mp.reset();
    mp.setDataSource(soundClick.getFileDescriptor(), soundClick.getStartOffset(), soundClick.getLength());
    mp.prepare();
    mp.start();
  } catch (IOException e) {
    e.printStackTrace();
  }
}</pre><p class="article__paragraph">Вместо закрытия Android сворачивает приложения. Поэтому, если вы используете Аудио, вам нужно, как минимум, отключить звук.</p><p class="article__paragraph">Суть проблемы в том, что, предположим, у вас запущена игра. Пользователь вышел из приложения, но продолжает слышать звуки из работающей игры. Поэтому из Java надо отправить запрос в JavaScript и попросить остановить работу игры.</p><pre class="article__code">@Override
public void onBackPressed() {
  vw.loadUrl("javascript:  windowClose();");
  MainActivity.this.finish();
}

@Override
public void onPause() {
  super.onPause();
  vw.loadUrl("javascript:  windowClose();");
  MainActivity.this.finish();
}

@Override
public void onResume() {
  super.onResume();
  vw.loadUrl("javascript:  windowOpen();");
}

@Override
public void onDestroy() {
  super.onDestroy();
  vw.loadUrl("javascript:  windowClose();");
  MainActivity.this.finish();
}</pre><p class="article__paragraph">Командой MainActivity.this.finish(); я пытаюсь закрыть приложение при каждом удобном случае. Так можно быть более уверенным, что Android в следующий раз просто начнет все сначала, а не будет пытаться что-либо восстановить. Понятно, что в играх типа «Судоку» так делать нельзя, но в большинстве игр — можно, т.к. они достаточно просты (тот же «FlappyBirds» или «Тесты»). Советую опасаться попыток Android вернуть все как было, т.к. появляются другие баги.</p><b class="article__selection">Android при onResume не всегда удачно восстанавливает приложения</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="При открытии приложения зафиксировался маленький размер документа." data-url="images/touch__10.jpg"><figcaption class="article__image_explanation">Рис. 69. При открытии приложения зафиксировался маленький размер документа.</figcaption></figure><p class="article__paragraph">На некоторых устройствах есть проблемы с повторным запуском. Например, телефон может остановить таймеры или чудным образом не среагировать на resize. Поэтому в любой непонятной ситуации вызывайте resize и перепроверяйте таймеры. Кроме того, ошибка с resize часто возникает при открытии / закрытии экранной клавиатуры.</p><b class="article__selection">При сворачивании / открытии приложения может возникнуть несколько WebView, которые будут работать параллельно и мешать друг другу</b><p class="article__paragraph">Чтобы наверняка уйти от такой проблемы, допишем в манифест:</p><pre class="article__code">&lt;activity
  ...
  /** Это гарантирует один экземпляр
    приложения в любой момент времени **/
  android:clearTaskOnLaunch="true"
  android:noHistory="true"
  android:launchMode="singleTask"
  ...
  /** А этой строкой запретим пересоздание
    WebView при смене ориентации экрана **/
  android:configChanges="keyboardHidden|orientation|screenSize"
  ...
  /** включим аппаратное ускорение **/
  android:hardwareAccelerated="true" &gt;</pre><p class="article__paragraph">Чтобы наше приложение на JavaScript выглядело ещё лучше, его можно запустить во весь экран, убрав черную полоску сверху. Для этого в манифест нужно добавить:</p><pre class="article__code">&lt;application
  ...
  android:theme="@android:style/Theme.NoTitleBar.Fullscreen"&gt;</pre><b class="article__selection">localStorage, в который вы сохраняете данные, будет уничтожен после закрытия приложения</b><p class="article__paragraph">Чтобы сохранить данные между двумя вызовами, нужно сохранить данные в нативном SharedPreferences. Прокинем два моста на сохранение и загрузку:</p><pre class="article__code">@JavascriptInterface
public void saveSomeThing(String message) {
  SharedPreferences preferences = getSharedPreferences("com.example.something", MODE_PRIVATE);
  SharedPreferences.Editor editor = preferences.edit();
  editor.putString("somethingID", message);
  editor.commit();
}

@JavascriptInterface
public String loadSomeThing() {
  SharedPreferences preferences = getSharedPreferences("com.example.something", MODE_PRIVATE);
  String message = preferences.getString("somethingID", "");
  return message;
}</pre><b class="article__selection">В layout`е главного activity обычно много лишнего</b><p class="article__paragraph">Для одного WebView во весь экран нам столько не надо. Можно сократить, оставив:</p><pre class="article__code">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;WebView xmlns:android="http://schemas.android.com/apk/res/android"
  android:id="@+id/webview"
  android:layout_width="fill_parent"
  android:layout_height="fill_parent"
  android:scrollbars="none" /&gt;</pre><b class="article__selection">Отправили СМС без сим-карты. СМС`ка не ушла, а callback вернул true</b><p class="article__paragraph">Если вы используете PhoneGap, возможно, модуль отправки СМС под Android написан криво (во всяком случае, мы столкнулись с такой проблемой). Он возвращает true при любом исходе. Чтобы реализовать это нормально, прокинем мост для отправки СМС с Java в JavaScript:</p><pre class="article__code">@JavascriptInterface
public void sendSms(String phoneNumber, String message) {
  SmsManager sms = SmsManager.getDefault();
  sms.sendTextMessage(phoneNumber, null, message, sendSmsPendingIntent, null);
}</pre><p class="article__paragraph">И добавим метод в класс MainActivity:</p><pre class="article__code">private PendingIntent registerSentSmsReceiver() {
  String SENT = "SMS_SENT";
  PendingIntent sentPI = PendingIntent.getBroadcast(MainActivity.this, 0, new Intent(SENT), 0);
  sendSmsReceiver = new BroadcastReceiver() {
    public void onReceive(Context arg0, Intent arg1) {
      switch (getResultCode()) {
        case Activity.RESULT_OK:
          vw.loadUrl("javascript: smsSend(true);");
          break;
        default:
          vw.loadUrl("javascript: smsSend(false);");
          break;
      }
    }
  };
  registerReceiver(sendSmsReceiver, new IntentFilter(SENT));
  return sentPI;
}</pre><p class="article__paragraph">Чтобы приложение не вылетало с новым классом, нужно обновить onDestroy:</p><pre class="article__code">@Override
public void onDestroy() {
  super.onDestroy();
  if (sendSmsReceiver != null) {
    unregisterReceiver(sendSmsReceiver);
  }
}</pre><p class="article__paragraph">Помните, sendSmsReceiver всегда нужно разрегистрировать при дестрое.</p><p class="article__paragraph">Прошу прощения за кривые моменты на Java в тексте выше, т.к. все-таки мой профиль JavaScript. Касательно самих телефонов — есть ещё один момент, о котором веб-разработчики, как правило, не знают. У каждого телефона есть свой уникальный идентификатор — IMEI (если, конечно, это не «серая» поделка из Китая). Зная этот IMEI, вы можете точно определять пользователей. Например, его можно использовать при быстрой авторизации, когда нужно быстро идентифицировать пользователя, не задавая лишних вопросов, или при синхронизации устройств.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="mYmmk"></a><h2 class="article__subtitle">Хэш-контроллеры</h2><p class="article__paragraph">Хэш — это часть URL-адреса после знака #. Эту часть можно менять, не перезагружая страничку. Изначально своим появлением он обязан якорным ссылкам, а позже стал активно использоваться в JavaScript.</p><p class="article__paragraph">Хэш используют SPA-приложения, чтобы иметь возможность:</p><ul class="article__list"><li class="article__list_item">Откатиться к предыдущему виду при нажатии на кнопку назад</li><li class="article__list_item">Иметь возможность по URL восстановить заданный вид</li></ul><p class="article__paragraph">Многие MVC-фреймворки имеют в своем составе хэш-контроллеры, которые записывают данные в хэш и следят за его обновлением. Какие же ошибки при этом допускают разработчики?</p><b class="article__selection">СЕО</b><p class="article__paragraph">Распространенной ошибкой является использование в начале хэша # вместо #!. Разница в том, что последний вариант сообщает поисковикам о том, что они имеют дело со SPA, а не обычными якорными ссылками на странице. Соответственно, если поисковик поддерживает механизм индексации HTML-приложений, обнаружив на странице метку SPA в хэше, он запустит механизм и попытается проиндексировать страницу, учитывая работу скриптов.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример проиндексированного SPA." data-url="images/hash__yandex.jpg"><figcaption class="article__image_explanation">Рис. 70. Пример проиндексированного SPA.</figcaption></figure><b class="article__selection">Параметры</b><p class="article__paragraph">Передавать в хэше строку параметров является более расширяемым в перспективе решением, чем передача определенного адреса.</p><p class="article__paragraph">#!/game/menu/option/334/ — трудно масштабировать, т.к. параметры зависят от последовательности: </p><p class="article__paragraph">#!view=option&amp;id=334 — легко масштабировать, т.к. нет строгой последовательности, а следовательно, обязательности присутствия или отсутствия составных частей: </p><b class="article__selection">Обратный ход</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Переключение между различными экранами в карточной игре." data-url="images/hash__bug.jpg"><figcaption class="article__image_explanation">Рис. 71. Переключение между различными экранами в карточной игре.</figcaption></figure><p class="article__paragraph">Представьте, что у нас есть некая игра с меню. Посмотрим на типичный путь пользователя к настройкам:</p><pre class="article__code">Игра -&gt; Меню -&gt; Настройки </pre><p class="article__paragraph">Если в данный момент он начнет нажимать кнопку «Назад», то откатится к экрану «Игра». Но если вместо кнопки назад он будет использовать стандартные кнопки интерфейса нашей игры, тогда будет пройден полный путь:</p><pre class="article__code">Игра -&gt; Меню -&gt; Настройки -&gt; Меню -&gt; Игра</pre><p class="article__paragraph">Если в данный момент он начнет нажимать кнопку «Назад», то откатится к экрану «Меню», хотя по логике не должен. Если это приложения для Android, то по кнопке «Назад» на экране «Игра» пользователь должен выйти из приложения. Ещё хуже, если мы использовали экран сообщения:</p><pre class="article__code">Игра -&gt; Меню -&gt; Настройки -&gt; «Настройки сохранены!» -&gt; Игра</pre><p class="article__paragraph">При откате назад у пользователя откроется окно сообщения.</p><b class="article__selection">Как решить проблему</b><p class="article__paragraph">Решить проблему очень легко. Достаточно добавить некий статус пользовательских изменений хэша и передавать его всем слушателям изменений. Если статус отрицательный — все хорошо, хэш был изменен программно самим приложением. Если статус положительный — хэш изменил пользователь и нужно проверить его адекватность.</p><b class="article__selection">Почему нельзя чистить историю</b><p class="article__paragraph">Зачищать историю изменений хэша тоже можно, но «History API» не везде работает. Поэтому передача статуса является более надежным способом.</p><b class="article__selection">Нюансы</b><p class="article__paragraph">Очень часто на страницу может вести несколько редиректов. В этом случае важно, чтобы модуль отвечающий за работу с URL`ом мог вытаскивать параметры не только из хэша, но и из основной части адреса и совмещать их (при редиректе через .htaccess нельзя задать хэш, поэтому параметры пишут в основной части адреса). Например, при запросе вида:</p><pre class="article__code">/game/?id=100</pre><p class="article__paragraph">модуль не должен дублировать параметры в хэше:</p><pre class="article__code">/game/?id=100#!id=100</pre><p class="article__paragraph">т.к. при одном и том же параметре, мы получим две записи в истории. Это приведет к багу, когда пользователь нажмет кнопку «назад», URL изменится, а состояние страницы останется прежним. Этот баг часто можно встретить в мобильных приложениях на HTML5.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="WWUhw"></a><h1 class="article__header">Мелкие оптимизации и костыли</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="RHwvY"></a><h2 class="article__subtitle">Уменьшение вложенности</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример многократной вложенности с сайта «ГовноКод»" data-url="images/review_if.jpg"><figcaption class="article__image_explanation">Рис. 72. Пример многократной вложенности с сайта «ГовноКод»</figcaption></figure><p class="article__paragraph">В JavaScript есть проблема излишних вложений. Это, в свою очередь, побуждает разработчиков страдать. В большинстве случаев вложенность можно сильно сократить, если правильно структурировать код и не допускать больше одной задачи на функцию. Кроме того, есть несколько моментов, которые обычно забывают разработчики.</p><b class="article__selection">Выкидывайте из функции, если что-то пошло не так</b><p class="article__paragraph">Плохо:</p><pre class="article__code">function (id) {
  var node = document.getElementById(id);
  if(node) {
    node.innerHTML = "Hello world!";
    ...
  }
}</pre><p class="article__paragraph">Хорошо:</p><pre class="article__code">function (id) {
  var node = document.getElementById(id);
  if(!node) return false;
  node.innerHTML = "Hello world!";
  ...
}</pre><b class="article__selection">Пропускайте итерацию цикла, если что-то пошло не так</b><p class="article__paragraph">Плохо:</p><pre class="article__code">for(var i = 0, l = games.length; i &lt; l; i++) {
  var item = games[i];
  if(!item.isAdult) {
    item.render();
    ...
  }
}</pre><p class="article__paragraph">Хорошо:</p><pre class="article__code">for(var i = 0, l = games.length; i &lt; l; i++) {
  var item = games[i];
  if(item.isAdult) continue;
  item.render();
}</pre></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="KWrmn"></a><h2 class="article__subtitle">Текстовые вставки в код</h2><p class="article__paragraph">Чтобы код был чистым и понятным, следует разделять технологии и уменьшать их разнообразие в проекте. К сожалению, на практике HTML, CSS и JavaScript очень часто оказываются перемешаны между собой. Старайтесь этого не допускать, но если вам по какой-либо причине приходится делать HTML или CSS вставки в JavaScript, то, по крайней мере, это можно сделать красиво и сохранить форматирование. Рассмотрим задачу на вставку куска HTML кода в документ и её решение.</p><p class="article__paragraph">Как это обычно делают на практике:</p><pre class="article__code">var title = "Заголовок",
  description = "Содержание",
  template = "&lt;article&gt;&lt;h1&gt;{TITLE}&lt;/h1&gt;&lt;p&gt;{DESCRIPTION}&lt;/p&gt;&lt;/article&gt;",
  text = template.replace("{TITLE}", title);
text = text.replace("{DESCRIPTION}", description);</pre><p class="article__paragraph">или вместо замены клеят строку:</p><pre class="article__code">var title = "Заголовок",
  description = "Содержание",
  text = "&lt;article&gt;&lt;h1&gt;" + title + "&lt;/h1&gt;&lt;p&gt;" + description + "&lt;/p&gt;&lt;/article&gt;";</pre><p class="article__paragraph">Но гораздо лучше использовать такой прием:</p><pre class="article__code">var title = "Заголовок",
  description = "Содержание",
  text = [
    "&lt;article&gt;",
    "  &lt;h1&gt;", title, "&lt;/h1&gt;",
    "  &lt;p&gt;", description, "&lt;/p&gt;",
    "&lt;/article&gt;"
  ].join("");</pre><p class="article__paragraph">Код по-прежнему ужасен с точки зрения логики, но, по крайней мере, его стало легче осознавать при беглом просмотре. Пример выше демонстрирует преимущества массива вместо работы со строкой, а также преимущества отформатированного кода в шаблоне.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="wBSrS"></a><h2 class="article__subtitle">Ресайз</h2><p class="article__paragraph">Изменение размеров элементов страницы — одна из самых частых проблем при создании адаптивного дизайна.</p><ul class="article__list"><li class="article__list_item">Отличным решением является верстка резиновыми блоками, которые сами подстраиваются под размер окна.</li><li class="article__list_item">Менее масштабируемый вариант — это подключение специальных стилей для диапазона экранов.</li><li class="article__list_item">Жесткая «попиксельная» верстка макета является самым плохим вариантом, т.к. не поддается безболезненным изменениям.</li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="LDIeg"></a><h2 class="article__subtitle">Зачем использовать EM вместо PX?</h2><p class="article__paragraph">Если вам по какой-либо причине приходится устанавливать точный размер, например, ограничить максимальную ширину блока, то лучше задать её в em:</p><pre class="article__code">.article {
  width: 100%;
  max-width: 60em;
  font-size: 0.8em;
}</pre><p class="article__paragraph">В данном случае, если нам необходимо будет уменьшить максимальную ширину и шрифт, достаточно будет изменить только один параметр:</p><pre class="article__code">@media screen and (max-width: 700px) {
  .article {
    font-size: 70%;
  }
}</pre><p class="article__paragraph">Em — величина относительная, и её можно изменять. 1em = 16px при font-size = 100%. Чем меньше font-size, тем меньше em. Более того, если вся страница рассчитана в em, можно одной строкой уменьшить все элементы:</p><pre class="article__code">body {
  font-size: 60%;
}</pre><p class="article__paragraph">При верстке макетов желательно выбирать «ровные» целые значения, которые без остатков можно переводить в px и обратно. Таблицу этих значений вы можете найти в приложении.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="oInCp"></a><h2 class="article__subtitle">Вставка CSS через JS</h2><p class="article__paragraph">Так или иначе, может возникнуть ситуация, когда вам придется использовать JavaScript для вычисления каких-либо размеров относительно экрана (например, выбрать минимальный размер по вертикали или горизонтали). Использовать JavaScript для определения стилей плохо, но иногда эту задачу приходится выполнять.</p><p class="article__paragraph">Как это обычно делают на практике:</p><pre class="article__code">var size = 100,
  node = document.getElementById("main");
if(node) node.style.width = size + "px";</pre><p class="article__paragraph">Чем больше элементов нам надо изменить, тем грязнее будет получаться код при таком подходе. Гораздо лучше будет подход, при котором часть CSS-стилей будет сгенерирована динамически.</p><p class="article__paragraph">Добавим в HTML пустой тег стилей:</p><pre class="article__code">&lt;style id="style"&gt;&lt;/style&gt;</pre><p class="article__paragraph">Заполним его в JavaScript`е, определив какой-нибудь модуль для ресайза страницы:</p><pre class="article__code">var size = 100,
  node = document.getElementById("style");
if(node) node.innerHTML = [
  ".header,",
  ".article {",
  "  line-height: ", size, "%;",
  "  max-width:   ", size, "px;",
  "  font-size:   ", size, "px;",
  "}"
].join("");</pre><p class="article__paragraph">Плюсы метода:</p><ul class="article__list"><li class="article__list_item">Он отрабатывает быстрее, т.к. у нас всего две операции с DOM вне зависимости от количества изменений.</li><li class="article__list_item">Он более нагляден и прост для беглого ознакомления с кодом.</li><li class="article__list_item">Если все «костыли», связанные с генерацией CSS в JS-коде, будут собраны в одном месте, то в них будет проще разобраться.</li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="cUsms"></a><h2 class="article__subtitle">Конечные автоматы на CSS</h2><b class="article__selection">Задача</b><p class="article__paragraph">У нас есть два блока. Необходимо, использовав минимум действий, осуществить переключение видимости с одного блока на другой.</p><b class="article__selection">Решение</b><p class="article__paragraph">Классическое решение данной задачи предполагает использование конечных автоматов на CSS. Блоку-родителю присваивается некий класс, а все остальные элементы меняют свое состояние благодаря CSS-селекторам.</p><p class="article__paragraph">HTML:</p><pre class="article__code">&lt;div class="show_a"&gt;
  &lt;div class="block_a"&gt;Блок A&lt;/div&gt;
  &lt;div class="block_b"&gt;Блок B&lt;/div&gt;
&lt;/div&gt;</pre><p class="article__paragraph">CSS:</p><pre class="article__code">.block_a,
.block_b {
  display: none
}

.show_a &gt; .block_a {
  display: block;
}

.show_b &gt; .block_b {
  display: block;
}</pre><p class="article__paragraph">Метод дает очевидное преимущество в том, что нам надо выполнить всего одно действие с DOM - изменить класс родительского элемента. Все остальные операции скрытия/показа выполнит CSS.</p><p class="article__paragraph">На практике схема нежизнеспособна, т.к. имеет следующие недостатки:</p><ul class="article__list"><li class="article__list_item">У нас есть каскад, а если следовать БЭМ, его быть не должно.</li><li class="article__list_item">Чем больше блоков будет участвовать в схеме, тем больше будет CSS, тем труднее будет его изменять и осознавать. Даже при условии, что CSS типовой и вы будете его генерировать в JavaScript (что тоже плохо, т.к. смешивание технологий ни к чему хорошему не ведет), с генерацией у вас будет увеличение CSS-кода, а количество кода не должно зависеть от количества элементов.</li></ul><b class="article__selection">Альтернативное решение</b><p class="article__paragraph">Мы можем сохранить ссылки на все элементы списка и при переключении видимых блоков делать следующее:</p><ul class="article__list"><li class="article__list_item">Видимому блоку ставить класс block__show</li><li class="article__list_item">Прошлому видимому блоку ставить класс block__hidden</li></ul><p class="article__paragraph">Избегайте перебора всех блоков, т.к. при увеличении их количества скрипт будет замедляться. Ваша задача — точечно выполнить только две операции «скрыть» / «показать».</p><p class="article__paragraph">HTML:</p><pre class="article__code">&lt;div&gt;
  &lt;div id="block_a" class="block__show"&gt;Блок A&lt;/div&gt;
  &lt;div id="block_b" class="block__hidden"&gt;Блок B&lt;/div&gt;
&lt;/div&gt;</pre><p class="article__paragraph">CSS:</p><pre class="article__code">.block__hidden {
  display: none
}

.block__show {
  display: block;
}</pre></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="VtPWv"></a><h2 class="article__subtitle">Правила работы с DOM</h2><p class="article__paragraph">Как уже было сказано выше, отрисовка интерфейса — это маленькая задача большой системы. Но от того, как мы её решим, зависит работа всего приложения в целом.</p><p class="article__paragraph">Несмотря на то, что правила, изложенные ниже, были уже неоднократно озвучены самыми разными авторами, тем не менее огромное количество разработчиков продолжают их игнорировать. Если по какой-либо причине вы работаете с DOM, не забывайте хотя бы пытаться делать ваш интерфейс быстрым.</p><b class="article__selection">Сохраняйте ссылки на элементы</b><p class="article__paragraph">Обращение к DOM — очень медленная процедура. Стремитесь делать это как можно реже. При инициализации модулей делайте поиск элементов по ID и сохраняйте ссылки, чтобы в следующий раз больше не искать.</p><p class="article__paragraph">Пример:</p><pre class="article__code">var module = {
  _node: null,
  A: function() {
    var node = this._node;
    if(node) node.innerHTML = "Hello!";
  },
  B: function() {
    var node = this._node;
    if(node) node.className = "message__show";
  },
  init: function() {
    this._node = document.getElementById("message");
  }
};
module.init();
module.A();
module.B();</pre><b class="article__selection">Проверяйте необходимость изменений</b><p class="article__paragraph">Обычно это правило касается изменения стилей и атрибутов элемента. В примере выше, перед вставкой сообщения и изменения класса, было бы неплохо добавить проверку последнего присвоенного сообщения и класса. Вполне возможно, что класс уже присвоен, а сообщение уже вписано, — тогда нам вообще не стоит дергать наш DOM-элемент. Что же касается производительности — то любая проверка предыдущих значений всегда отработает в разы быстрее, чем обращение к DOM и установка новых значений.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Если вы реализовываете отрисовку некой игры через DOM, то проверить необходимость изменений особенно важно, т.к. это может значительно увеличить скорость рендера.  Зная предыдущие координаты объектов на картинке, мы можем не обращаться к свойству style.top и style.bottom для объекта гриба, т.к. он передвигается только в горизонтальной плоскости." data-url="images/game_render_register_2.jpg"><figcaption class="article__image_explanation">Рис. 73. Если вы реализовываете отрисовку некой игры через DOM, то проверить необходимость изменений особенно важно, т.к. это может значительно увеличить скорость рендера.  Зная предыдущие координаты объектов на картинке, мы можем не обращаться к свойству style.top и style.bottom для объекта гриба, т.к. он передвигается только в горизонтальной плоскости.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="huBkF"></a><h2 class="article__subtitle">БЭМ</h2><p class="article__paragraph">БЭМ — это методология верстки, разработанная в компании Яндекс. По сути, это набор правил и рекомендаций, соблюдение которых позволит вам писать модульный HTML и CSS-код. А модульный код, в свою очередь, не только значительно упростит поддержку старых проектов, но и позволит быстрее создавать новые, за счет переиспользования ресурсов.</p><p class="article__paragraph">Суть методологии заключается в том, чтобы разделить элементы страницы на независимые модули. Каждому модулю отводится свой уникальный префикс CSS-класса. Таким образом, мы обеспечиваем гарантию того, что названия классов уникальны и не пересекаются. Каждый модуль состоит из отдельных элементов. Каждому элементу соответствует свой CSS-класс, название которого начинается с префикса модуля. Например:</p><pre class="article__code">&lt;nav class="menu"&gt;
  &lt;a class="menu__item" href="#"&gt;Пункт 1&lt;/a&gt;
  &lt;a class="menu__item" href="#"&gt;Пункт 2&lt;/a&gt;
&lt;/nav&gt;</pre><p class="article__paragraph">Т.к. каждый элемент обладает своим классом, мы можем свободно переставлять их местами без опасения нарушить каскад стилей. Также отсутствие каскада стилей позволяет значительно ускорить рендер страницы. Кроме того, при внесении правок в документ мы можем забыть о поиске перекрывающих друг друга селекторов, т.к. все стили элемента находятся в одном месте и перебиваются изменением всего лишь одного класса.</p><p class="article__paragraph">Если мы вынесем код модуля в отдельный CSS, JS и HTML-файл, мы также сможем очень быстро решать возникающие ошибки, т.к. будем точно знать, в каких файлах находится код, отвечающий за конкретный модуль. Кроме того, уменьшится и количество самих ошибок, т.к. код будет хорошо структурирован и разбит на небольшие части, которые легко осознавать даже при беглом просмотре.</p><p class="article__paragraph">Также, получив независимые модули, мы можем переиспользовать их в других проектах, сокращая время разработки. Обычно в таких случаях следует разделять CSS-код на отвечающий за поведение модуля и за цветовое оформление, т.к. у разных проектов — разный стиль. Подключая те или иные стили, мы можем быстро менять оформление. Для этого рекомендуется писать дополнительные классы-модификаторы, которые могут корректировать представление элементов модуля.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример многократного переиспользования модуля сообщений в разных проектах." data-url="images/review_bem_1.jpg"><figcaption class="article__image_explanation">Рис. 74. Пример многократного переиспользования модуля сообщений в разных проектах.</figcaption></figure><p class="article__paragraph">Несмотря на то, что на первом этапе разработка может немного замедлиться, спустя непродолжительный отрезок времени она ускорится. И чем больше типовых элементов вы используете, тем быстрее она станет. Кроме того, исправляя ошибки в модулях текущих проектов, вы сможете без труда обновлять старые разработки, заменяя в них лишь код соответствующих модулей.</p><p class="article__paragraph">Одним из недостатков, которые ставят БЭМ — является наличие очень длинных классов. Но эта проблема решается благодаря использованию соответствующего инструментария.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="PywoZ"></a><h2 class="article__subtitle">JS в PNG</h2><p class="article__paragraph">JavaScript код можно запаковать в PNG-изображение. Таким образом, мы можем очень сильно сжать данные с одной стороны, но потратить много времени на декодирование с другой. Этот трюк применяют участники различных конкурсов, вроде 10KJS, которые ограничены в размере кода, но не ограничены с точки зрения требований к быстродействию.</p><b class="article__selection">Почему именно PNG?</b><p class="article__paragraph">Формат изображения должен иметь сжатие без потерь, чтобы все наши данные остались невредимы. Поэтому из трех потенциальных претендентов (JPG, PNG, GIF) остается только два (PNG, GIF). Если рассматривать GIF и 8-битный PNG, то PNG весит намного меньше. 24-битный PNG нам не подойдет, т.к. он может хранить до 3-х байт на 1 пиксель картинки.</p><b class="article__selection">Как кодировать данные?</b><p class="article__paragraph">Один пиксель изображения соответствует одной букве нашего JavaScript кода. Одна буква — это номер символа ASCII (от 0 до 255). Вы можете найти в интернете скрипты на PHP, которые делают эту операцию автоматически. Если же вы получите на выходе 24-битный PNG, то вам поможет Adobe Photoshop, который конвертирует изображение в 8-битное.</p><b class="article__selection">Как декодировать данные?</b><p class="article__paragraph">С помощью элемента canvas необходимо нарисовать изображение, используя метод drawImage(). Далее можно прочитать каждый пиксель, используя метод getImageData(). Полученные данные являются большим массивом значений ASCII-кодов. Эти коды можно преобразовать в строку, подставив соответствующие символы, и выполнить строку, передав её функции eval().</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="xNpsl"></a><h2 class="article__subtitle">Сжатие кода</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример «супер» сжатого кода: шахматы (1024 байт), анимация 3D города (1024 байт), тетрис (140 байт)." data-url="images/review_zip_1.jpg"><figcaption class="article__image_explanation">Рис. 75. Пример «супер» сжатого кода: шахматы (1024 байт), анимация 3D города (1024 байт), тетрис (140 байт).</figcaption></figure><p class="article__paragraph">Есть много разных конкурсов, участникам которых требуется написать некий скрипт использовав ограниченное количество символов. Например, 10kb JS, 1kb JS и 140b JS. Участники используют различные трюки, чтобы уложится в ограничение. Рассмотрим некоторые из них.</p><p class="article__paragraph">Добавляйте переменную в аргументы вместо var</p><pre class="article__code">function() { var a = ... } // до
function(a) { a = ... }  // после</pre><p class="article__paragraph">Переиспользуйте переменные вместо создания новых.</p><p class="article__paragraph">Присваивайте внутри условия if:</p><pre class="article__code">a = ...; if(a) { } // до
if(a = ...) { }  // после</pre><p class="article__paragraph">Используйте логику внутри условий цикла, а не в его теле:</p><pre class="article__code">var b = 5;
for(var i = 0; i &lt; 5; i++) {
  b = b + i;
}
for(var i = 0, b = 5; i &lt; 5; i++, b+=i);</pre><p class="article__paragraph">Делайте проверку без if:</p><pre class="article__code">if(callback) { callback(); } // до
callback &amp;&amp; callback();    // после</pre><p class="article__paragraph">Используйте запятую для последовательного выполнения операторов вместо блока:</p><pre class="article__code">with(document) { open(); write("xss"); close(); } // до
with(document)open(),write("xss"),close()     // после</pre><p class="article__paragraph">Используйте ~~ или 0| вместо Math.floor:</p><pre class="article__code">var x = Math.floor(Math.random()*10); // до
var x = 0|Math.random()*10;       // после</pre><p class="article__paragraph">Используйте экспоненциальный формат для больших круглых чисел:</p><pre class="article__code">million = 10000000; // до
million = 1e7;    // после</pre><p class="article__paragraph">Используйте ~, чтобы изменить любое значение на единицу. В сочетании с унарным минусом это дает возможность, например, инкрементировать любую, даже еще не определенную переменную:</p><pre class="article__code">// i = undefined
i=i||0;i++; // до
i=-~i;    // после</pre><p class="article__paragraph">Можно сэкономить два байта при разбиении строк методом split, если в качестве разделителя использовать нуль:</p><pre class="article__code">"alpha,bravo,charlie".split(","); // до
"alpha0bravo0charlie".split(0);   // после</pre><p class="article__paragraph">Когда необходимо вернуть что-то отличное от переменной, ставить пробел после return не обязательно:</p><pre class="article__code">return .01; // до
return.01;  // после</pre><section class="article__note"><p class="article__paragraph_note">Если вас заинтересовала данная тема, более подробную информацию можно найти у следующих авторов:</p><ul class="article__list_note"><li class="article__list_item_note">Джед Шмидт, Томас Фухс и Дастин Диаз<br><a href="https://github.com/jed/140bytes/wiki/Byte-saving-techniques" class="article__link_note">https://github.com/jed/140bytes/wiki/Byte-saving-techniques</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="AGTsQ"></a><h2 class="article__subtitle">Защита от сервера</h2><p class="article__paragraph">При работе без перезагрузки страницы приходится постоянно получать данные от сервера с помощью AJAX. Для создания стабильного приложения нужно быть готовым к тому, что сервер либо вообще не отдаст данные, либо вернет их в неправильном формате, либо данные окажутся отравлены каким-либо XSS. Поэтому в критических точках лучше использовать не просто проверку вывода, вроде:</p><pre class="article__code">element.innerHTML = title || "";</pre><p class="article__paragraph">А дополнительный фильтр на валидность, c заданными ограничениями, например:</p><pre class="article__code">element.innerHTML = removeXSS((title || ""));
element.innerHTML = getString(title, 0, 140, /[A-Za-z]+/gim) || "";</pre><p class="article__paragraph">Некоторое время назад я столкнулся с необычной проблемой. Мне нужно было написать небольшой книжный магазин в качестве одного из подразделов большого мобильного портала. Проблема заключалась в том, что обложки книг, которые приходили с сервера, были разного формата. Наш сервер был последним в длинной цепочке серверов различных издательств, которые поставляли контент автоматически. Повлиять на данные я не мог, а перед серверным программистом и так стояли намного более важные задачи.</p><p class="article__paragraph">В таких ситуациях картинки обычно вставляют в DIV и делают overflow: hidden. Например:</p><pre class="article__code">&lt;div&gt;
  &lt;img src="cover.png"/&gt;
&lt;/div&gt;</pre><pre class="article__code">div {
  width: 5em;
  height: 5em;
  overflow: hidden;
}

img {
  width: 100%;
}</pre><p class="article__paragraph">Но в этот раз я использовал другой подход:</p><ul class="article__list"><li class="article__list_item">Вместо реальных обложек подставлял однопиксельные прозрачные PNG.</li><li class="article__list_item">Растягивал, средствами CSS, картинки до нужных мне размеров.</li><li class="article__list_item">Заливал прозрачные PNG фоном через background-image. В качестве фона — ставил оригинальные обложки.</li></ul><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Приведение картинок к одному формату." data-url="images/review_protection_1.jpg"><figcaption class="article__image_explanation">Рис. 76. Приведение картинок к одному формату.</figcaption></figure><pre class="article__code">&lt;img src="1px.png"/&gt;</pre><pre class="article__code">img {
  width: 5em;
  background-image: url("cover.png");
  background-position: center center;
  background-size: auto 100%;
  background-repeat: no-repeat;
}</pre><p class="article__paragraph">Таким образом, можно не только задать всем обложкам одинаковый размер, но и, меняя форму прозрачного PNG-основания, пробовать разные соотношения сторон, без необходимости задавать одновременно два параметра (высота, ширина). Кроме того, если какая-либо обложка не будет загружена, пользователь не увидит никакой ошибки или перекосов в верстке. А также можно легко накладывать полупрозрачные водяные знаки (в нашем случае это была пиктограмма аудиокниг). Кроме того, те, кто стараются защитить материал от копирования, заметят, что при попытке простого сохранения или копирования, как изображения, так и всей страницы, пользователь сохранит только прозрачную основу, а не саму картинку.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Примеры использования разных основ для создания водяных знаков." data-url="images/review_protection_2.jpg"><figcaption class="article__image_explanation">Рис. 77. Примеры использования разных основ для создания водяных знаков.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="UHghQ"></a><h2 class="article__subtitle">Данные через CSS</h2><p class="article__paragraph">Кроме стандартных AJAX-запросов (XmlHttpRequest), разработчикам иногда нужно пригнать данные в труднодоступные места (на другой домен или IE6). Есть несколько способов это сделать. Например, вы можете использовать «плавающие фреймы». Подробную информацию об этом можно найти в книге «Ajax для профессионалов» (авторы Николас Закас, Джереми Мак-Пик, Джо Фосетт). Но также есть весьма необычные способы получить данные, которые, возможно, расширят ваш кругозор.</p><p class="article__paragraph">Подключаем стили:</p><pre class="article__code">&lt;link href="css/default.css" rel="stylesheet" type="text/css"/&gt;</pre><p class="article__paragraph">Вешаем событие load и ждем, пока стили будут загружены. Далее получаем такой код:</p><pre class="article__code">#id {
  background-image: url("about:blank#Hello");
}</pre><p class="article__paragraph">или</p><pre class="article__code">#id {
  background-image: url("about:blank?Hello");
}</pre><p class="article__paragraph">Затем находим элемент с заданным id и через DOM достаем все, что находится в element.style.backgroundImage после about:blank.</p><b class="article__selection">Данные через IMG</b><p class="article__paragraph">Метод основан на трюке «JS в PNG». Создаете тег IMG и вешаете на него событие load. В атрибут src записываете адрес сервера, от которого ждем данные. Далее с сервера подгружается PNG-картинка, которую можно поместить в canvas и через getImageData() получить её содержимое. Осталось только декодировать.</p><p class="article__paragraph">Все способы, описанные выше, обладают целым набором минусов и приведены лишь в справочных целях.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше о способах передачи данных с сервера на клиент вы можете у следующих авторов:</p><ul class="article__list_note"><li class="article__list_item_note">Ajax для профессионалов<br>Professional Ajax.<br>Nicholas C. Zakas, Jeremy McPeak, Joe Fawcett<br><br></li><li class="article__list_item_note">Статья «Мирный XSS»<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/46339/" class="article__link_note">http://habrahabr.ru/post/46339/</a><br><br></li><li class="article__list_item_note">Статья «Рекламный баннер = поставщик данных»<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/106202/" class="article__link_note">http://habrahabr.ru/post/106202/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="UdIEK"></a><h2 class="article__subtitle">Игра в 0 строк кода</h2><p class="article__paragraph">Минимизация кода — это хорошо, а его отсутствие ещё лучше. Осенью 2013 года на сайте <a href="http://habrahabr.ru/" class="article__link">http://habrahabr.ru/</a> стали появляться статьи различных авторов, которые соревновались в написании приложений на JavaScript, при условии, что размер кода не должен превышать 30 строк. Т.к. 30 строк — величина не фиксированная (количество символов в строке было не ограничено), то с каждой новой статьей градус неадеквата только повышался. Безумная неделя окончилась публикацией саркастической статьи «Hello world в 1 строчку на чистом JavaScript», в которой автор, c ником theaqua, выложил следующий код:</p><pre class="article__code">document.write('Hello world!')</pre><p class="article__paragraph">Но пользователь с ником 0xy (Александр Майоров) решил его превзойти и написал игру в ноль строк на JS.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Скриншоты оригинальной игры." data-url="images/review_zero_1.jpg"><figcaption class="article__image_explanation">Рис. 78. Скриншоты оригинальной игры.</figcaption></figure><p class="article__paragraph">Игрок управляет космическим кораблем. Его задача — не столкнуться с кораблями компьютера, летящими навстречу. Игра полностью основана на различных CSS-свойствах. Давайте разберем её подробнее.</p><p class="article__paragraph">Корабль игрока, который летит вслед за мышью, на самом деле является её курсором. Внешний вид курсора мышки можно изменить свойством</p><pre class="article__code">cursor: url("cursor.png");</pre><p class="article__paragraph">Корабли компьютера летят с помощью CSS-анимации, но т.к. их много и для каждого заложена своя траектория, ощущения повтора не возникает. Кроме того, корабли находятся внутри игрового поля с псевдоклассом :hover. Таким образом, когда пользователь уводит мышку с поля, корабли исчезают и игра, как бы, перезапускается при возвращении мышки на поле (CSS-анимация начинает проигрываться сначала).</p><pre class="article__code">&lt;div class="board"&gt;
  &lt;p class="enemy"&gt;&lt;/p&gt;
&lt;/div&gt;</pre><pre class="article__code">.board:hover .enemy {
  ...
}</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="В консоли вы можете увидеть структуру верстки игры." data-url="images/review_zero_2.jpg"><figcaption class="article__image_explanation">Рис. 79. В консоли вы можете увидеть структуру верстки игры.</figcaption></figure><p class="article__paragraph">Бонусы представляют собой замаскированные input-элементы типа radio. При клике на такой input — его внешний вид меняется. В состоянии :checked он перестает позиционироваться относительно всей доски и остается в поле очков.</p><p class="article__paragraph">При столкновении с другим кораблем показывается заставка «Game Over!», которая остается до момента, пока пользователь не уберет мышку с игрового поля и не перезапустит тем самым игру. Столкновением на уровне CSS считается наведение курсора мышки на элемент корабля противника. В этом случае отрабатывает селектор :hover и растягивает элемент корабля противника на все поле. Таким образом, мышка остается на нем всегда, пока она в зоне игрового поля. Надпись «Game Over!» выводится через псевдоэлемент:</p><pre class="article__code">.board:hover .enemy:hover {
  background: #ffa500;
  ...
}

.board:hover .enemy:hover:after {
  content: "Game Over!";
}</pre><p class="article__paragraph">Музыка в игре проигрывается через элемент audio.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше можно тут:</p><ul class="article__list_note"><li class="article__list_item_note">Статья «Игра в 0 строк кода на чистом JS»<br>Александр Майоров<br><a href="http://habrahabr.ru/post/203048/" class="article__link_note">http://habrahabr.ru/post/203048/</a><br><br></li><li class="article__list_item_note">Оригинальная игра<br><a href="http://nojsgame.majorov.su/" class="article__link_note">http://nojsgame.majorov.su/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="OwNLh"></a><h2 class="article__subtitle">JSON запросов и параметров</h2><p class="article__paragraph">Очень часто при разработке небольших онлайн-игр делают «жирный» клиент и пишут множество простых запросов к серверу. Задача сервера в таких играх сводится к простому хранению информации об игроках и выдачи каких-то параметров из базы данных. При разработке сервера на NodeJS очень часто код плохо структурирован. Одним из способов упорядочить запросы на сервере является использование JSON-объекта для создания API. Рассмотрим это на примере:</p><pre class="article__code">{
  scoring: {
/* Метод */
  get: {
/* Запрос */
    query: "SELECT * FROM score LIMIT $1, $2;"
/* Параметры запроса */
    parameters: [ "limit", "offset" ]
  },
  set: {
    query: "INSERT INTO score (user_id, score, date) VALUES ($1, $2, now());",
    parameters: [ "id", "score" ]
  }
  },
  profile: {
  get: {
    query: "SELECT * FROM users WHERE id = $1;",
    parameters: [ "id" ]
  }
  }
}</pre><p class="article__paragraph">Для объекта выше необходимо написать функцию, которая сгенерирует объект вида:</p><pre class="article__code">API.scoring.get();
API.scoring.set();
API.profile.get();</pre><p class="article__paragraph">И уже этот объект привязывать к роутеру. Это сделает код намного более чистым и понятным. Кроме того, на него будет очень легко написать документацию. Я не привожу пример использования какого-либо фреймворка для этой цели, т.к. стек технологий на сервере разный в разных фирмах. Для работы с подобным объектом вам в любом случае понадобится писать небольшую обвязку, поверх чего-либо, для обработки запросов и работы с базой. Кроме того, возможно, в момент, когда вы будете читать эти строки, уже будет несколько готовых фреймворков для этой задачи.</p><p class="article__paragraph">Многие разработчики также забывают делать проверку входных параметров. Это довольно опасно. Для повторяющихся входных параметров также можно написать JSON-объект с настройками проверки:</p><pre class="article__code">{
  id: {
  type: "number", // Тип переменной
  min: 1,       // Минимальное значение.
            // В случае строки — минимальная длина.
  max: 100000,    // Максимальное значение.
            // В случае строки — максимальная длина.
  regexp: /[0-9]+/gim  // RegExp для проверки
  },
  score: {
  type: "number",
  min: 50,
  max: 1000,
  regexp: /[0-9]+/gim
  }
}</pre><p class="article__paragraph">Если же параметр уникальный и встречается только в конкретном запросе, тогда его настройки можно положить прямо в массив с параметрами, задав их на месте:</p><pre class="article__code">{
  chat: {
  message: {
    set: {
    query: "INSERT INTO messages (id, message, date) VALUES ($1, $2, now());",
    parameters: [
      "id",
      {
      name: "message", // Имя переменной
      type: "string",  // Тип переменной
      min: 3,      // Минимальная длина
      max: 140,      // Максимальная длина
      regexp: /[А-Яа-яA-Za-z.,:!?]+/gim
      }
    ]
    }
  }
  }
}</pre><p class="article__paragraph">Ваша функция обработки запросов должна сгенерировать функцию вида:</p><pre class="article__code">chat.message.set();</pre><p class="article__paragraph">которая, в свою очередь, будет ожидать от пользователя два параметра id и message, проверять их на соответствие указанным настройкам и в случае соответствия — выполнять запрос к базе и возвращать ответ. Ещё одним преимуществом такого оформления запросов является возможность быстро перенести функционал сервера с одного языка, на другой, т.к. JSON-объекты являются, прежде всего, форматом хранения информации.</p><p class="article__paragraph">Также очень удобно хранить сложные запросы в виде массива строк:</p><pre class="article__code">{
  query: [
  "SELECT g.id, g.name, g.lang, f.url",
  "  FROM games_list as g",
  "  LEFT JOIN games_list_files as f ON g.id = f.game_id",
  "  WHERE",
  "  f.type = 1",
  "  AND g.hidden = false",
  "  AND g.lang LIKE "%ru%"",
  "  GROUP BY g.id, g.name, g.lang, f.url, f.id",
  "  ORDER BY f.id"
  ]
}</pre><p class="article__paragraph">При запросе к базе необходимо делать склейку таких массивов в одну строку (join). Если вы решите выводить запросы в консоль, то пробросив массив в console.dir вы увидите его в понятном читаемом виде, в отличие от запросов в одну строку.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример вывода в консоль запроса к базе: в одну строку и ввиде массива." data-url="images/review_query_1.jpg"><figcaption class="article__image_explanation">Рис. 80. Пример вывода в консоль запроса к базе: в одну строку и ввиде массива.</figcaption></figure><p class="article__paragraph">Т.к. у вашего приложения может быть множество клиентов (как интернет-сайт, так и мобильное приложение), будет неплохо, если во всех запросах будет некий параметр format, который укажет серверу на то, в каком виде необходимо отдать ответ. Например, json или xml. Кроме того, возможно, вам предстоит отойти от чистого REST API и использовать JSONP-формат и GET-запросы для того, чтобы независимые клиенты с разных доменов могли спокойно дергать API. В таком случае вам также следует добавить ещё один параметр по умолчанию — jsoncallback. И если он будет указан при запросе, возвращать клиенту ответ в обертке. Например:</p><p class="article__paragraph">Запрос JSONP:</p><pre class="article__code">/score/get?offset=0&amp;limit=10&amp;jsoncallback=score</pre><p class="article__paragraph">Ответ:</p><pre class="article__code">score({
  status: "ok",
  items: [
    ...
  ]
})</pre><p class="article__paragraph">Обычный AJAX-запрос:</p><pre class="article__code">/score/get?offset=0&amp;limit=10</pre><p class="article__paragraph">Ответ:</p><pre class="article__code">{
  status: "ok",
  items: [
    ...
  ]
}</pre><p class="article__paragraph">Формат запроса для мобильных клиентов, ожидающих XML:</p><pre class="article__code">/score/get?offset=0&amp;limit=10&amp;format=xml</pre><p class="article__paragraph">Ответ:</p><pre class="article__code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;response&gt;
  &lt;status&gt;ok&lt;/status&gt;
  &lt;items&gt;
    ...
  &lt;/items&gt;
&lt;/response&gt;</pre><p class="article__paragraph">Так же часто добавляют переменную message, которая содержит текст, поясняющий, почему сервер не вернул ответ и какие действия он ожидает от клиента. К сожалению, кроме пользы при разработке, это может принести вред в продакшне. Если какой-либо игрок решит найти уязвимость и начнет перебирать запросы — сервер сам будет подсказывать ему, какие параметры и с какими настройками он ожидает. В любом случае, вы также можете отключить этот функционал при продакшн-сборке.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="rphJw"></a><h2 class="article__subtitle">Модуль colors и консоль</h2><p class="article__paragraph">Если в NodeJS вывести в консоль строку вида «Hello world!» с управляющими ANSI-символами, она будет окрашена в разные цвета.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример использования управляющих ANSI-символов." data-url="images/review_console_1.jpg"><figcaption class="article__image_explanation">Рис. 81. Пример использования управляющих ANSI-символов.</figcaption></figure><p class="article__paragraph">Чтобы не запоминать подобные хаки, вы можете подключить модуль colors и использовать следующий синтаксис:</p><pre class="article__code">console.log("Error! Parameter ID not found.".red);</pre><p class="article__paragraph">Строка будет выведена красным цветом. При разработке с этим модулем вы можете раскрасить сообщения в консоли в различные цвета:</p><ul class="article__list"><li class="article__list_item">Красный (ошибка).</li><li class="article__list_item">Желтый (предупреждение).</li><li class="article__list_item">Зеленый (все хорошо).</li><li class="article__list_item">Серый. Им можно выводить какие-либо параметры (например, параметры запроса), на которые можно не обращать внимания, пока не поймаете ошибку.</li></ul><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Консоль до цветового выделения. При быстром просмотре информация воспринимается с трудом." data-url="images/review_console_2.jpg"><figcaption class="article__image_explanation">Рис. 82. Консоль до цветового выделения. При быстром просмотре информация воспринимается с трудом.</figcaption></figure><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Консоль после цветового выделения. При быстром просмотре информация воспринимается достаточно быстро." data-url="images/review_console_3.jpg"><figcaption class="article__image_explanation">Рис. 83. Консоль после цветового выделения. При быстром просмотре информация воспринимается достаточно быстро.</figcaption></figure><p class="article__paragraph">Благодаря раскрашенной консоли вам будет гораздо легче следить за состоянием сервера. Кроме того, если на одной инстансе у вас висит сразу несколько серверов, которые работают с разными процессами, вы также должны писать в модулях отдельные методы для вывода в консоль. Например:</p><pre class="article__code">var book = {
  console: function(message, color) {
    console.log(("Book API: " + (message || ""))[(color || "white")]);
  }
}</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Форматирование текста также упрощает восприятие информации." data-url="images/review_console_4.jpg"><figcaption class="article__image_explanation">Рис. 84. Форматирование текста также упрощает восприятие информации.</figcaption></figure><p class="article__paragraph">Таким образом, вся информация в консоли будет подписана, и вы легко сможете понять, какие события происходят в тех или иных модулях.</p><p class="article__paragraph">Опять же, цветовое выделение помогает в стрессовых ситуациях, когда отказала та или иная система и нужно срочно исправить ошибку, и вчитываться в логи нет времени (я не призываю вас дебажить на продакшне, просто всякое бывает).</p><p class="article__paragraph">В своих проектах я решил переписать модуль консоли, чтобы иметь возможность раскрашивать не только строки, но и массивы и объекты, а также автоматически подписывать все инстансы. Поэтому при подключении модуля я передаю ему имя пакета, которым следует подписывать сообщения. Пример использования нового модуля консоли:</p><pre class="article__code">var console = require("./my_console")("Scoring SDK");
console.green("Request for DataBase.");
console.grey([
  "SELECT *",
  "  FROM \"ScoringSDK__game_list\"",
  "  WHERE key = $1;"
]);</pre><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример вывода данных в консоль." data-url="images/review_console_5.jpg"><figcaption class="article__image_explanation">Рис. 85. Пример вывода данных в консоль.</figcaption></figure></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="xRDLv"></a><h1 class="article__header">Теги и костыли, о которых забывают</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="BmMnK"></a><h2 class="article__subtitle">СЕО-теги</h2><p class="article__paragraph">Классический набор meta-тегов для описания страницы:</p><pre class="article__code">&lt;title&gt;&lt;/title&gt;
&lt;meta name="description" content=""/&gt;
&lt;meta name="keywords" content=""/&gt;
&lt;meta name="author" content=""/&gt;
&lt;meta name="copyright" content=""/&gt;
&lt;meta http-equiv="Reply-to" content=""/&gt;</pre><p class="article__paragraph">К сожалению, в последнее время появляется все больше сайтов и устройств, которые вместо использования классических тегов описания просят разработчиков добавлять свои уникальные теги. Ваша выгода от использования этих тегов — красивое оформление ссылки на ваш сайт в соц. сетях.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример оформления ссылки на сторонний сайт в социальной сети «Вконтакте»." data-url="images/meta__seo.jpg"><figcaption class="article__image_explanation">Рис. 86. Пример оформления ссылки на сторонний сайт в социальной сети «Вконтакте».</figcaption></figure><p class="article__paragraph">Meta-теги для Facebook:</p><pre class="article__code">&lt;meta property="og:title" content=""/&gt;
&lt;meta property="og:description" content=""/&gt;
&lt;meta property="og:image" content=""/&gt;
&lt;meta property="og:site_name" content=""/&gt;
&lt;meta property="og:url" content=""/&gt;</pre><p class="article__paragraph">Где поле image — это ссылка на иконку 256x256 формата JPG или PNG.</p><p class="article__paragraph">Meta-теги для Twitter:</p><pre class="article__code">&lt;meta name="twitter:card" content="summary"/&gt;
&lt;meta name="twitter:title" content=""/&gt;
&lt;meta name="twitter:description" content=""/&gt;
&lt;meta name="twitter:creator" content=""/&gt;
&lt;meta name="twitter:image:src" content=""/&gt;
&lt;meta name="twitter:domain" content=""/&gt;
&lt;meta name="twitter:site" content=""/&gt;</pre><p class="article__paragraph">Meta-теги для Google Plus:</p><pre class="article__code">&lt;meta itemprop="name" content=""/&gt;
&lt;meta itemprop="description" content=""/&gt;
&lt;meta itemprop="image" content=""/&gt;</pre><p class="article__paragraph">Meta-теги для оформления ссылок в меню Windows 8:</p><pre class="article__code">&lt;meta name="application-name" content=""/&gt;
&lt;meta name="msapplication-tooltip" content=""/&gt;</pre><p class="article__paragraph">Apple просит генерировать иконки определенного формата (от 57x57 до 114x114) для ярлыка на сайт:</p><pre class="article__code">&lt;link rel="apple-touch-startup-image" href="startup.png"/&gt;
&lt;link rel="apple-touch-icon" href="touch-icon-iphone.png"/&gt;
&lt;link rel="apple-touch-icon" sizes="72x72" href="touch-icon-ipad.png"/&gt;
&lt;link rel="apple-touch-icon" sizes="114x114" href="touch-icon-iphone-retina.png"/&gt;
&lt;link rel="apple-touch-icon" sizes="144x144" href="touch-icon-ipad-retina.png"/&gt;</pre><p class="article__paragraph">Правда, некоторое время назад они решили изменить стандарт, и теперь правильно писать так:</p><pre class="article__code">&lt;link rel="apple-touch-icon" href="touch-icon-iphone.png"&gt;
&lt;link rel="apple-touch-icon" sizes="76x76" href="touch-icon-ipad.png"&gt;
&lt;link rel="apple-touch-icon" sizes="120x120" href="touch-icon-iphone-retina.png"&gt;
&lt;link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad-retina.png"&gt;</pre><p class="article__paragraph">Минимальный размер иконки увеличили на 3px, теперь это 60x60.</p><p class="article__paragraph">Разработчики Windows 8, вслед за Apple, придумали свои форматы иконок для ярлыка:</p><pre class="article__code">&lt;meta name="msapplication-TileImage" content="custom_icon_144.png"/&gt;
&lt;meta name="msapplication-square70x70logo" content="custom_icon_70.png"/&gt;
&lt;meta name="msapplication-square150x150logo" content="custom_icon_150.png"/&gt;
&lt;meta name="msapplication-square310x310logo" content="custom_icon_310.png"/&gt;
&lt;meta name="msapplication-wide310x150logo" content="custom_icon_310x150.png"/&gt;</pre></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="EGiRK"></a><h2 class="article__subtitle">Теги в head</h2><p class="article__paragraph">При создании качественного веб-приложения следует учитывать множество мелочей. Как правило, разработчики пропускают огромное количество мета-тегов, да и вообще заполняют раздел &lt;head&gt; на скорую руку. Начнем с заголовка документа:</p><pre class="article__code">&lt;!-- saved from url=(0014)about:internet --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ru-RU" manifest="offline.manifest"&gt;</pre><p class="article__paragraph">Первый комментарий заставляет IE сразу включить JavaScript и не показывать окно с запросом на это действие. Далее, параметр lang="ru-RU" указывает на язык документа. Его необходимо использовать вместе с CSS стилем:</p><pre class="article__code">p {
  -moz-hyphens: auto;
  -webkit-hyphens: auto;
  -ms-hyphens: auto;
  hyphens: auto;
}</pre><p class="article__paragraph">Это указывает браузеру на необходимость вставки автопереносов, если, конечно, он поддерживает данный функционал и язык.</p><p class="article__paragraph">Аттрибут manifest="offline.manifest" просит использовать HTML5-кэш для офлайн-работы странички.</p><p class="article__paragraph">Убираем возможность масштабировать страницу:</p><pre class="article__code">&lt;meta name="viewport" content="width=device-width,
  height=device-height, initial-scale=1.0, user-scalable=no,
  maximum-scale=1.0, minimal-ui"/&gt;</pre><p class="article__paragraph">Это особенно полезно, если вы пишете под мобильные телефоны. Например, на телефонах с операционной системой Bada возможна ситуация, когда телефон дождется загрузки страницы и просто умножит разрешение на 2. Также этим тегом мы отключаем zoom, т.к. в приложениях обычно никакого зума нет. Благодаря minimal-ui адресная строка в Сафари в iOS 7.1 не будет дёргаться при прокрутке вверх-вниз, а всегда будет с фиксированным размером.</p><p class="article__paragraph">Ещё один тег для вышеописанной проблемы:</p><pre class="article__code">&lt;meta name="HandheldFriendly" content="True"/&gt;</pre><p class="article__paragraph">Этот тег является индикатором того, что на странице использована разметка, оптимизированная для мобильных устройств. Тег просит отобразить документ без автоматического масштабирования.</p><p class="article__paragraph">Запрещаем кэшировать документ:</p><pre class="article__code">&lt;meta http-equiv="Cache-Control" content="no-cache"/&gt;</pre><p class="article__paragraph">Это помогает на некоторых девайсах избавиться от неадекватных попыток восстановления страницы. То есть попытки адекватные, но не все девайсы восстанавливают страницу без багов.</p><p class="article__paragraph">Mobile Internet Explorer позволяет принудительно активировать технологию ClearType для сглаживания шрифтов:</p><pre class="article__code">&lt;meta http-equiv="cleartype" content="on"/&gt;</pre><p class="article__paragraph">Компания Apple ввела в оборот ещё пару тегов для своих устройств. Следующий мета-тег необходим для того, чтобы приложение открылось в полноэкранном режиме:</p><pre class="article__code">&lt;meta name="apple-mobile-web-app-capable" content="yes"/&gt;</pre><p class="article__paragraph">Ну и корректируем верхнюю полоску в iPhone:</p><pre class="article__code">&lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/&gt;</pre><p class="article__paragraph">Просим IE переключиться в последний режим:</p><pre class="article__code">&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"/&gt;</pre><p class="article__paragraph">Отключаем панель работы с изображениями:</p><pre class="article__code">&lt;meta http-equiv="imagetoolbar" content="no"/&gt;</pre><p class="article__paragraph">Просим IE оформлять все в классическом стиле без учета текущей темы операционки:</p><pre class="article__code">&lt;meta http-equiv="msthemecompatible" content="no"/&gt;</pre><p class="article__paragraph">Запрещаем распознавать номера телефонов и адреса, а также выделять их:</p><pre class="article__code">&lt;meta name="format-detection" content="telephone=no"/&gt;
&lt;meta name="format-detection" content="address=no"/&gt;</pre><p class="article__paragraph">Для обычной веб-странички лучше вставить набор CSS-стилей, описывающих телефон и адрес, а не блокировать их распознание.</p><p class="article__paragraph">Обязательно скидываем стили по умолчанию:</p><pre class="article__code">&lt;link href="css/reset.min.css" rel="stylesheet" type="text/css"/&gt;</pre><p class="article__paragraph">Добавляем набор своих стандартных стилей:</p><pre class="article__code">&lt;link href="css/default.css" rel="stylesheet" type="text/css"/&gt;</pre><p class="article__paragraph">А в них учтены ещё некоторые нюансы. Например, есть несколько очень интересных свойств, которые присущи движкам WebKit. Например, свойство «-webkit-touch-callout». Это свойство позволяет вам диктовать поведение браузера в момент тапа и удержания пальца на ссылке. По умолчанию в браузерах всплывает окно, содержащее информацию о ссылке. Но если установить значение «none», окошко с информацией всплывать не будет:</p><pre class="article__code">a {
  -webkit-touch-callout: none;
}</pre><p class="article__paragraph">Это свойство полезно применять в тех случаях, когда на ссылку повешен какой-либо JavaScript/AJAX.</p><p class="article__paragraph">В старых версиях WebKit на Android был баг, который не позволял использовать псевдо-классы с комбинацией селекторов + и ~.</p><pre class="article__code">h1:hover ~ p {
  color: green;
}</pre><p class="article__paragraph">Лучшее решение — это использовать анимацию только для WebKit-браузеров для тега &lt;body&gt;.</p><pre class="article__code">body {
  -webkit-animation: bugfix infinite 1s;
}

@-webkit-keyframes bugfix {
  from {
    padding: 0;
  }
  to {
    padding: 0;
  }
}</pre><p class="article__paragraph">Свойство «-webkit-user-drag» указывает на то, что во время перетаскивания блока двигаться должен именно блок, а не содержимое внутри него. Например, ничего не перетаскивается:</p><pre class="article__code">.article {
  -webkit-user-drag: none;
}</pre><p class="article__paragraph">Перетаскивается весь элемент, а не контент внутри:</p><pre class="article__code">.sidebar {
  -webkit-user-drag: element;
}</pre><p class="article__paragraph">Свойство «-webkit-appearance» изменяет внешний вид кнопок и других элементов управления, чтобы походить на стандартные средства управления. Задавая это свойство элементу, вы можете определять то, как будет выглядеть элемент SPAN. Например, как textarea:</p><pre class="article__code">span.lookLikeTextarea {
  -webkit-appearance: textarea;
}</pre><p class="article__paragraph">Всего таких значений около 50.</p><p class="article__paragraph">Маску при вводе пароля тоже можно изменять. Например, вместо кружков можно отображать квадраты.</p><pre class="article__code">input[type="password"] {
  -webkit-text-security: square;
}</pre><p class="article__paragraph">Ставить border картинкам обычно не забывают, т.к. он в reset.css, а вот vertical-align пропускают:</p><pre class="article__code">img {
  border: 0;
  vertical-align: top;
}</pre><p class="article__paragraph">Сохраните у себя пример стандартного класса анимации, чтобы «мозолить глаза»:</p><pre class="article__code">.animation {
  -webkit-transition: background-color 0.7s, color 1s, opacity 0.5s;
  -ms-transition: background-color 0.7s, color 1s, opacity 0.5s;
  -o-transition: background-color 0.7s, color 1s, opacity 0.5s;
  -moz-transition: background-color 0.7s, color 1s, opacity 0.5s;
  transition: background-color 0.7s, color 1s, opacity 0.5s;
}</pre><p class="article__paragraph">Можно копировать его по мере надобности для кнопок, табиков и т.п. Суть в том, что когда он постоянно попадается на глаза, подключение анимации становится чем-то естественным. О ней уже не надо вспоминать, как о фиче, которую нужно не забыть подключить.</p><p class="article__paragraph">А ещё в этих стилях я раскрашиваю плашку, которая всегда идет вверху HTML-шаблона:</p><pre class="article__code">&lt;noscript class="no_script_message"&gt;
  У вас отключен JavaScript. Сайт может отображаться некорректно. Рекомендуем включить JavaScript.
&lt;/noscript&gt;</pre><p class="article__paragraph">Если будете переводить в HTML в HTA, есть такая вставка:</p><pre class="article__code">&lt;!-- Option for HTA file
  &lt;hta:application id=ifree.game.sudoku
    applicationName=Sudoku
    showInTaskBar=yes
    caption=yes
    innerBorder=yes
    selection=no
    icon=images/favicon.ico
    sysMenu=yes
    windowState=normal
    scroll=no
    resize=no
    navigable=no
    contextmenu=yes /&gt;
    --&gt;</pre><p class="article__paragraph">Тут указаны параметры для HTA-файла (например, наличие системного меню, отсутствие прокрутки и т.п.). А также добавьте JS-файл:</p><pre class="article__code">&lt;script src="js/hta.js"&gt;&lt;/script&gt;</pre><p class="article__paragraph">Его задача — сжать окно и отцентрировать его по середине экрана (если, конечно, это возможно).</p><pre class="article__code">(function (global) {
  "use strict";
  global = global || {};

  var width = 600,
    height = 400;

  if (global.resizeTo) {
    global.resizeTo(width, height);
  }

  if (global.screen &amp;&amp; global.moveTo) {
    var positionX = Math.ceil((global.screen.width / 2) - (width / 2)),
      positionY = Math.ceil((global.screen.height / 2) - (height / 2));
    global.moveTo(positionX, positionY);
  }
})(this);</pre><p class="article__paragraph">Берется соотношение сторон 600х400px. Если у объекта window есть метод moveTo и свойство screen, тогда можно попытаться сжать окно и передвинуть его на центр экрана.</p><p class="article__paragraph">Ну а с этим, наверное, уже знакомы?</p><pre class="article__code">&lt;script src="js/html5.js"&gt;&lt;/script&gt;</pre><p class="article__paragraph">Бежим по новым тегам HTML5 и пересоздаем их для старых IE:</p><pre class="article__code">var tags = [
  "article",
  "video",
  "wbr"
  ...
];

for(var i = 0, l = tags.length; i &lt; l; i++) {
  document.createElement(tags[i]);
}</pre><p class="article__paragraph">Ну и немного хаков для работы на Android:</p><pre class="article__code">&lt;script src="js/android.js"&gt;&lt;/script&gt;</pre><p class="article__paragraph">Например, убираем адресную строку. Для этого:</p><ul class="article__list"><li class="article__list_item">Ждем, когда страница загрузится.</li><li class="article__list_item">Берем высоту страницы и делаем её больше высоты экрана (min-height).</li><li class="article__list_item">Прокручиваем вверх до 1px сверху (scrollTo).</li><li class="article__list_item">Возвращаем высоту в исходное положение.</li></ul><p class="article__paragraph">Стили для книжной и альбомной ориентации иногда могут пригодиться при верстке сложных макетов:</p><pre class="article__code">&lt;link href="css/portrait.css" media="all and (orientation:portrait)"
   rel="stylesheet"/&gt;
&lt;link href="css/landscape.css" media="all and (orientation:landscape)"
   rel="stylesheet"/&gt;</pre><section class="article__note"><p class="article__paragraph_note">Узнать больше о работе с meta-тегах вы можете из:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «Разработка кроссплатформенных приложений на JavaScript»<br>Бахирев Алексей, препати FrontTalks, Екатеринбург, 13 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link_note">http://fronttalks.ru/2014/13-14march.html</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="hAiHK"></a><h2 class="article__subtitle">Теги полей ввода, ссылки, таблицы</h2><pre class="article__code">&lt;input type="text" autocomplete="on" spellcheck="true"
  autocapitalize="off" autocorrect="off" autofocus required
  maxlength="30" pattern="^[А-Яа-яs-_0-9]+$" class="input_name"
  id="input_name" placeholder="Иван Иванович" x-webkit-speech /&gt;</pre><b class="article__selection">Атрибуты элемента</b><p class="article__paragraph">placeholder — подсказка для ввода</p><p class="article__paragraph">maxlength — ограничение количества вводимых символов</p><p class="article__paragraph">spellcheck — проверка правописания</p><p class="article__paragraph">autocorrect — автоматическая корректировка написанного</p><p class="article__paragraph">autocapitalize — автоматическое преобразование регистра</p><p class="article__paragraph">x-webkit-speech — голосовой ввод</p><b class="article__selection">Требования к элементу</b><ul class="article__list"><li class="article__list_item">Тип элемента должен соответствовать типу вводимых данных. Если это поле ввода пароля, оно должно иметь тип password. Вводимые символы при этом должны заменяться звездочками.</li><li class="article__list_item">Элемент должен сопровождаться примером того, какие данные требуется ввести.</li><li class="article__list_item">Элемент должен подсказывать пользователю данные для ввода на лету.</li><li class="article__list_item">Элемент должен проверять орфографические ошибки.</li><li class="article__list_item">Максимальная длина ввода должна быть ограничена.</li><li class="article__list_item">Если это поле ввода нового пароля, необходимо добавить кнопку «автогенерация пароля», при нажатии на которую генерируется случайный пароль.</li><li class="article__list_item">Элемент должен содержать атрибут pattern, указывающий на ожидаемый тип данных.</li><li class="article__list_item">При работающем JavaScript введённые пользователем данные обязательно должны проверяться на лету. Если данные не прошли проверку — необходимо немедленно уведомить об этом пользователя.</li></ul><b class="article__selection">Рекомендации</b><ul class="article__list"><li class="article__list_item">Если это поле ввода пароля, необходимо добавить кнопку «посмотреть пароль» (обычно оформляется в виде «глаза»), при нажатии на которую тип поля становится text и пользователь может проверить введенные данные.</li><li class="article__list_item">Если есть возможность автозаполнения поля, её необходимо обязательно использовать. Либо поместить около элемента кнопку, при нажатии на которую будет срабатывать автозаполнение.</li><li class="article__list_item">В зависимости от ситуации, иногда возможно использовать «автокоррекцию» и на лету удалять запрещенные символы. Опасность такой ситуации заключается в том, что пользователь может не заметить коррекцию и отправить данные, которые отличаются от того, что он хотел ввести.</li><li class="article__list_item">Половину этих свойств можно переносить и на textarea. Тут и автодополнение, и проверка правописания, и голосовой ввод, подсказка, ограничение длины и т.д. Но есть ещё ряд дополнительных требований:</li><li class="article__list_item">Изменение размера поля должно быть запрещено (resize: none в CSS)</li><li class="article__list_item">Если это ввод некоего сообщения, необходимо информировать пользователя о том, сколько символов ему ещё можно ввести.</li></ul><b class="article__selection">Виды ссылок</b><p class="article__paragraph">Если вы открыли сайт с телефона, в теге A вы можете указать параметр href, который может начинаться со следующих префиксов:</p><pre class="article__code">tel:79112223344</pre><p class="article__paragraph">Клик по такой ссылке откроет экран вызова либо сразу начнет звонок на номер 79112223344.</p><pre class="article__code">sms:79112223344?body=Hello world!</pre><p class="article__paragraph">Клик по такой и аналогичным ссылкам (например: smsto) откроет экран сообщений с введенным текстом «Hello world!» и номером получателя 79112223344.</p><pre class="article__code">mailto:mail@yandex.ru</pre><p class="article__paragraph">Запустить стандартный почтовый клиент и предложить отправить письмо. Ссылку можно немного расширить, например:</p><pre class="article__code">mailto:mail1@yandex.ru?сс=mail2@yandex.ru&amp;
     bсс=mail3@yandex.ru&amp;subject=from_site&amp;body=Hello!</pre><p class="article__paragraph">Где:</p><p class="article__paragraph">сс — адрес для копии письма</p><p class="article__paragraph">bсс — адрес для скрытой копии письма</p><p class="article__paragraph">subject — тема письма</p><p class="article__paragraph">body — текст письма</p><p class="article__paragraph">Такой набор свойств удобно использовать, когда от посетителя сайта требуется сообщить вам о 404-й ошибке. В этом случае вы сами заполняете текст письма, указав, если нужно, страницу, которую запросил пользователь.</p><p class="article__paragraph">Чтобы убрать зазоры между ячейками таблицы, раньше было принято писать так:</p><pre class="article__code">&lt;table cellpadding="0" cellspacing="0" border="0"&gt;</pre><p class="article__paragraph">Проблему можно также решить исключительно средствами CSS (при условии, что он будет работать без багов):</p><pre class="article__code">table{
  border: 0px; /* border="0" */
  border-collapse: collapse; /* cellspacing="0" */
}

td {
  padding: 0px; /* cellpadding="0" */
}</pre><p class="article__paragraph">С другой стороны, если вы используете таблицу, возможно, вы верстаете под что-то плохое. Тогда CSS может не отработать (в IE этот код работает стабильно, начиная с восьмой версии).</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="WsdiU"></a><h2 class="article__subtitle">Хаки для IE</h2><p class="article__paragraph">У IE очень много багов. К счастью, в настоящее время его практически никто не использует. Но некоторые особенности все равно следует знать (особенно, если вам нужно будет перегнать HTML в HTA, а HTA в EXE или CHM).</p><p class="article__paragraph">Много ошибок IE6 (и IE7) могут быть исправлены, если задать hasLayout свойство. Он указывает, как контент должен быть выровнен и отпозиционирован относительно других элементов. Также это свойство можно использовать, когда вам нужно превратить строчный элемент (например, &lt;а&gt;) в блочный или наложить эффекты прозрачности.</p><ul class="article__list"><li class="article__list_item">Включение лейаута означает, что элемент отвечает за позиционирование и размеры самого себя и, возможно, любых дочерних элементов.</li><li class="article__list_item">Некоторые элементы, имеющие ограничения размера, всегда имеют layout  (например, кнопки, изображения, поля форм и т.п.).</li><li class="article__list_item">Иногда элементы могут иметь специфичные свойства, устанавливающие layout для применения некоторых параметров (например, элемент должен иметь layout, чтобы получить полосы прокрутки).</li></ul><p class="article__paragraph">Простейший способ установить layout — это задать height или width (zoom тоже можно использовать, но это не является частью CSS-стандарта). Рекомендуется задавать реальные размеры блока, а если это невозможно (высота динамически меняется), то можно сделать так: height: 1px. Также, если у родительского блока не установлена высота, то значение высоты для элемента не изменяется, а hasLayout уже включен.</p><p class="article__paragraph">Хак, предназначенный для определения hasLayout:</p><pre class="article__code">* {
  zoom: 1;
}</pre><p class="article__paragraph">Чтобы полноценно пользоваться альфа-каналом в PNG, нужно заменить серый фон, который генерирует IE на прозрачный. Сделать это можно простым скриптом, подставляющим вместо этого серого фона пустой прозрачный GIF. Самый простой способ подключить iepngfix.htc:</p><pre class="article__code">* {
  behavior: url ("css/iepngfix.htc");
}</pre><p class="article__paragraph">Также можно использовать фильтры самостоятельно:</p><pre class="article__code">.class {
  background: none;
  filter: progid: DXImageTransform.Microsoft.AlphaImageLoader (
    src="image.png",
    sizingMethod="scale"
  );
}</pre><p class="article__paragraph">В IE существуют глюки, когда border и padding включаются в ширину элемента. Исправить можно так:</p><pre class="article__code">.class {
  padding: 4em;
  border: 1em solid red;
  width: 30em;       // Для нормальных
  width /**/ : /**/ 25em;  // Для IE
}</pre><p class="article__paragraph">Следующий баг проявляется в списках, когда последние 1-3 символа последнего пункта списка дублируются на новой строке. Есть несколько решений:</p><ul class="article__list"><li class="article__list_item">Используйте display:inline для плавающих элементов;</li><li class="article__list_item">Задайте margin-right:-3px; на последний элемент в списке;</li><li class="article__list_item">Можно использовать условные комментарии;</li><li class="article__list_item">Добавьте пустой DIV в последний элемент списка (иногда необходимо задать width: 90% или другое подходящее значение для ширины).</li></ul><p class="article__paragraph">IE не понимает min-width и  max-width. Чтобы исправить, используйте следующую конструкцию:</p><pre class="article__code">.class {
  min-width: 500px;
  max-width: 750px;
  width: expression (
    document.body.clientWidth &lt; 500? "500px" :
    document.body.clientWidth &gt; 750? "750px" : "auto"
  );
}</pre><p class="article__paragraph">Плавающие элементы с margin могут вызывать известный баг IE6 с двойным маргином. Например, указываем маргин слева в 5px и в результате получаем 10px. display:inline исправит проблему, а CSS останется валидным.</p><section class="article__note"><p class="article__paragraph_note">Узнать о хаках больше можно тут:</p><ul class="article__list_note"><li class="article__list_item_note">Статья «CSS хаки»<br>Иванов Павел Михайлович<br><a href="http://habrahabr.ru/post/125396/" class="article__link_note">http://habrahabr.ru/post/125396/</a><br><br></li><li class="article__list_item_note">Статья «Расширенный сборник CSS-хаков»<br>Рустам<br><a href="http://habrahabr.ru/post/62002/" class="article__link_note">http://habrahabr.ru/post/62002/</a><br><br></li><li class="article__list_item_note">Статья «Сборник хаков»<br>dfuse<br><a href="http://habrahabr.ru/post/43318/" class="article__link_note">http://habrahabr.ru/post/43318/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="vrsiZ"></a><h2 class="article__subtitle">Верстка писем</h2><p class="article__paragraph">Во многих почтовых клиентах работают только простые теги и стили, поэтому верстать надо с помощью HTML3.2. Часто почтовые клиенты вырезают весь CSS, поэтому все стили должны быть инлайновыми:</p><pre class="article__code">&lt;div style="..."&gt;...&lt;/div&gt;</pre><p class="article__paragraph">Вы должны учитывать, что табуляция может быть преобразована в неразрывный пробел (\t -&gt; &amp;nbsp;).</p><p class="article__paragraph">«Outlook 2007» делает отступы сверху у элементов типа div. У table с cellpadding=0 cellspacing=0 таких полей нет.</p><p class="article__paragraph">Чтобы внизу картинок не отображался отступ в 3px, надо, чтобы между тегом картинки и тегом закрытия ячейки не было пробельных символов, при этом допускается использование для переноса строки комментария вида:</p><pre class="article__code">&lt;td&gt;
&lt;img src="" alt="" /&gt;&lt;!--
--&gt;&lt;/td&gt;</pre><p class="article__paragraph">Часто складывается такая ситуация, когда клиент не позволяет масштабировать размер картинки либо увеличивает её случайным образом. Поэтому необходимо использовать картинки один к одному, как указано в макете, а кроме того, устанавливать свойства width и height для каждой картинки.</p><p class="article__paragraph">В «Outlook 2007» есть плавающий баг, когда картинка, помещённая внутрь ячейки с заданным colspan или rowspan, обрезается вдоль продолжения линии границы соседних ячеек, которые объединяет colspan или rowspan. В этом случае остается видна только часть целого изображения. Проблему можно решить, если отказаться от одной объединенной ячейки и разрезать картинку на части. Каждая часть - соответственно должна занимать свою одну простую ячейку.</p><p class="article__paragraph">В «The Bat!», при использовании прозрачных гифов, прозрачные точки заменяются чёрными. Поэтому прозрачные картинки должны заполняться цветом фона, на котором они расположены.</p><p class="article__paragraph">Не используйте тег font, т.к. он может попасть под парсинг в каком-либо «визуальном редакторе». В таких случаях тег может быть преобразован в span, причем на свой лад, что неблагоприятно скажется на картине в целом.</p><p class="article__paragraph">Обязательно указывайте свойство color в формате #xxxxxx или фактическом, например, red. Не все почтовые клиенты адекватно воспринимают сокращенные цвета, например, #990. Как правило, короткая запись просто игнорируется.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше о рассылках и верстке писем можно тут:</p><ul class="article__list_note"><li class="article__list_item_note">Серия статей «Верстка писем и рассылок»<br>Артур Кох<br><a href="http://habrahabr.ru/users/dudeonthehorse/" class="article__link_note">http://habrahabr.ru/users/dudeonthehorse/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="csVAq"></a><h1 class="article__header">XSS, CSRF и т.п.</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="nzZQP"></a><h2 class="article__subtitle">XSS</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Вероятность появления XSS обратно пропорциональна количеству PHP-программистов." data-url="images/xss_xss.jpg"><figcaption class="article__image_explanation">Рис. 87. Вероятность появления XSS обратно пропорциональна количеству PHP-программистов.</figcaption></figure><p class="article__paragraph">Практически все PHP-программисты рефлекторно отправляют данные от клиента в функцию htmlspecialchars или strip_tags. Первая — преобразует специальные символы в HTML-сущности, вторая — вырезает все теги. Но такой рефлекс есть далеко не у всех Java и NodeJS-разработчиков. Java-мены привыкли думать об высших сущностях и абстракциях, обычно им нет дела до каких-то строковых данных, которые не опасны для сервера. NodeJS-разработчики, как это ни странно, слишком увлечены новыми технологиями и опять не скатываются до мыслей о HTML-разметке. Кроме того, часто разработчикам дают минимум времени на написание функционала, и они загружены большим списком задач, поэтому могут упускать из внимания какие-либо мелкие детали и нюансы. Таким образом, очень часто можно встретить крупные компании с быстрыми и мощными серверами, дорогими программистами, но с отсутствующей защитой от XSS и аналогичных атак.</p><p class="article__paragraph">Большинство советов по внедрению XSS сводится к перебору различных комбинаций символов и тегов. Опять же, при стандартной обработке большинство PHP-разработчиков закроют брешь, заменив &lt; на &amp;lt; но в данном случае нас интересует меньшинство. Это меньшинство будет писать свой «самый лучший» форум / гостевую / форму отправки сообщений. И, конечно же, оставит возможность вводить какие-либо теги, для того, чтобы пользователь мог «красиво оформить» свое сообщение. В эту категорию также попадут все те, кто прикручивает текстовые редакторы, и особенно Java-разработчики, использующие какой-нибудь «модный» фреймворк. Эти люди не могут просто вырезать специальные символы. Они будут использовать какие-либо regExp`ы для их фильтрации. Соответственно перед нами встаёт задача подобрать такую комбинацию символов, которая либо вообще не будет обрезана regExp`ом, либо обрежется выгодным нам образом. Начинаются различные варианты перебора:</p><pre class="article__code">"&gt;&lt;script&gt;alert()&lt;/script&gt;
&lt;sc&lt;script&gt;ript&gt;alert()&lt;/sc&lt;/script&gt;ript&gt;
&gt;&gt;&gt;&gt;&lt;&lt;script</pre><p class="article__paragraph">Гораздо интереснее советы по способам маскировки JavaScript-кода. В основе всегда лежит какая-то кодировка и способ кодирования в неё и обратно.</p><p class="article__paragraph">Как вы помните, при нажатии кнопки на клавиатуре мы можем получить keyCode и charCode (код кнопки, код символа). Зная коды символов, мы можем представить строку в виде набора чисел. Функцией fromCharCode мы можем преобразовать набор этих кодов обратно в строку:</p><pre class="article__code">alert(String.fromCharCode(88, 83, 83)); // Выведет "XSS"</pre><p class="article__paragraph">Или перевести их в HEX (шестнадцатеричная система счисления) и добавить \x в начале:</p><pre class="article__code">alert(unescape("\x58\x53\x53"));</pre><p class="article__paragraph">Все способы выше требуют уже работающего JavaScript, но есть способы, которые работают на уровне HTML. Например, формат &amp;#xx;:</p><pre class="article__code">&amp;#88;&amp;#83;&amp;#83;</pre><p class="article__paragraph">Также можно добавить нулей:</p><pre class="article__code">&amp;#000088;&amp;#000083;&amp;#000083;</pre><p class="article__paragraph">Вы можете использовать эти кодировки не только для маскировки JavaScript, но и для маскировки URL-адресов в ссылках. Притом надо понимать, что в строке состояния пользователь увидит декодированный адрес. Кодировка нужна только для того, чтобы обойти regExp на сервере. Например, URL можно представить в виде ip-адреса сервера:</p><pre class="article__code">&lt;a href="http://88.83.83.83/"&gt;XSS&lt;/a&gt;</pre><p class="article__paragraph">А ip-адрес можно закодировать в HEX и использовать префикс 0x:</p><pre class="article__code">&lt;a href="http://0x58.0x53.0x53.0x53/"&gt;XSS&lt;/a&gt;</pre><p class="article__paragraph">Кроме HEX, есть ещё и OCT с префиксом 0:</p><pre class="article__code">&lt;a href="http://0130.0123.0123.0123/"&gt;XSS&lt;/a&gt;</pre><p class="article__paragraph">Или пройтись стандартным encodeURIComponent:</p><pre class="article__code">&lt;a href="http%3A%2F%2F88.83.83.83%2F"&gt;XSS&lt;/a&gt;</pre><p class="article__paragraph">Можно также использовать несколько способов одновременно:</p><pre class="article__code">&lt;a href="http://0x58.0123.83.0x53/"&gt;XSS&lt;/a&gt;</pre><p class="article__paragraph">Ещё интереснее, когда JavaScript появляется в местах, где появиться не должен. Это может быть подмена URL-картинок, ссылок и прочих ресурсов, вплоть до подмены адресов в файлах CSS.</p><pre class="article__code">&lt;a href="javascript:alert('XSS');"/&gt;ссылка&lt;/a&gt;</pre><p class="article__paragraph">В старых IE есть функция expression, которая позволяет выполнять JavaScript прямо в CSS-файле:</p><pre class="article__code">body {
  text-size: expression(alert("XSS"));
}</pre><p class="article__paragraph">Т.к. теги бывают разрешены для ввода (например, img, b, strong), то им можно навесить событие:</p><pre class="article__code">&lt;img src="image.png" onload="alert('XSS');"/&gt;</pre><p class="article__paragraph">Многие забывают про события, фильтруя строку только по слову script. Также фильтрация может не работать, если существуют параметры dynsrc и lowsrc:</p><pre class="article__code">[imag]http://yandex.ru/1.jpg dynsrc=javascript:alert('XSS')[/imag]</pre><p class="article__paragraph">Ну и, комбинируя различные свойства, мы можем обойти те или иные фильтры строкой вида:</p><pre class="article__code">&amp;#60;img src="image.png" onload="alert('XSS');"&amp;#47;&amp;#62;</pre><p class="article__paragraph">Если вы обнаружили XSS-уязвимость, возникает второй вопрос — что делать дальше? В большинстве случаев эти уязвимости используются для угона кук (document.cookie), чтобы получить доступ к чужим аккаунтам. Но их также можно эксплуатировать для добавления своей рекламы на чужой сайт. В этом случае XSS работает с DOM-деревом и добавляет в него рекламные баннеры. Для этих же целей можно использовать и CSS, если вам каким-либо образом удастся внедрить его на сайт.</p><pre class="article__code">&amp;#60;style&amp;#62;body { background: url("banner.png") !important; }&amp;#60;&amp;#47;style&amp;#62;
&amp;#60;link href="css/banner.css" rel="stylesheet" type="text/css"&amp;#47;&amp;#62;</pre><p class="article__paragraph">Вы можете использовать эти же принципы, если создаете расширения для сайтов, которые после установки позволяют менять стиль сайта у конкретных пользователей. Имея доступ к DOM, кроме смены стиля, вы можете также заменить рекламные баннеры сайта на свои.</p><p class="article__paragraph">Ещё одним интересным способом использования XSS является возможность делать запрос к API сайта. Например, один из пользователей одного форума закрывал неугодные ему темы сообщением вида:</p><pre class="article__code">&lt;img src="/login.php?do=logout"/&gt;</pre><p class="article__paragraph">Таким образом, любой, кто открывал тему, тут же разлогинивался и не мог отправить сообщение.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="iEVNh"></a><h2 class="article__subtitle">Обфускация</h2><p class="article__paragraph">Тема шифрования JavaScript кода для XSS тесно связана с темой обфускации. Обфускация — это запутывание кода с сохранением его функциональности. Кроме обхода XSS фильтров, её также используют для защиты от копирования, с целью сохранить в тайне алгоритм работы программы.</p><b class="article__selection">Пробелы и табы</b><p class="article__paragraph">Исходный код вашего скрипта можно представить в виде символа пробела и табуляции. Шифрование происходит по алгоритму:</p><ul class="article__list"><li class="article__list_item">Получить ANSII-код для каждого символа.</li><li class="article__list_item">Представить ANSII-код в двоичном коде.</li><li class="article__list_item">Двоичный код записать с помощью пробельных символов, где пробел соответствует нулю, а знак табуляции — единице.</li></ul><p class="article__paragraph">Несмотря на то, что наш код увеличиться в восемь раз, он станет не видим для пользователя.</p><b class="article__selection">[]()+!</b><p class="article__paragraph">Кодирование в набор символов []()+! происходит по следующему принципу:</p><pre class="article__code">![] = false
!![] = true
+[] = 0
true + true = 2
true + true + [] = "2"
!![] + [] = "true"</pre><p class="article__paragraph">Как видите, таким образом можно получить строку и цифры, а уже из строки вытаскивать необходимые буквы:</p><pre class="article__code">(!![] + [])[2] = u (второй символ в true)</pre><p class="article__paragraph">Т.к. цифру два мы тоже можем кодировать, то код принимает вид:</p><pre class="article__code">(!![] + [])[(true + true)]</pre><p class="article__paragraph">Также мы можем запросить несуществующий индекс и получить ещё один набор букв:</p><pre class="article__code">(!![] + [])[(![])] + [] = "undefined"</pre><p class="article__paragraph">Из набора букв в словах true, false, undefined, мы можем составлять другие слова, в частности, название свойств и методов:</p><pre class="article__code">[]["filter"] = function filter() { [native code] }
!![]+[]["filter"] = "truefunction filter() { [native code] }"</pre><p class="article__paragraph">Из данного набора букв мы можем составить ещё больше названий методов, например, call, sort и т.п. Этот способ кодирования можно расширить, добавив ещё несколько символов =:;\/"', что существенно упростит задачу.</p><pre class="article__code">~[] = -1
-~[] = 1
[]^[] = 0
~~[] = 0
~true = -2
~false = -1
([]/[]+[]) = NaN
(~[]/-[]+[]) = Infinity</pre><b class="article__selection">DOM</b><p class="article__paragraph">Куски кода можно прятать в DOM-элементах. Например:</p><pre class="article__code">&lt;div id="div" c="alert"&gt;&lt;/div&gt;</pre><pre class="article__code">var node = document.getElementById("div");
var method = node.getAttribute("c");
window[method]("XSS");</pre><b class="article__selection">Комментарии</b><p class="article__paragraph">Чем больше комментариев, тем труднее понять, где они заканчиваются и начинается код:</p><pre class="article__code">&lt;script&gt;
  a /* e */ lert(1);
  /*/ alert(1); /*/ alert(2); /*/ alert(3); /*/
&lt;/script&gt;</pre><b class="article__selection">Трюк с несуществующими функциями</b><p class="article__paragraph">Суть трюка в том, чтобы обернуть код в try/catch, вызвать несуществующую функцию и заставить скрипт упасть, а потом продолжить его выполнение в блоке catch:</p><pre class="article__code">try{
  aler()
} catch(e) {
  console.dir(e.message); // "aler is not defined"
}</pre><p class="article__paragraph">Из свойства message мы можем получить часть названия упавшей функции и восстановить его до полного:</p><pre class="article__code">try{
  aler()
} catch(e) {
  console.log((e.message.slice(0,4) + "t")); // "alert"
}</pre><b class="article__selection">Привязка кода</b><p class="article__paragraph">Иногда возникает необходимость написать код так, чтобы он выполнялся только после соблюдения некоторых условий. Например, мы создали JavaScript-код и хотим его продавать, но продавать мы хотим с привязкой к домену, чтобы его нельзя было запустить на других сайтах. Код должен быть зашифрован с использованием некого ключа, а ключ привязывается к нужным данным.</p><pre class="article__code">var key = location.href.split('/')[2]; // привязка к домену
var key = new Date();          // привязка к дате
//привязка к коду всей страницы:
var key = document.getElementsByTagName('html')[0].innerHTML;
var key = navigator.userAgent; // привязка к браузеру
var key = document.cookie;   // привязка к куки-записям</pre><section class="article__note"><p class="article__paragraph_note">Если вас заинтересовала данная тема, более подробную информацию можно найти у следующих экспертов:</p><ul class="article__list_note"><li class="article__list_item_note">Корпоративный блог журнала «Хакер», 2011 год.<br>Николай Андреев<br><a href="http://habrahabr.ru/company/xakep/blog/128741/" class="article__link_note">http://habrahabr.ru/company/xakep/blog/128741/</a><br><br></li><li class="article__list_item_note">Доклад «Extreme JavaScript Minification and Obfuscation»<br>Сергей Ильинский<br>12 октября 2010 года<br><br></li><li class="article__list_item_note">Обфускация JavaScript<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/112530/" class="article__link_note">http://habrahabr.ru/post/112530/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="IDSRz"></a><h2 class="article__subtitle">CSRF</h2><p class="article__paragraph">CSRF — это не только бесплатный сервер за чужой счет, это ещё возможность убрать конкурента или заставлять людей принудительно выполнять некие действия.</p><p class="article__paragraph">Использовать CSRF с выгодой для себя можно, как минимум, двумя методами:</p><ul class="article__list"><li class="article__list_item">дублировать клиента</li><li class="article__list_item">заставить пользователя совершить необходимое действие</li></ul><b class="article__selection">Бесплатный самообслуживающийся сервис с API</b><p class="article__paragraph">Предположим, есть некий сервис по поиску недвижимости. Сервис состоит из серверной и клиентской части, которые общаются через какие-то стандартизированные запросы. Вы можете создать сайт с аналогичным функционалом или мобильное приложение, основываясь на уже готовом API чужого сервера. Конечно, будут некоторые ограничения, но основной функционал, касающийся поиска, будет доступен и на сайте-дубликате. Особенно велика вероятность создания дубликата при наличии запросов в формате JSONP, которые позволяют легко взаимодействовать клиентам с других доменов с оригинальным сервером. Далее проводится СЕО-продвижение и вешаются рекламные баннеры. А если повезет, может оказаться так, что сайт-подделка будет в поисковой выдаче выше сайта-оригинала. Конечно, любой сбой или изменения API могут поломать дубликат, но это оправданный риск, т.к. разработка дубликата гораздо дешевле и быстрее, чем поддержка оригинала с серверной частью.</p><p class="article__paragraph">Иногда, при попытке скопировать сложный ресурс, пишутся парсеры, которые разбирают оригинальные страницы и отдают необходимую информацию. Но это более дорогой и сложный путь. Как правило, от него защищаются различными механизмами капчи и ограничением количества запросов с одного ip-адреса.</p><b class="article__selection">Генерация контента на чужом сайте</b><p class="article__paragraph">Если API сайта конкурентов позволяет осуществлять какие-либо действия по добавлению контента, это отличная возможность, чтобы автоматизировать этот процесс и либо забить сайт бессмысленными или отрицательными комментариями, либо наполнить его сообщениями рекламного характера. Притом обычно ставка делается на случайных авторизированных пользователей, которые, попав на ваш сайт, могут дернуть API другого сайта со своими куками. Например, если API социальной сети уязвимо для CSRF, можно насильственно подписывать случайных посетителей вашего сайта на какую-либо группу, тем самым раскручивая её.</p><p class="article__paragraph">Для защиты от CSRF используют механизм токенов. В случае использования токенов, при рендере страницы, сервер оставляет некий ключ (токен), а пользователя обязуют использовать этот токен при отправке запроса. Далее сервер сверяет два ключа, и если они совпадают — считает запрос подтвержденным. Иногда для генерации токена используют алгоритм вида:</p><ul class="article__list"><li class="article__list_item">Взять email или другую информацию о пользователе из сессии</li><li class="article__list_item">Получить из нее md5-хэш</li><li class="article__list_item">Назначить хэш в качестве токена</li><li class="article__list_item">Отдать на страницу токен</li><li class="article__list_item">При отправке запроса операция повторяется на сервере и сверяются полученные md5-хэши</li></ul><p class="article__paragraph">Т.к. атакующая сторона не может получить доступ к кукам чужого сайта, то и сгенерировать токен, основываясь на информации о пользователе, она не сможет. Следовательно, запрос невозможно подделать.</p><b class="article__selection">Механизм капчи</b><p class="article__paragraph">Капча нужна для ограничения количества запросов. Если капчи нет, то возможен кейс вида:</p><ul class="article__list"><li class="article__list_item">Регистрируется аккаунт на сайте конкурентов.</li><li class="article__list_item">Запускается скрипт, который, зная токен, отправляет множество запросов к серверу для добавления комментариев или сообщений рекламного характера. Тем самым сайт забивается рекламой конкурентов или отрицательными отзывами о продукции.</li></ul><p class="article__paragraph">Чтобы получить токен, можно написать расширение для браузера, т.к. оно может имееть доступ к DOM, а следовательно, без труда сможет отыскать необходимые поля и формы.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="EEbxO"></a><h2 class="article__subtitle">DDOS</h2><p class="article__paragraph">Что такое DDOS и по какому принципу он работает — ясно всем. Но далеко не все ставят хоть какую-то защиту от него. Поэтому, написав небольшой скрипт для отправления запросов к сайту, высока вероятность вывести его из строя или значительно замедлить работу. Поскольку абсолютное большинство сайтов небольших компаний располагаются на дешевых серверах. Вполне возможно, что путем DDOS-атаки вы заставите сайт превысить лимит его нагрузки, и сайт отключит компания-хостер с меткой «превышен дневной лимит нагрузки на выбранном тарифе».</p><p class="article__paragraph">Если постоянно ддосить сайт, разработчики рано или поздно найдут способы борьбы с этим. Поэтому любой вид атаки следует применять очень избирательно и тщательно продумывать время и повод. Атака имеет смысл, например, в дни каких-то специальных акций или промо-мероприятий, когда конкурент вложил деньги в рекламу и ожидает приток новых пользователей, незнакомых с его продукцией. Таким образом вы можете не только сорвать рекламную компанию, но и использовать чужую промо-акцию для расскрутки своего ресурса, если найдете способ внедрить рекламу или принудительный редирект.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="RWgrF"></a><h2 class="article__subtitle">Сlickjacking</h2><p class="article__paragraph">Суть кликджекинга в том, чтобы разместить прозрачный фрейм с чужим сайтом поверх какого-то контента на вашем сайте. Например:</p><ul class="article__list"><li class="article__list_item">На странице пользователю подсовывается безобидная ссылка.</li><li class="article__list_item">Поверх этой ссылки помещен прозрачный iframe со страницей vk.com, так что кнопка «Лайк» находится чётко над ней.</li></ul><p class="article__paragraph">Кликая на ссылку, посетитель на самом деле нажимает на кнопку «Лайк».</p><p class="article__paragraph">Чтобы защититься от кликджекинга, необходимо добавить заголовок X-Frame-Options с параметром Deny (рендеринг документа внутри фрейма запрещён).</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="dcbzy"></a><h2 class="article__subtitle">Клавиатурные шпионы</h2><p class="article__paragraph">Клавиатурные шпионы пишут для того, чтобы получить логин и пароль пользователя от различных ресурсов, но в повседневной жизни это не так интересно, как доступ к личной переписке девушки в соц. сети. Для того, чтобы клавиатурный шпион на JavaScript мог работать на странице, его следует оформить как расширение для браузера. В манифесте можно указать, что наш файл имеет право доступа к тем или иным сайтам и должен быть запущен при их открытии.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Чужие cookie врать не будут, так же как и распарсенный диалог." data-url="images/xss_keyboard.jpg"><figcaption class="article__image_explanation">Рис. 88. Чужие cookie врать не будут, так же как и распарсенный диалог.</figcaption></figure><p class="article__paragraph">В большинстве случаев разработчики стараются перехватить все события нажатия кнопок на клавиатуре, а без контекста — это не имеет значения. Например:</p><pre class="article__code">// Диалог 1
Некий парень:  — Поужинаем сегодня после восьми?
Некая девушка: — Хорошо.

// Диалог 2
Некий парень:  — Подготовишь отчет по продажам до завтра? У нас проверка в два.
Некая девушка: — Хорошо.</pre><p class="article__paragraph">Из примеров видно, что в обоих случаях скрипт запишет фразу «Хорошо», но суть фразы не передаст.</p><p class="article__paragraph">Для понимания контекста нам необходимо понимать, что именно видит пользователь на экране. А эту задачу решит создание парсеров и DOM-анализаторов. Сами по себе парсеры помогут нам вытащить весь диалог, а DOM-анализаторы оповестят о том, сколько ещё новых данных было загружено и какие из них стоит обработать парсерами. Надо понимать, что в данном случае пользователю вообще не обязательно отвечать в диалоге, ему достаточно просто открыть его.</p><p class="article__paragraph">Абсолютно такой же логики стоит придерживаться и при попытке распарсить интерфейс почтового ящика. Т.к. зачастую почтовые службы выводят список сообщений, отправителя и начало письма, этих данных будет достаточно, чтобы понять общий контекст и адреса собеседников жертвы.</p><p class="article__paragraph">Так же следует разрешить работу расширения в «анонимном» режиме, т.к. многие им пользуются. Надо понимать, что если вы храните собранные данные в localStorage, то они будут уничтожены сразу после закрытия вкладки. Но это ограничение можно обойти следуя алгоритму:</p><ul class="article__list"><li class="article__list_item">Обрабатываем данные.</li><li class="article__list_item">Читаем данные из localStorage.</li><li class="article__list_item">Если данных нет — отправляем данные на сервер.</li><li class="article__list_item">Записываем данные в localStorage.</li></ul><p class="article__paragraph">Если при запуске мы смогли прочитать данные из localStorage, значит мы работаем в обычном режиме. Если данных в нем нет — это либо первый запуск, либо «анонимный» режим.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="VVEQQ"></a><h2 class="article__subtitle">Какие уязвимости стоит искать</h2><p class="article__paragraph">Многие фреймворки и программисты любят записывать данные в DOM, либо не шифруют ту информацию, которая представлена в верстке. Рассмотрим это на нескольких примерах.</p><p class="article__paragraph">Пользователю показывается список людей, которые посетили его страницу. Аватарки этих людей зашифрованы, и для их просмотра пользователю предлагают заплатить некую цену. Но если открыть код страницы, окажется, что URL зашифрованной аватарки содержит ID пользователя. Например:</p><pre class="article__code">http://site.ru/images/333222111/avatar.jpg</pre><p class="article__paragraph">Таким образом, получив ID, мы можем сразу перейти на страницу скрытого пользователя:</p><pre class="article__code">http://site.ru/id333222111</pre><p class="article__paragraph">Также бывает, что id при редактировании какой-либо информации берется не из сессии, а из параметров запроса. Допустим, у нас есть форма для редактирования имени:</p><pre class="article__code">&lt;form method="GET" action="http://site.ru"&gt;
  &lt;input type="hidden" name="id" value="333222111"/&gt;
  &lt;input type="text" name="name" value=""/&gt;
  &lt;input type="submit" value="Отправить"/&gt;
&lt;/form&gt;</pre><p class="article__paragraph">В этом случае мы можем подставить в скрытое поле id другого пользователя и отправить запрос на сервер. Если повезет, мы сможем отредактировать его профиль. </p><p class="article__paragraph">Аналогичные баги могут быть в формах оплаты и провода платежей в играх или сервисах. Например, запрос на получение некого ресурса может содержать количество этого самого ресурса:</p><pre class="article__code">&lt;form method="GET" action="http://site.ru"&gt;
  &lt;input type="hidden" name="score" value="50"/&gt;
  &lt;input type="submit" value="Отправить"/&gt;
&lt;/form&gt;</pre><p class="article__paragraph">Если мы откроем консоль разработчика и увеличим значение поля «score», то можем получить очков в сотни раз больше, чем остальные пользователи. Такая схема часто оказывается рабочей в онлайн-играх. На сайте знакомств Badoo существовала форма повторной отправки пароля при регистрации, в которой можно было изменить свой email, если в него закралась опечатка. Оказалось, что пользователю можно даже изменить уже подтверждённый почтовый адрес и прислать себе пароль от чужого аккаунта.</p><section class="article__note"><p class="article__paragraph_note">По данной теме вы также можете прочитать интересные статьи:</p><ul class="article__list_note"><li class="article__list_item_note">Конкурс уязвимостей, или Ломай меня полностью!<br>Еремин Станислав<br><a href="http://habrahabr.ru/company/badoo/blog/175865/" class="article__link_note">http://habrahabr.ru/company/badoo/blog/175865/</a><br><br></li><li class="article__list_item_note">Ищите ошибки с помощью Google или «взлом» аккаунтов на badoo.com<br>Анна<br><a href="http://habrahabr.ru/post/189040/" class="article__link_note">http://habrahabr.ru/post/189040/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="APhKz"></a><h1 class="article__header">Пре-продакшн</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="MmlJN"></a><h2 class="article__subtitle">Логика локализации приложения</h2><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Беспонтовая локализация. На самом деле, очень плохая локализация. Я думал, намного будет... Намного лучше будет это все." data-url="images/pre_language_good_1.jpg"><figcaption class="article__image_explanation">Рис. 89. Беспонтовая локализация. На самом деле, очень плохая локализация. Я думал, намного будет... Намного лучше будет это все.</figcaption></figure><p class="article__paragraph">В данный момент есть много различных систем локализации. Большая часть статей по ним рассказывают либо о самих системах, либо о проблемах перевода времен и подстановки окончаний. Ниже мы рассмотрим основные способы и проблемы реализации простой локализации на клиенте. Это не лучший способ, т.к. он наносит сильный удар по СЕО-составляющей, но если вы пишите офлайн-приложение, то вам от него не уйти.</p><b class="article__selection">Общий алгоритм систем локализации на клиенте</b><p class="article__paragraph">Модуль локализации обычно берет User-Agent, вычленяет из него язык пользователя и подгружает соответствующий словарь. Во все места, где необходимо вывести какую-либо фразу, вставляется вызов модуля локализации с ID нужной фразы в словаре. Перед созданием такого модуля нужно ответить на несколько вопросов. Например: в каком формате хранить перевод?</p><p class="article__paragraph">Хранить перевод нужно в стандартном формате хранения информации. Поэтому мы должны выбрать один из двух вариантов: XML или JSON (либо аналогичные структуры). Т.к. в JavaScript`е работать с JSON удобнее и он занимает меньше места — обычно выбирают последний. Есть также реализации, в которых словарь представляет собой массив строк, а вместо ID используют индексы. Такой словарь хорошо подходит, например, для описания кода ошибок:</p><pre class="article__code">var message = [];
message[200] = "Все хорошо";
message[404] = "Документ не найден";
message[500] = "Внутренняя ошибка сервера";</pre><p class="article__paragraph">Но чем больше он становится, тем труднее им пользоваться.</p><p class="article__paragraph">Если у нас стоит задача пробежаться по всему документу и перевести его, то мы ожидаем некие метки, которые будут подсказывать нам, какой текст следует переводить и какой перевод подставлять на его место. Обычно эта метка содержит ID фразы в нашем словаре. Например:</p><pre class="article__code">&lt;div data-language="save"&gt;
  Сохранить
&lt;/div&gt;</pre><p class="article__paragraph">Многие разработчики любят добавлять элементам класс типа translation и искать элементы по классу. ID в таком случае пишут сразу вместо текста. Например:</p><pre class="article__code">&lt;div class="translation"&gt;
  !{save}
&lt;/div&gt;</pre><p class="article__paragraph">Этот подход плох, т.к. содержит несколько минусов:</p><ul class="article__list"><li class="article__list_item">Класс элемента отвечает за его внешний вид и входит в зону ответственности другого модуля. Если мы выбрали модель, при которой решили отказаться от каскада и наследовать строго один класс на один элемент, класс translation будет затерт.</li><li class="article__list_item">После первой автозамены мы больше не сможем изменить язык, т.к. ID фраз будут затерты самими фразами. Это можно обойти, создав некий реестр DOM-элементов, который будет заполняться при первом проходе и содержать в себе также ID фраз, но это приведет к увеличению потребляемой памяти и её возможным утечкам при изменении структуры документа и удалении части DOM-дерева.</li><li class="article__list_item">Такой подход неприменим к картинкам, и для их замены нужно будет реализовывать запасной синтаксис (т.к. мы не можем сделать innerHTML картинке, нам необходимо записать ID в какой-либо атрибут тега).</li></ul><p class="article__paragraph">Часто при создании своих собственных модулей перевода авторы забывают о переводе атрибутов элемента. Например:</p><pre class="article__code">&lt;img src="images/logo_ru.png"/&gt;
&lt;input type="text" placeholder="Введите имя"/&gt;</pre><p class="article__paragraph">В данном случае нам может понадобиться изменить src у картинки и placeholder — у элемента input. Если вы выбрали формат JSON для хранения переводов, то можно создать правило: «Если значение строка — используем innerHTML, если значение объект — пробегаем по нему и меняем атрибуты». Например:</p><pre class="article__code">{
  title: "Заголовок",
  logo: {
    title: "Логотип",
    src: "logo_ru.png"
  },
  name: {
    placeholder: "Введите имя"
  }
}</pre><p class="article__paragraph">Кроме того, когда вы пробегаетесь по DOM-дереву в поисках элементов для перевода, следует обращать внимание на типы тегов. Если попадаются элементы типа IMG, а какие-либо дополнительные параметры в JSON`е не заданы, следует заменять адрес картинки. Если тег LINK — меняем аттрибут href и т.д.</p><pre class="article__code">&lt;img src="logo_ru.png" data-language="logo"/&gt;
&lt;link href="article_ru.css" rel="stylesheet" type="text/css" data-language="article"/&gt;</pre><pre class="article__code">{
  logo: "logo_en.png",
  article: "article_en.css"
}</pre><b class="article__selection">Зачем менять стили при переводе?</b><p class="article__paragraph">Т.к. языки отличаются, выбранные вами шрифты могут не поддерживать какой-либо из них. В этом случае вместо букв, скорее всего, вы увидите множество пробелов. Кроме того, могут отличаться стили написания (слева направо, справа налево), а также расстояние между буквами, размер шрифта и прочие параметры.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример перевода. На последнем экране забыли подключить шрифт для выбранного языка." data-url="images/language.jpg"><figcaption class="article__image_explanation">Рис. 90. Пример перевода. На последнем экране забыли подключить шрифт для выбранного языка.</figcaption></figure><p class="article__paragraph">Также, когда мы вставляем некий новый текст в документ, желательно пометить его каким-либо образом, чтобы в будущем иметь возможность найти его:</p><pre class="article__code">&lt;nav&gt;
  &lt;button&gt;
    &lt;span data-language="continue"&gt;Продолжить&lt;/span&gt;
  &lt;/button&gt;
  &lt;button&gt;
    &lt;span data-language="exit"&gt;Выход&lt;/span&gt;
  &lt;/button&gt;
&lt;/nav&gt;</pre><p class="article__paragraph">На примере выше некий модуль меню, к которому у нас нет доступа, генерирует теги &lt;button&gt; внутри тега &lt;nav&gt;. Т.к. он находится вне зоны нашей ответственности, единственное, что мы можем сделать, — вместо чистого текста передать обертку с тегом &lt;span&gt;. Далее, если пользователь сменит язык, а меню не будет вновь пересоздано, мы сможем найти наши пункты благодаря обертке и перевести их.</p><section class="article__note"><p class="article__paragraph_note">Более подробную информацию о системах локализации вы можете узнать из следующих источников:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «l20n как система локализации»<br>Антон Немцев, DUMP 2014, Екатеринбург, 14 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link_note">http://fronttalks.ru/2014/13-14march.html</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="HIxNQ"></a><h2 class="article__subtitle">Плохая логика локализации</h2><b class="article__selection">Не выносите текст в CSS</b><p class="article__paragraph">Этот пример был взят из исходников игры 2048:</p><pre class="article__code">&lt;div class="best-container" id="best"&gt;
  6380
  ::after
&lt;/div&gt;</pre><pre class="article__code">.best-container:after {
  content: "Best";
}</pre><p class="article__paragraph">Чтобы этот кусок кода прошел локализацию, вам придется либо менять верстку, либо генерировать CSS-код с переводом.</p><b class="article__selection">Не используйте в логике привязку к HTML-контексту</b><pre class="article__code">&lt;div id="message"&gt;
  Game over!
&lt;/div&gt;</pre><pre class="article__code">var node = document.getElementById("message");
if(node.indexOf("over") != -1) {
  ...
}</pre><p class="article__paragraph">Чтобы этот кусок кода прошел локализацию, вам придется либо писать костыль и делать подмену фразы «over», либо переписывать логику и убирать зависимость от HTML-контента.</p><section class="article__note"><p class="article__paragraph_note">Узнать больше о локализации через CSS можно тут:</p><ul class="article__list_note"><li class="article__list_item_note">Статья «Локализация html-страницы средствами CSS»<br>Антон Лунев<br><a href="http://habrahabr.ru/post/121075/" class="article__link_note">http://habrahabr.ru/post/121075/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="ApVdY"></a><h2 class="article__subtitle">Классическая сборка</h2><p class="article__paragraph">Если у вас большой проект, который состоит из множества модулей, то для создания итоговой HTML-страницы необходимо все эти модули склеить, а также, если это возможно, сжать все используемые ресурсы. Поэтому в большинстве проектов этап сборки подразумевает под собой следующие пункты:</p><ul class="article__list"><li class="article__list_item">Все JS-файлы клеятся в один файл и сжимаются.</li><li class="article__list_item">Все CSS-файлы клеятся в один файл и сжимаются.</li><li class="article__list_item">Если страница состоит из нескольких HTML-файлов, то они также клеятся в один.</li></ul><p class="article__paragraph">Если же вместо чистого JS, CSS или HTML используются какие-либо шаблоны, то код сначала прогоняется через соответствующий шаблонизатор, и уже результат работы шаблонизатора собирается в итоговый файл.</p><p class="article__paragraph">Большинство систем сборок опираются на конфиги, в которых перечислены все файлы или зависимости итоговой сборки. Но бывают и исключения. Например, если у вас идет конвейерная сборка различных HTML-приложений, то создание конфигов для каждой сборки может стать довольно утомительным процессом. Поэтому разработчики иногда используют парсеры, которые обрабатывают входной HTML-файл и сами генерируют все зависимости и подключения. Кроме того, если парсер также сгенерирует список файлов, из которых состоит проект, мы получим возможность составить HTML5 офлайн-манифест для кеширования всех ресурсов странички. Например, borschik Яндекса умеет создавать, изменять и следить за ссылками на статические ресурсы, которые используются в проекте.</p><p class="article__paragraph">Ещё одной задачей, которую мы можем делегировать системе сборки, является заполнение СЕО мета-тегов для социальных сетей и других сайтов. Это очень удобно, т.к. в данный момент количество таких тегов растет, и мы можем улучшить показатели продвижения. Например, такой механизм реализован в скриптах сборки игрового движка StalinGrad.</p><p class="article__paragraph">Кроме того, используя различные дополнительные компоненты, мы можем решить такие задачи, как генерирование отдельного CSS-файла для IE или автоматическую расстановку актуальных префиксов в CSS-стилях (для этой задачи вы можете использовать «Автопрефиксер» Андрея Ситника).</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="hqulR"></a><h2 class="article__subtitle">Заморозка и инкрементальные обновления</h2><p class="article__paragraph">Оба этих метода применялись при разработке клиента Яндекс почты. Проблема заключалась в том, что вес верстки, скриптов и стилей составлял несколько сотен килобайт и грузить такое количество ресурсов - довольно накладная операция для клиента. При условии частых релизов ситуация становится ещё хуже.</p><b class="article__selection">Заморозка</b><p class="article__paragraph">Предположим, у вас есть картинка, закэшированная браузером. При её обновлении нужно также поправить версию в названии файла, чтобы при открытии страницы пользователь получил новую версию картинки, а не закэшированную. Т.к. клиент был большой и сложный, для этой задачи был написан отдельный модуль, который также следил за названиями всех CSS- и JS-файлов. Таким образом разработчикам удалось значительно снизить количество обновляемых файлов при выходе новой версии.</p><b class="article__selection">Инкрементальные обновления</b><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="При инкрементальном обновлении с сервера приходит только разница между старой и новой версией." data-url="images/pre_update.jpg"><figcaption class="article__image_explanation">Рис. 91. При инкрементальном обновлении с сервера приходит только разница между старой и новой версией.</figcaption></figure><p class="article__paragraph">При частых релизах получается очень много маленьких изменений. Как правило, их объем не более десяти процентов от всего кода. Зная это, мы можем сохранить модули в localStorage и в момент обновления получить от сервера только разницу между старой и новой версией. Наложив такой «патч» на сохраненную копию, мы обновим код на клиенте с минимумом затрат на передачу новых данных.</p><section class="article__note"><p class="article__paragraph_note">Обе темы хорошо раскрыты в следующих докладах:</p><ul class="article__list_note"><li class="article__list_item_note">Доклад «Криокамера для статики»<br>Алексей Андросов, Я.Субботник, Киев, 27 апреля 2013 года.<br><a href="http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/837/" class="article__link_note">http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/837/</a><br><br></li><li class="article__list_item_note">Доклад «Инкрементальные обновления на клиенте»<br>Михаил Корепанов, Я.Субботник, Киев, 27 апреля 2013 года.<br><a href="http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/836/" class="article__link_note">http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/836/</a></li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="ZbpsZ"></a><h2 class="article__subtitle">Генерация ресурсов</h2><p class="article__paragraph">Кроме заполнения мета-тегов и сжатия скриптов, есть ещё одна задача, которую вам необходимо решить при кроссплатформеной сборке HTML-приложения, — генерация иконок.</p><p class="article__paragraph">В одной из глав выше уже рассматривались мета-теги, указывающие на иконки для iPhone, Windows и соц. сетей. Если же вы будете собирать приложение под какой-либо телефон (например, Android или Bada) или расширения для браузеров, то количество необходимых иконок резко увеличится. Кроме того, вам понадобится ещё один набор иконок при загрузке приложения в официальные магазины производителей телефонов. Мало того, что все размеры не стандартизированы и непропорциональны (например, 50x47px у Bada или 310x150px у Windows), так ещё и встречаются специальные требования. Например, Google, при загрузке расширения для Chrome, требует иконку 96x96px с прозрачной обводкой в 16px (итого 128x128px).</p><p class="article__paragraph">В своих проектах мне приходится использовать скрипт для нарезки изображений. Таким образом, имея исходный PNG-файл размером 512x512px, я получаю ещё около 100 более мелких файлов. Также следует разделять изображение по стилям. Например, обычные квадратные иконки хорошо подходят для соц. сетей и старых телефонов, а при встройке в новые смартфоны лучше использовать закругленные иконки в iPhone-стиле. Быстро получить исходник такой иконки можно, воспользовавшись каким-либо онлайн-сервисом (<a href="http://testico.net/" class="article__link">http://testico.net/</a>) или настроив макрос для Photoshop`а. Что же касается сортировки сгенерированных иконок по типу, то эта задача вновь ложится на скрипт.</p><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Пример нарезки партии иконок для приложения. Каждая партия состоит из двух наборов: загругленные и прямые иконки." data-url="images/pre_pictures_1.jpg"><figcaption class="article__image_explanation">Рис. 92. Пример нарезки партии иконок для приложения. Каждая партия состоит из двух наборов: загругленные и прямые иконки.</figcaption></figure><p class="article__paragraph">Для нарезки изображений вы можете воспользоваться редактором ImageMagick, управление которым можно вести из консоли. Например:</p><pre class="article__code">convert -resize 128x128 big.png Squarecustom_icon_128.png</pre><p class="article__paragraph">Этой командой мы просим редактор сжать исходный файл big.png в изображение размером 128x128px и сохранить его в отдельный файл. Или аналогичная команда для нарезки заставки, с центрированием вырезанной части по центру исходной картинки:</p><pre class="article__code">convert splashscreen_480x800.png -resize 400x400 -gravity center -crop 240x400+0+0</pre></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="mKZSM"></a><h2 class="article__subtitle">Автотесты через API фреймворка</h2><p class="article__paragraph">Многие веб-разработчики не любят писать тесты, но тесты уменьшают количество багов, и если ваше приложение становится очень большим, от тестов вам не уйти. К тому же, в небольших компаниях веб-разработчики часто предпочитают писать код в текстовых редакторах, а это, в свою очередь, увеличивает количество ошибок, т.к. редакторы не проверяют код.</p><p class="article__paragraph">Набор проблем, с которыми мы сталкиваемся:</p><ul class="article__list"><li class="article__list_item">Разработчику лень писать сами тесты</li><li class="article__list_item">Разработчику лень писать лишний код для тестов</li><li class="article__list_item">Разработчику вообще лень думать про тесты</li></ul><p class="article__paragraph">Решение: Подключить некие общие тесты к приложению через API какого-либо фреймворка, который разработчик использовал, и прогнать авто-тесты через него.</p><p class="article__paragraph">Куда подключаться:</p><ul class="article__list"><li class="article__list_item">Функции навешивания событий (типа $("#button).click(), core.addEvent(), helper.onClick() и т.п.)</li><li class="article__list_item">Функции слушателей (типа $("#button).on(), event.listen(), mediator.listen() и т.п.)</li><li class="article__list_item">Функции инициализации (типа $(body).ready(), utils.ready() и т.п.)</li><li class="article__list_item">Функции callback`и при AJAX запросах</li></ul><p class="article__paragraph">Что проверять:</p><ul class="article__list"><li class="article__list_item">Работоспособность при некорректных аргументах</li><li class="article__list_item">Наличие случайных багов из-за опечаток (вроде пропущенной точки с запятой)</li><li class="article__list_item">Наличие всех DOM-элементов необходимых скрипту</li></ul><figure class="article__image_container"><img src="images/empty.png" class="article__image" title="Автотестирование через API библиотеки &amp;mdash; это как компьютерная диагностика двигателя. Вам не надо лезть в код модулей." data-url="images/pre_auto.jpg"><figcaption class="article__image_explanation">Рис. 93. Автотестирование через API библиотеки — это как компьютерная диагностика двигателя. Вам не надо лезть в код модулей.</figcaption></figure><p class="article__paragraph">Можно вызывать все подряд функции в try/catch с множеством случайных параметров и без них и посмотреть, какие из функций упадут с ошибкой. Кроме того, можно пробежаться по всем ссылкам и запросам DOM-элементов и проверить их наличие в верстке.</p><p class="article__paragraph">Что это нам дает:</p><p class="article__paragraph">Понятно, что это достаточно бессмысленное тестирование с точки зрения логики веб-приложения. Но, с другой стороны, мы можем без лишних усилий и на скорую руку перепроверить сборку от совсем уж глупых опечаток и нелепостей.</p><p class="article__paragraph">Бонусы:</p><ul class="article__list"><li class="article__list_item">Можно утверждать, что таким автотестом можно покрыть 90% функций приложения.</li><li class="article__list_item">Такой тест не требует абсолютно никаких усилий от разработчика в плане поддержки, обновления и т.п. Грубо говоря, он может вообще не думать о нем.</li><li class="article__list_item">Ошибки все равно будут, поэтому дополнительная проверка не бывает лишней.</li><li class="article__list_item">Чтобы провести тест, нам не надо вообще менять структуру нашего приложения.</li></ul><p class="article__paragraph">Ещё раз повторюсь:</p><ul class="article__list"><li class="article__list_item">Это не отменяет юнит-тесты.</li><li class="article__list_item">Это бессмысленно с точки зрения логики приложения.</li><li class="article__list_item">Тесты ради тестов — плохо.</li></ul><p class="article__paragraph">Но! Это быстро, бесплатно и без усилий, и это лучше, чем ничего. Если вы покажете это вашим джуниорам, они убедятся, что тестирование на самом деле просто и без боли, а значит, будут более лояльно относиться к тестам, а значит быстрее придут к мысли о написание юнит-тестов.</p><b class="article__selection">Схема работы</b><p class="article__paragraph">У нас есть наше приложение, состоящее из множества модулей. Чтобы проверить его работу, нам нужно для каждого модуля написать юнит-тест. Хорошо, если мы это сделаем, но, по факту, большинство разработчиков не будет тратить на это время, особенно в небольших приложениях. Также если взять какое-либо готовое решение для тестирования, требующее изменения кода модулей, — этого тоже никто делать не будет. С другой стороны, вставить пару функций в прослойку между библиотеками и приложением очень легко (если у вас такой прослойки нет — можно вставить эти функции в саму библиотеку). И на выходе мы уже получаем хоть какое-то тестирование. Ну а если у вас все-таки была прослойка — вообще замечательно.</p><p class="article__paragraph">Если у вас код разбит на модули и оформлен в виде:</p><pre class="article__code">(function(global) {
  var module = {
    _methodA: function() {},
    _methodB: function() {},
    _methodC: function() {},
    init: function() {}
  }
  module.init();
})(this);</pre><p class="article__paragraph">или аналогичных конструкций — тогда на опыты можно экспортировать сразу весь модуль.</p><p class="article__paragraph">У себя я завел объект test и все, что можно, — начал добавлять в него:</p><pre class="article__code">test.add();      // ждет на входе объекты типа модулей
test.addFunction();  // ждет на входе функции</pre><p class="article__paragraph">А дальше все просто. Внутри этого теста есть несколько массивов, в которые собираются можество callback`ов и модулей. На выходе есть ещё один метод:</p><pre class="article__code">test.start();</pre><p class="article__paragraph">В этот момент запускается проверка всего того, что насобиралось в массивы. И это все проверяется в try/catch конструкции с различными аргументами. Если кто-то падает, в консоль выводится уведомление и из массива берется следующая жертва для тестирования.</p><b class="article__selection">Стабы и Моки</b><p class="article__paragraph">Процитирую Сергея Теплякова: «Честно говоря, я не большой фанат изменений в дизайне только ради «тестируемости» кода. Как показывает практика, нормальный ОО дизайн либо уже является достаточно «тестируемым», или же требует лишь минимальных телодвижений, чтобы сделать его таковым. Некоторые дополнительные мысли по этому поводу можно найти в заметке «Идеальная архитектура».». Оригинал можно посмотреть тут: <a href="http://habrahabr.ru/post/134836/" class="article__link">http://habrahabr.ru/post/134836/</a></p><p class="article__paragraph">Если вы о них никогда не слышали, то стаб — это вроде сервера, или какой-то внешний объект-фальшивка, который выдает разные результаты при обращении к нему. Так сказать, объект-заглушка для тестов. Моки — то же самое, только ещё считают статистику, что и сколько раз дернули.</p><p class="article__paragraph">Нужно ли менять что-то на сервере для тестов?</p><ul class="article__list"><li class="article__list_item">Нет, мы просто поставим заглушку в месте AJAX-запроса.</li></ul><p class="article__paragraph">Нужно ли менять что-то в месте AJAX-запроса в коде приложения?</p><ul class="article__list"><li class="article__list_item">Нет, мы можем изменить саму функцию запроса в библиотеке, не трогая наш код. А следовательно, не имеет значения, где и сколько раз будет вызвана функция, — она всегда будет дергать заглушку.</li></ul><p class="article__paragraph">Например, у вас есть код:</p><pre class="article__code">$.ajax({
  url: "ajax/test.html",
  success: function(data) {
    alert(data.message);
  }
});</pre><p class="article__paragraph">Вместо того, чтобы разбирать его для тестов и вытаскивать callback, лучше разобрать ajax. Мы снова заходим со стороны API библиотеки, не трогая наш код. Разобрать jQuery или другую библиотеку и «воткнуть» в нее наши щупы непросто, но вы всегда можете написать свою тонкую прослойку между библиотекой и кодом. Это не только позволит вам добавлять тесты без боли и делать подмену реальных объектов на заглушки, но ещё дополнительным бонусом вы получите возможность переходить с одного фреймворка на другой, не меняя код проекта.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="zsjho"></a><h1 class="article__header">Offtop</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="pXWEI"></a><h2 class="article__subtitle">Сертификация JavaScript-разработчиков</h2><p class="article__paragraph">Компания, в которой я работаю, является партнёром Microsoft. Все компании-партнеры должны иметь в своем штате некоторое число сертифицированных специалистов. В один ясный солнечный день нам было предложено пройти сертификацию по какому-либо направлению. Соответствующие статьи в интернете утверждали, что сертификация — вещь полезная и проходить её стоит по нескольким причинам. Ну, а поскольку расходы все равно оплачивал работодатель, я решил углубиться в тему и пройти сразу несколько сертификаций.</p><p class="article__paragraph">Основная проблема любой сертификации заключается в том, что, по сути дела, это некая бумажка от некой компании, которая подтверждает твои знания в какой-либо отрасли. А поскольку никто никому не доверяет, в реальной жизни имеет вес только бумажка от какой-то очень большой и хорошо знакомой всем фирмы. Таких фирм в области веб-технологий я обнаружил только две: Microsoft и CIW. Они отвечали следующим требованиям:</p><ul class="article__list"><li class="article__list_item">Хорошо зарекомендовали себя и имеют вес.</li><li class="article__list_item">Сдача сертификации происходит в учебном центре.</li></ul><p class="article__paragraph">В интернете можно найти очень много онлайн-тестов, некоторые из них даже платные. Но все они остаются всего лишь тестами на каком-то никому не известном сайте. В случае Microsoft и CIW:</p><ul class="article__list"><li class="article__list_item">Это дорого. Сертификат CIW стоил более 200$ за одну попытку сдачи.</li><li class="article__list_item">Необходимо заранее зарегистрироваться.</li><li class="article__list_item">К сдаче вас допустят только при наличии двух документов, удостоверяющих личность (в моем случае это были права и паспорт).</li><li class="article__list_item">Сдача проходит в небольшой комнате. </li><li class="article__list_item">Нельзя пользоваться какими-либо устройствами и литературой, а также запрещено общаться с кем-либо.</li><li class="article__list_item">Выходить во время тестирования нельзя. </li><li class="article__list_item">Само тестирование проводится на английском языке с включенным таймером, который ограничивает вас во времени. </li><li class="article__list_item">За вами будет наблюдать видеокамера.</li><li class="article__list_item">У вас не будет возможности поискать ответ в интернете.</li></ul><p class="article__paragraph">Все это выглядело довольно убедительно и внушало доверие. </p><p class="article__paragraph">У каждой сертификации есть некий путь. Получив один сертификат, вы можете сдать другой, и так далее, пока не получите ключевой сертификат и какую-либо степень. Т.к. сертификацию Microsoft мне оплачивали, я решил пройти полную ветку по своему направлению:</p><ul class="article__list"><li class="article__list_item">70-480. Programming in HTML5 with JavaScript and CSS3</li><li class="article__list_item">70-481. Essentials of Developing Windows Store Apps using HTML5 and JavaScript</li><li class="article__list_item">70-482. Advanced Windows Store App Development using HTML5 and JavaScript</li></ul><p class="article__paragraph">В случае CIW я сдал только одно тестирование:</p><ul class="article__list"><li class="article__list_item">1D0-635. CIW JavaScript Specialist</li></ul><p class="article__paragraph">Кроме стоимости, в ветке CIW меня также смущала необходимость сдавать тестирование по Perl, который я не знал и не особо понимал перспектив его развития. Касательно самих вопросов:</p><ul class="article__list"><li class="article__list_item">Почти ко всем тестам в интернете можно найти бесплатные старые дампы и потренироваться. На практике может совпасть от 50% до 95% вопросов.</li><li class="article__list_item">Я не знаю английского (а все четыре тестирования были на английском). Местами я даже примерно не понимал вопросов и нажимал наугад. В этом плане помогает код, т.к., вне зависимости от вопроса, можно посмотреть ответы и выбрать тот, в котором не будет явных ошибок.</li><li class="article__list_item">В тестах есть ошибки и в старых дампах тоже. Многие вопросы в тестах мне показались элементарными. Многие — бессмысленными, т.к. спрашивают о вещах, которые есть только в IE. </li><li class="article__list_item">Время, которое дается на сдачу тестов, как правило, в три-четыре раза больше, чем нужно на самом деле. Так, один из сертификатов Microsoft я сдал за полчаса, хотя на тестирование было выделено три часа времени.</li><li class="article__list_item">Когда читал о сертификации, представлял её более трудной, чем было на самом деле. В зависимости от теста, она может быть очень легкой (особенно если вы многократно прошли старые дампы и научились отвечать, даже не читая вопросы и ответы).</li></ul><p class="article__paragraph">Какую выгоду я получил от прохождения сертификации:</p><p class="article__paragraph">Лично я — никакую. Поэтому не буду рекомендовать вам её проходить. Кроме того, тот же Microsoft теперь постоянно шлет мне на почту рекламные рассылки, хотя я неоднократно отписывался от них.</p><p class="article__paragraph">На всякий случай повторюсь, что все описанное выше относится только к сертификации по JavaScript. Знакомая, которая сдавала сертификацию по SQL, пару месяцев тренировалась на оптимизации запросов длиною в страницу формата А4, так что все субъективно.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="YnDrs"></a><h2 class="article__subtitle">Собеседование JS-программистов</h2><p class="article__paragraph">Задачи на техническом собеседовании обычно бывают двух видов:</p><ul class="article__list"><li class="article__list_item">Простые. Как правило, оформляются в виде теста.</li><li class="article__list_item">Сложные. Как правило, требуют развернутого ответа или знания какого-либо трюка.</li></ul><p class="article__paragraph">В данном разделе рассматривается ряд задач с развернутым ответом, а в приложении вы сможете найти список типовых вопросов на тестировании.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="QysVn"></a><h2 class="article__subtitle">Задача на выделение N комментариев</h2><b class="article__selection">Ситуация</b><p class="article__paragraph">У нас есть запись на сайте и N комментариев к ней, M из которых являются новыми и должны быть выделены другим цветом. С помощью AJAX-запроса мы получили ещё K новых комментариев с сервера и вставили их в документ.</p><b class="article__selection">Цель</b><p class="article__paragraph">Нам необходимо выделить K новых комментариев и убрать выделение с M старых с минимальным количеством действий.</p><b class="article__selection">Решение</b><p class="article__paragraph">Любой подход, в котором необходимо перебирать DOM-элементы, является заведомо проигрышным. Чем больше комментариев, тем больше времени уйдет на решение задачи. Самым выгодным в данном случае является подход, при котором необходимо генерировать CSS-классы с индексом AJAX-запроса.</p><p class="article__paragraph">Пример для первой пачки комментариев:</p><pre class="article__code">.comment__1 {
  color: red;
}

&lt;p class="comment__1"&gt;Это новый комментарий к записи&lt;/p&gt;
&lt;p class="comment__0"&gt;Это старый комментарий к записи&lt;/p&gt;</pre><p class="article__paragraph">Когда мы получим новые данные, то перепишем наш CSS и увеличим индекс на единицу:</p><pre class="article__code">.comment__2 {
  color: red;
}

&lt;p class="comment__2"&gt;Это супер-новый комментарий к записи&lt;/p&gt;
&lt;p class="comment__1"&gt;Это новый комментарий к записи&lt;/p&gt;
&lt;p class="comment__0"&gt;Это старый комментарий к записи&lt;/p&gt;</pre><p class="article__paragraph">Таким образом, наш код всегда отрабатывает за фиксированное время, вне зависимости от количества комментариев.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="MQqRm"></a><h2 class="article__subtitle">Задача на быстрый поиск</h2><p class="article__paragraph">Суть оптимизации состоит в использовании объекта вместо массива, т.к. объект в JavaScript является, по сути, хэш-таблицей, из которой можно моментально достать значение по названию свойства. Есть несколько задач на эту тему.</p><b class="article__selection">Ситуация 1</b><p class="article__paragraph">Есть некий массив городов с параметрами. Зная название города, нужно максимально быстро сделать выборку и получить параметры города.</p><b class="article__selection">Ситуация 2</b><p class="article__paragraph">Есть некий массив с объектами. У каждого объекта есть свой идентификатор. Нужно максимально быстро сделать выборку уникальных объектов.</p><b class="article__selection">Решение</b><p class="article__paragraph">Решение обеих задач заключается в том, что вместо массива необходимо использовать объект.  В случае городов выборка моментальная и осуществляется в одно действие:</p><pre class="article__code">var city = {
  moscow: ...
  piter: ...
};

var information = city["moscow"];</pre><p class="article__paragraph">В случае выборки уникальных объектов:</p><pre class="article__code">var animals = [
  { id: "dog" },
  { id: "cat" },
  { id: "dog" }
];

var uniqueAnimals = {};
for(var i = 0; i &lt; 3; i++) {
  var item = animals[i];
  uniqueAnimals[item.id] = item;
}</pre><p class="article__paragraph">Если внести в объект два свойства с одним названием, то последнее перезапишет первое.</p><p class="article__paragraph">Каждый раз перед созданием массива задумывайтесь, насколько вам нужна возможность быстро обратиться к конкретному элементу и должны ли элементы быть уникальными. Если да — возможно, стоит использовать объект.</p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="WklLM"></a><h2 class="article__subtitle">Использованные источники</h2><ul class="article__list"><li class="article__list_item">Секреты разработки игр на macromedia Flash MX.<br>Flash MX 2004 Game Design. Jobe Makar<br>(если будете её покупать, ищите самые последние издания)<br><br></li><li class="article__list_item">Собрание сочинений о флэше.<br>Урок: «Базовые алгоритмы определения столкновений»<br>Raigan Burns, Mare Sheppard<br><a href="http://noregret.org/tutor/n/collision/" class="article__link">http://noregret.org/tutor/n/collision/</a><br><br></li><li class="article__list_item">Курс лекций «From Junior To Senior»<br>Андрея Короткова<br><a href="http://www.youtube.com/user/megadrone86/videos" class="article__link">http://www.youtube.com/user/megadrone86/videos</a><br><br></li><li class="article__list_item">Статья «Byte-saving Techniques»<br>Джед Шмидт, Томас Фухс и Дастин Диаз<br><a href="https://github.com/jed/140bytes/wiki/Byte-saving-techniques" class="article__link">https://github.com/jed/140bytes/wiki/Byte-saving-techniques</a><br><br></li><li class="article__list_item">Статья «Мирный XSS»<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/46339/" class="article__link">http://habrahabr.ru/post/46339/</a><br><br></li><li class="article__list_item">Статья «Расширенный сборник CSS-хаков»<br>Рустам<br><a href="http://habrahabr.ru/post/62002/" class="article__link">http://habrahabr.ru/post/62002/</a><br><br></li><li class="article__list_item">Статья «Сборник хаков»<br>dfuse<br><a href="http://habrahabr.ru/post/43318/" class="article__link">http://habrahabr.ru/post/43318/</a><br><br></li><li class="article__list_item">Корпоративный блог журнала «Хакер», 2011 год.<br>Николай Андреев<br><a href="http://habrahabr.ru/company/xakep/blog/128741/" class="article__link">http://habrahabr.ru/company/xakep/blog/128741/</a><br><br></li><li class="article__list_item">Статья «Обфускация JavaScript»<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/112530/" class="article__link">http://habrahabr.ru/post/112530/</a><br><br></li><li class="article__list_item">Серия статей «Верстка писем и рассылок»<br>Артур Кох<br><a href="http://habrahabr.ru/users/dudeonthehorse/" class="article__link">http://habrahabr.ru/users/dudeonthehorse/</a><br><br></li><li class="article__list_item">Статья «CSS хаки»<br>Иванов Павел Михайлович<br><a href="http://habrahabr.ru/post/125396/" class="article__link">http://habrahabr.ru/post/125396/</a><br><br></li><li class="article__list_item">Статья «Игра в 0 строк кода на чистом JS»<br>Александр Майоров<br><a href="http://habrahabr.ru/post/203048/" class="article__link">http://habrahabr.ru/post/203048/</a><br><br></li><li class="article__list_item">Статья «Конкурс уязвимостей, или Ломай меня полностью!»<br>Еремин Станислав<br><a href="http://habrahabr.ru/company/badoo/blog/175865/" class="article__link">http://habrahabr.ru/company/badoo/blog/175865/</a><br><br></li><li class="article__list_item">Статья «Ищите ошибки с помощью Google или «взлом» аккаунтов на badoo.com»<br>Анна<br><a href="http://habrahabr.ru/post/189040/" class="article__link">http://habrahabr.ru/post/189040/</a><br><br></li><li class="article__list_item">Статья «Локализация html-страницы средствами CSS»<br>Антон Лунев<br><a href="http://habrahabr.ru/post/121075/" class="article__link">http://habrahabr.ru/post/121075/</a><br><br></li><li class="article__list_item">Доклад «Как просить деньги через телевизор?»<br>Екатерина Юлина, ProfsoUX, Санкт-Петербург, 26 апреля 2014 года.<br><a href="http://2014.profsoux.ru/papers/56/" class="article__link">http://2014.profsoux.ru/papers/56/</a><br><br></li><li class="article__list_item">Доклад «l20n как система локализации»<br>Антон Немцев, DUMP 2014, Екатеринбург, 14 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link">http://fronttalks.ru/2014/13-14march.html</a><br><br></li><li class="article__list_item">Доклад «Веб интерфейсы на touch устройствах»<br>Иван Чашкин, DUMP 2014, Екатеринбург, 14 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link">http://fronttalks.ru/2014/13-14march.html</a><br><br></li><li class="article__list_item">Доклад «Криокамера для статики»<br>Алексей Андросов, Я.Субботник, Киев, 27 апреля 2013 года.<br><a href="http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/837/" class="article__link">http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/837/</a><br><br></li><li class="article__list_item">Доклад «Инкрементальные обновления на клиенте»<br>Михаил Корепанов, Я.Субботник, Киев, 27 апреля 2013 года.<br><a href="http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/836/" class="article__link">http://tech.yandex.ru/events/yasubbotnik/kiev-apr-2013/talks/836/</a><br><br></li><li class="article__list_item">Доклад «Extreme JavaScript Minification and Obfuscation»<br>Сергей Ильинский<br>12 октября 2010 года<br><br></li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="urBWa"></a><h2 class="article__subtitle">Рекомендуемые материалы</h2><ul class="article__list"><li class="article__list_item">Ajax для профессионалов.<br>Professional Ajax.<br>Nicholas C. Zakas, Jeremy McPeak, Joe Fawcett<br><br></li><li class="article__list_item">JavaScript. Шаблоны.<br>JavaScript Patterns.<br>Stoyan Stefanov<br><br></li><li class="article__list_item">Веб-приложения на JavaScript.<br>JavaScript Web Applications.<br>Alex MacCaw<br><br></li><li class="article__list_item">Универсальные принципы дизайна.<br>Universal Principles of Design.<br>W. Lidwell, K. Holden and J. Butler<br><br></li><li class="article__list_item">Ошибки веб-дизайна или как их устранить до того, как вы лишитесь посетителей.<br>Defensive Design for the Web.<br>Matthew Linderman, Jason Fried<br><br></li><li class="article__list_item">Читаемый код или Программирование как искусство.<br>The Art of Readable Code (Theory in Practice).<br>Dustin Boswell, Trevor Foucher<br><br></li><li class="article__list_item">Дизайн уровней. Теория и практика.<br>Михаил Кадиков<br><a href="http://pro.level-design.ru/" class="article__link">http://pro.level-design.ru/</a><br><br></li><li class="article__list_item">Техногрет.<br>Статьи и заметки технологов студии Артемия Лебедева<br><a href="http://www.artlebedev.ru/tools/technogrette/" class="article__link">http://www.artlebedev.ru/tools/technogrette/</a><br><br></li><li class="article__list_item">CSS Animation Tricks: State Jumping, Negative Delays, Animating Origin, and More<br>Zach Saucier<br><a href="http://css-tricks.com/css-animation-tricks/" class="article__link">http://css-tricks.com/css-animation-tricks/</a><br><br></li><li class="article__list_item">Статья «Рекламный баннер = поставщик данных»<br>Михаил Давыдов<br><a href="http://habrahabr.ru/post/106202/" class="article__link">http://habrahabr.ru/post/106202/</a><br><br></li><li class="article__list_item">Доклад «Веб-интерфейсы на touch-устройствах»<br>Иван Чашкин, DUMP 2014, Екатеринбург, 14 марта 2014 года.<br><a href="http://fronttalks.ru/2014/13-14march.html" class="article__link">http://fronttalks.ru/2014/13-14march.html</a><br><br></li><li class="article__list_item">Доклад «Идеологии разработки веб-интерфейсов, адаптивность, accessibility»<br>Сергей Горобцов, Екатеринбург, 7 ноября 2013 года<br><a href="https://tech.yandex.ru/education/shri/ekb-2013/talks/1500/" class="article__link">https://tech.yandex.ru/education/shri/ekb-2013/talks/1500/</a><br><br></li><li class="article__list_item">Доклад «Производительность клиент сайда через тестирование скорости отрисовки страниц»<br>Марина Широчкина. Санкт-Петербург, 1 декабря 2012 года<br><a href="http://tech.yandex.ru/events/yasubbotnik/spb-dec-2012/talks/479/" class="article__link">http://tech.yandex.ru/events/yasubbotnik/spb-dec-2012/talks/479/</a><br><br></li><li class="article__list_item">Доклад «Драматическая история одной маленькой промостраницы»<br>Олег Мохов. Санкт-Петербург, 30 июня 2012 года<br><a href="http://clubs.ya.ru/yasubbotnik/replies.xml?item_no=538" class="article__link">http://clubs.ya.ru/yasubbotnik/replies.xml?item_no=538</a><br><br></li><li class="article__list_item">Доклад «Масштабируемые JavaScript-приложения»<br>Михаил Давыдов, Я.Субботник, Челябинск, 25 февраля 2012 года.<br><a href="http://tech.yandex.ru/events/yasubbotnik/chlb-feb-2012/talks/154/" class="article__link">http://tech.yandex.ru/events/yasubbotnik/chlb-feb-2012/talks/154/</a><br><br></li></ul></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="CtAVH"></a><h2 class="article__subtitle">Заключение</h2><p class="article__paragraph">Скачать эту книгу в формате JSON можно на сайте <a href="http://bakhirev.biz/" class="article__link">http://bakhirev.biz/</a>, там же бесплатно доступны и другие форматы, в том числе и видеозаписи с различных конференций по темам, описанным в данной книге. Писать <strike>негативные</strike> отзывы <strike>и анонимные угрозы</strike> можно на адрес <a href="mailto:alexey-bakhirev@yandex.ru" class="article__link">alexey-bakhirev@yandex.ru</a>. Также можно <strike>понизить</strike> повысить карму аккаунту на хабре <a href="http://habrahabr.ru/users/bakhirev/" class="article__link">http://habrahabr.ru/users/bakhirev/</a> или добавить контакт в LinkenIn <a href="http://ru.linkedin.com/pub/alexey-bakhirev/89/838/7b0/" class="article__link">http://ru.linkedin.com/pub/alexey-bakhirev/89/838/7b0/</a>.</p><p class="article__paragraph_2ch"><br>sup /b/ 01.09.2014<br><strike>sup /mo/ 01.09.2014</strike><br><strike>sup /rf/ 01.09.2014</strike></p></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="WnZJF"></a><h1 class="article__header">Приложение</h1></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="oidLN"></a><h2 class="article__subtitle">Формулы расчета столкновений</h2><p class="article__paragraph">Во многих книгах про разработку игр пропускают момент обсчета столкновений либо не приводят формулы в явном виде. Ниже вы сможете увидеть небольшой набор функций для обсчета столкновений двух прямоугольников без вращения. </p><p class="article__paragraph">Каждый объект двухмерной плоскости обладает минимальной и максимальной координатой по осям X и Y. В JavaScript`е эти координаты можно записать следующим образом:</p><pre class="article__code">{
  x: {
    min: 0,
    max: 10
  },
  y: {
    min: 0,
    max: 10
  }
}</pre><p class="article__paragraph">Узнать, пересекаются два прямоугольника или нет, можно, вызвав следующую функцию:</p><pre class="article__code">function intersection(A, B) {
  var x = (A.x.max - A.x.min + B.x.max - B.x.min
        - Math.abs(A.x.max + A.x.min - B.x.max - B.x.min)) / 2,
    y = (A.y.max - A.y.min + B.y.max - B.y.min
        - Math.abs(A.y.max + A.y.min - B.y.max - B.y.min)) / 2;
  return (x &gt; 0 &amp;&amp; y &gt; 0);
}</pre><p class="article__paragraph">Но при поиске столкновений также нужно узнать, насколько один прямоугольник вошел в другой, чтобы отодвинуть их друг от друга:</p><pre class="article__code">function penetration(A, B) {
  var dx = A.x.max + A.x.min - B.x.max - B.x.min,
    dy = A.y.max + A.y.min - B.y.max - B.y.min,
    x = (A.x.max - A.x.min + B.x.max - B.x.min - Math.abs(dx)) / 2,
    y = (A.y.max - A.y.min + B.y.max - B.y.min - Math.abs(dy)) / 2;
  if (x &gt; 0 &amp;&amp; y &gt; 0) return {
    x: x,
    y: y,
    direction: {
      x: dx / Math.abs(dx),
      y: dy / Math.abs(dy)
    }
  };
  return null;
}</pre><p class="article__paragraph">Функция выше вернет проникновение по каждой из координат, либо null, если столкновения прямоугольников не было. Свойство direction будет указывать направление проникновения, чтобы можно было понять, с какой стороны прямоугольника произошло столкновение.</p><p class="article__paragraph">При написании «мозгов» для ботов функция определения направления может понадобиться отдельно, чтобы указывать боту, где находятся его враги:</p><pre class="article__code">function direction(A, B) {
  var x = A.x.max + A.x.min - B.x.max - B.x.min,
    y = A.y.max + A.y.min - B.y.max - B.y.min;
  return {
    x: x / Math.abs(x),
    y: y / Math.abs(y)
  };
}</pre><p class="article__paragraph">Чтобы узнать растояние между двумя объектами, можно использовать функцию вида:</p><pre class="article__code">function distance(A, B) {
  var x = Math.abs(A.x.max + A.x.min - B.x.max - B.x.min),
    y = Math.abs(A.y.max + A.y.min - B.y.max - B.y.min);
  return Math.sqrt((x * x + y * y));
}</pre><p class="article__paragraph">Таким образом, мы можем сделать предположение о зоне поражения оружия.</p><p class="article__paragraph">Чтобы узнать, кто из врагов потенциально попадает в зону поражения оружия, мы можем использовать следующую функцию:</p><pre class="article__code">getVictim: function (A, data) {
  var victims = [];
  for (var i = 0, l = data.length; i &lt; l; i++) {
    if (intersection(A, data[i])) {
      victims.push(data[i]);
    }
  }
  if(victims.length) {
    return victims;
  }
  return false;
}</pre><p class="article__paragraph">Функция ожидает на входе зону поражения и массив объектов, для которых следует определить вхождение.</p><p class="article__paragraph">Определив массив врагов в зоне поражения, мы можем рассчитать, кто из них получит урон от выстрела. Если для стрельбы мы используем простой алгоритм, без создания объекта снаряда, а просто перебирая объекты по прямой, то нам нужна функция, которая найдет ближайший к нам объект в заданном диапазоне:</p><pre class="article__code">function nearestLeft(data) {
  var max = data[0].x.max,
    index = null;
  for (var i = 0, l = data.length; i &lt; l; i++) {
    if ((data[i].x.max) &gt;= max) {
      max = data[i].x.max;
      index = i;
    }
  }
  return data[index] || false;
}</pre><p class="article__paragraph">В качестве аргумента данная функция ожидает массив объектов, а возвращает индекс ближайшего слева объекта. Чтобы найти ближайшие объекты справа, сверху и снизу, необходимо использовать соответствующие функции:</p><pre class="article__code">function nearestRight(data) {
  var min = data[0].x.min,
    index = null;
  for (var i = 0, l = data.length; i &lt; l; i++)
    if ((data[i].x.min) &lt;= min) {
      max = data[i].x.max;
      index = i;
    }
  }
  return data[index] || false;
}

function nearestUp(data) {
  var min = data[0].y.min,
    index = null;
  for (var i = 0, l = data.length; i &lt; l; i++) {
    if ((data[i].y.min) &lt;= min) {
      min = data[i].y.min;
      index = i;
    }
  }
  return data[index] || false;
}

function nearestDown(data) {
  var max = data[0].y.max,
    index = null;
  for (var i = 0, l = data.length; i &lt; l; i++)
    if ((data[i].y.max) &gt;= max) {
      max = data[i].y.max;
      index = i;
    }
  }
  return data[index] || false;
}</pre><p class="article__paragraph">Конечно, можно было оптимизировать код и использовать одну «супер» функцию, но это не выгодно с точки зрения производительности, т.к. функции высоконагруженные и чем меньше условий и переменных, тем лучше. Вызывать для каждой конкретной ситуации конкретную оптимизированную функцию выгоднее с точки зрения производительности.</p><p class="article__paragraph">Узнать, пересекаются прямые или нет, можно таким образом:</p><pre class="article__code">function intersectionSegments(A, B) {
  var v1 = (B.x.max - B.x.min) * (A.y.min - B.y.min)
        - (B.y.max - B.y.min) * (A.x.min - B.x.min),
    v2 = (B.x.max - B.x.min) * (A.y.max - B.y.min)
        - (B.y.max - B.y.min) * (A.x.max - B.x.min),
    v3 = (A.x.max - A.x.min) * (B.y.min - A.y.min)
        - (A.y.max - A.y.min) * (B.x.min - A.x.min),
    v4 = (A.x.max - A.x.min) * (B.y.max - A.y.min)
        - (A.y.max - A.y.min) * (B.x.max - A.x.min);
  return ((v1 * v2 &lt;= 0) &amp;&amp; (v3 * v4 &lt;= 0));
}</pre><section class="article__note"><p class="article__paragraph_note">Узнать больше об обсчете столкновений можно в двух хороших книгах:</p><ul class="article__list_note"><li class="article__list_item_note">Собрание сочинений о флэше.<br>Урок: «Базовые алгоритмы определения столкновений»<br>Raigan Burns, Mare Sheppard<br><a href="http://noregret.org/tutor/n/collision/" class="article__link_note">http://noregret.org/tutor/n/collision/</a><br><br></li><li class="article__list_item_note">Секреты разработки игр на macromedia Flash MX<br>Flash MX 2004 Game Design. Jobe Makar<br>(если будете её покупать, ищите самые последние издания)</li></ul></section></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="Vudxt"></a><h2 class="article__subtitle">Вопросы на собеседовании</h2><ol class="article__enumerate"><li class="article__enumerate_item">Что вернет element.getElementsByTagName("div")?</li><li class="article__enumerate_item">Что вернет element.querySelectorAll("div")?</li><li class="article__enumerate_item">Что вернет element.querySelector("div")?</li><li class="article__enumerate_item">Что вернет typeof null?</li><li class="article__enumerate_item">Как повлияет на массив arr вызов метода push(a)?</li><li class="article__enumerate_item">Что вернет typeof typeof foo?</li><li class="article__enumerate_item">Что вернет метод pop() для массива?</li><li class="article__enumerate_item">Где создаются переменные объявленные следующим образом:<pre class="article__code">a = 3; b = "hello";</pre></li><li class="article__enumerate_item">Что вернет такой код typeof (function(){})()?</li><li class="article__enumerate_item">Что произойдёт в результате выполнения следующего кода?<pre class="article__code">({
  method: function() {
    (function() {
      alert(this);
    })();
  }
}).method();</pre></li><li class="article__enumerate_item">Что произойдёт в результате выполнения следующего кода?<pre class="article__code">function Book() {
  this.name = "foo";
}

Book.prototype = {
  getName: function() {
    return this.name;
  }
}

var book = new Book();

Book.prototype.getUpperName = function() {
  return this.name.toUpperCase();
}

book.getUpperName();</pre></li><li class="article__enumerate_item">Какое значение будет в A.c?<pre class="article__code">var A = B = {};
A.c = 1;
B.c = 2;</pre></li><li class="article__enumerate_item">Какое значение будет возвращено?<pre class="article__code">return
{
  status: true
};</pre></li><li class="article__enumerate_item">Свойство full запишется в объект rabbit или animal?<pre class="article__code">var animal = {},
  rabbit = {};

rabbit.__proto__ = animal;

animal.eat = function() {
  this.full = true;
};

rabbit.eat();</pre></li><li class="article__enumerate_item">Какие значения будут выводиться в коде ниже?<pre class="article__code">var animal = {
    jumps: null
  },
  rabbit = {
    jumps: null
  };

rabbit.__proto__ = animal;
console.log(rabbit.jumps);

delete rabbit.jumps;
console.log(rabbit.jumps);

delete animal.jumps;
console.log(rabbit.jumps);</pre></li><li class="article__enumerate_item">Каковы будут результаты выполнения?<pre class="article__code">function Rabbit() {}

Rabbit.prototype = {
  eats: true
};

var rabbit = new Rabbit();

1. Rabbit.prototype = {};
2. Rabbit.prototype.eats = false;
3. delete Rabbit.prototype.eats;
4. delete rabbit.eats;

console.log(rabbit.eats);</pre></li><li class="article__enumerate_item">Как проверить, является ли переменная X массивом?</li><li class="article__enumerate_item">Какова длина a.length массива a:<pre class="article__code">var a = [];
a[1] = 5;
a[3] = 53;
delete a[3];</pre></li><li class="article__enumerate_item">Чему равно a + b + c?<pre class="article__code">var a = 1
var b = {
  toString: function() {
    return "1";
  }
};
var c = Object(1);</pre></li><li class="article__enumerate_item">Что будет результатом работы?<pre class="article__code">var list = [];
for (var i = 0; i &lt; 5; i++) {
  list[i] = function() {
    alert(i);
  }
}
list[2]();</pre></li><li class="article__enumerate_item">Каких бинарных операторов НЕТ в javascript?<pre class="article__code">*, ^, %, #, &amp;, &gt;&gt;, &gt;&gt;&gt;, !</pre></li><li class="article__enumerate_item">Что делает оператор === ?</li><li class="article__enumerate_item">Чему равна переменная name?<pre class="article__code">var name = "пупкин".replace("п","д");</pre></li><li class="article__enumerate_item">Какие обработчики событий сработают при клике на div?<pre class="article__code">div.onclick = function() {
  alert(1);
}

div.onclick = function() {
  alert(2);
}</pre></li><li class="article__enumerate_item">Что будет результатом работы?<pre class="article__code">typeof(null);</pre></li><li class="article__enumerate_item">Что будет результатом работы?<pre class="article__code">Object.keys(null);</pre></li></ol></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="lLlKK"></a><h2 class="article__subtitle">Ответы на вопросы</h2><ol class="article__enumerate"><li class="article__enumerate_item">Все элементы DIV, у которых есть предок element.</li><li class="article__enumerate_item">Все DIV-элементы внутри element.</li><li class="article__enumerate_item">То же самое, что и element.querySelectorAll("div")[0]</li><li class="article__enumerate_item">Вернет:<pre class="article__code">object</pre></li><li class="article__enumerate_item">Так же как и:<pre class="article__code">arr[arr.length] = a;</pre></li><li class="article__enumerate_item">Всегда string. Функция typeof foo возвращает строку. В зависимости от foo - она может быть разной, но в любом случае это будет строка, что и подтвердит первый typeof, вернув «string».</li><li class="article__enumerate_item">Последний элемент. Размер массива уменьшится на единицу.</li><li class="article__enumerate_item">В глобальном контексте. В локальном контексте переменные создаются, если есть var.</li><li class="article__enumerate_item">undefined, т.к. в фунции нет команды вернуть что-либо.</li><li class="article__enumerate_item">Alert покажет window, т.к. никаких переменных или контекста вызова мы не передавали.</li><li class="article__enumerate_item">Вернет FOO, т.к. порядок объявления прототипов не имеет значения.</li><li class="article__enumerate_item">Два, из-за того, что передается ссылка на объект.</li><li class="article__enumerate_item">undefined, из-за переноса на следующую строку.</li><li class="article__enumerate_item">В rabbit.</li><li class="article__enumerate_item">Будут выводиться следующие значения:<pre class="article__code">null
null
undefined</pre></li><li class="article__enumerate_item">Результатом будет:<pre class="article__code">1. true
2. false
3. undefined
4. true</pre></li><li class="article__enumerate_item">Проверить на массив можно таким образом:<pre class="article__code">if(X instanceof Array) { ... }</pre></li><li class="article__enumerate_item">Длина равна четырём, т.к. delete удаляет значение, но не меняет длину.</li><li class="article__enumerate_item">Результатом будет:<pre class="article__code">111</pre></li><li class="article__enumerate_item">Покажет пять, т.к. нет замыкания и alert выведет последнее значение i, а не промежуточное. Чтобы выводить промежуточные значения, необходимо замыкать контекст:<pre class="article__code">var list = [];
for (var i = 0; i &lt; 5; i++) {
  list[i] = (function(x) {
    return function() {
      alert(x);
    }
  })(i);
}
list[2](); // Покажет 2</pre></li><li class="article__enumerate_item"># и !</li><li class="article__enumerate_item">Сравнивает переменные без приведения типа. Например:<pre class="article__code">5 == '5'   // true
5 === '5'  // false</pre></li><li class="article__enumerate_item">Дупкин, т.к. мы ищем без regExp выражения. Для результата «дудкин» необходимо изменить выражение:<pre class="article__code">var name = "пупкин".replace(/[п]+/g, "д");</pre></li><li class="article__enumerate_item">Только второй, т.к. он перезатрет первый.</li><li class="article__enumerate_item">Результатом будет:<pre class="article__code">object</pre></li><li class="article__enumerate_item">Результатом будет:<pre class="article__code">TypeError: null is not an object</pre></li></ol></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="qWlyR"></a><h2 class="article__subtitle">Таблица кодов кнопок клавиатуры</h2><p class="article__comment">Таблица №1. Коды кнопок клавиатуры.</p><table class="table_em"><thead class="table_em__tr__grey"><tr><td class="table_em__head_td_em">Кнопка</td><td class="table_em__head_td_px">Код</td><td class="table_em__head_td_em">Кнопка</td><td class="table_em__head_td_px">Код</td><td class="table_em__head_td_em">Кнопка</td><td class="table_em__head_td_px">Код</td><td class="table_em__head_td_em">Кнопка</td><td class="table_em__head_td_px">Код</td></tr></thead><tbody><tr class="table_em__tr"><td class="table_em__td_char">backspace</td><td class="table_em__td_code">8</td><td class="table_em__td_char">6</td><td class="table_em__td_code">54</td><td class="table_em__td_char">v</td><td class="table_em__td_code">86</td><td class="table_em__td_char">f3</td><td class="table_em__td_code">114</td></tr><tr class="table_em__tr"><td class="table_em__td_char">tab</td><td class="table_em__td_code">9</td><td class="table_em__td_char">7</td><td class="table_em__td_code">55</td><td class="table_em__td_char">w</td><td class="table_em__td_code">87</td><td class="table_em__td_char">f4</td><td class="table_em__td_code">115</td></tr><tr class="table_em__tr"><td class="table_em__td_char">enter</td><td class="table_em__td_code">13</td><td class="table_em__td_char">8</td><td class="table_em__td_code">56</td><td class="table_em__td_char">x</td><td class="table_em__td_code">88</td><td class="table_em__td_char">f5</td><td class="table_em__td_code">116</td></tr><tr class="table_em__tr"><td class="table_em__td_char">shift</td><td class="table_em__td_code">16</td><td class="table_em__td_char">9</td><td class="table_em__td_code">57</td><td class="table_em__td_char">y</td><td class="table_em__td_code">89</td><td class="table_em__td_char">f6</td><td class="table_em__td_code">117</td></tr><tr class="table_em__tr"><td class="table_em__td_char">ctrl</td><td class="table_em__td_code">17</td><td class="table_em__td_char">a</td><td class="table_em__td_code">65</td><td class="table_em__td_char">z</td><td class="table_em__td_code">90</td><td class="table_em__td_char">f7</td><td class="table_em__td_code">118</td></tr><tr class="table_em__tr"><td class="table_em__td_char">alt</td><td class="table_em__td_code">18</td><td class="table_em__td_char">b</td><td class="table_em__td_code">66</td><td class="table_em__td_char">left window key</td><td class="table_em__td_code">91</td><td class="table_em__td_char">f8</td><td class="table_em__td_code">119</td></tr><tr class="table_em__tr"><td class="table_em__td_char">pause/break</td><td class="table_em__td_code">19</td><td class="table_em__td_char">c</td><td class="table_em__td_code">67</td><td class="table_em__td_char">right window key</td><td class="table_em__td_code">92</td><td class="table_em__td_char">f9</td><td class="table_em__td_code">120</td></tr><tr class="table_em__tr"><td class="table_em__td_char">caps lock</td><td class="table_em__td_code">20</td><td class="table_em__td_char">d</td><td class="table_em__td_code">68</td><td class="table_em__td_char">select key</td><td class="table_em__td_code">93</td><td class="table_em__td_char">f10</td><td class="table_em__td_code">121</td></tr><tr class="table_em__tr"><td class="table_em__td_char">escape</td><td class="table_em__td_code">27</td><td class="table_em__td_char">e</td><td class="table_em__td_code">69</td><td class="table_em__td_char">numpad 0</td><td class="table_em__td_code">96</td><td class="table_em__td_char">f11</td><td class="table_em__td_code">122</td></tr><tr class="table_em__tr"><td class="table_em__td_char">page up</td><td class="table_em__td_code">33</td><td class="table_em__td_char">f</td><td class="table_em__td_code">70</td><td class="table_em__td_char">numpad 1</td><td class="table_em__td_code">97</td><td class="table_em__td_char">f12</td><td class="table_em__td_code">123</td></tr><tr class="table_em__tr"><td class="table_em__td_char">page down</td><td class="table_em__td_code">34</td><td class="table_em__td_char">g</td><td class="table_em__td_code">71</td><td class="table_em__td_char">numpad 2</td><td class="table_em__td_code">98</td><td class="table_em__td_char">num lock</td><td class="table_em__td_code">144</td></tr><tr class="table_em__tr"><td class="table_em__td_char">end</td><td class="table_em__td_code">35</td><td class="table_em__td_char">h</td><td class="table_em__td_code">72</td><td class="table_em__td_char">numpad 3</td><td class="table_em__td_code">99</td><td class="table_em__td_char">scroll lock</td><td class="table_em__td_code">145</td></tr><tr class="table_em__tr"><td class="table_em__td_char">home</td><td class="table_em__td_code">36</td><td class="table_em__td_char">i</td><td class="table_em__td_code">73</td><td class="table_em__td_char">numpad 4</td><td class="table_em__td_code">100</td><td class="table_em__td_char">semi-colon</td><td class="table_em__td_code">186</td></tr><tr class="table_em__tr"><td class="table_em__td_char">left arrow</td><td class="table_em__td_code">37</td><td class="table_em__td_char">j</td><td class="table_em__td_code">74</td><td class="table_em__td_char">numpad 5</td><td class="table_em__td_code">101</td><td class="table_em__td_char">equal sign</td><td class="table_em__td_code">187</td></tr><tr class="table_em__tr"><td class="table_em__td_char">up arrow</td><td class="table_em__td_code">38</td><td class="table_em__td_char">k</td><td class="table_em__td_code">75</td><td class="table_em__td_char">numpad 6</td><td class="table_em__td_code">102</td><td class="table_em__td_char">comma</td><td class="table_em__td_code">188</td></tr><tr class="table_em__tr"><td class="table_em__td_char">right arrow</td><td class="table_em__td_code">39</td><td class="table_em__td_char">l</td><td class="table_em__td_code">76</td><td class="table_em__td_char">numpad 7</td><td class="table_em__td_code">103</td><td class="table_em__td_char">dash</td><td class="table_em__td_code">189</td></tr><tr class="table_em__tr"><td class="table_em__td_char">down arrow</td><td class="table_em__td_code">40</td><td class="table_em__td_char">m</td><td class="table_em__td_code">77</td><td class="table_em__td_char">numpad 8</td><td class="table_em__td_code">104</td><td class="table_em__td_char">period</td><td class="table_em__td_code">190</td></tr><tr class="table_em__tr"><td class="table_em__td_char">insert</td><td class="table_em__td_code">45</td><td class="table_em__td_char">n</td><td class="table_em__td_code">78</td><td class="table_em__td_char">numpad 9</td><td class="table_em__td_code">105</td><td class="table_em__td_char">forward slash</td><td class="table_em__td_code">191</td></tr><tr class="table_em__tr"><td class="table_em__td_char">delete</td><td class="table_em__td_code">46</td><td class="table_em__td_char">o</td><td class="table_em__td_code">79</td><td class="table_em__td_char">multiply</td><td class="table_em__td_code">106</td><td class="table_em__td_char">grave accent</td><td class="table_em__td_code">192</td></tr><tr class="table_em__tr"><td class="table_em__td_char">0</td><td class="table_em__td_code">48</td><td class="table_em__td_char">p</td><td class="table_em__td_code">80</td><td class="table_em__td_char">add</td><td class="table_em__td_code">107</td><td class="table_em__td_char">open bracket</td><td class="table_em__td_code">219</td></tr><tr class="table_em__tr"><td class="table_em__td_char">1</td><td class="table_em__td_code">49</td><td class="table_em__td_char">q</td><td class="table_em__td_code">81</td><td class="table_em__td_char">subtract</td><td class="table_em__td_code">109</td><td class="table_em__td_char">back slash</td><td class="table_em__td_code">220</td></tr><tr class="table_em__tr"><td class="table_em__td_char">2</td><td class="table_em__td_code">50</td><td class="table_em__td_char">r</td><td class="table_em__td_code">82</td><td class="table_em__td_char">decimal point</td><td class="table_em__td_code">110</td><td class="table_em__td_char">close braket</td><td class="table_em__td_code">221</td></tr><tr class="table_em__tr"><td class="table_em__td_char">3</td><td class="table_em__td_code">51</td><td class="table_em__td_char">s</td><td class="table_em__td_code">83</td><td class="table_em__td_char">divide</td><td class="table_em__td_code">111</td><td class="table_em__td_char">single quote</td><td class="table_em__td_code">222</td></tr><tr class="table_em__tr"><td class="table_em__td_char">4</td><td class="table_em__td_code">52</td><td class="table_em__td_char">t</td><td class="table_em__td_code">84</td><td class="table_em__td_char">f1</td><td class="table_em__td_code">112</td><td class="table_em__td_char">&nbsp;</td><td class="table_em__td_code">&nbsp;</td></tr><tr class="table_em__tr"><td class="table_em__td_char">5</td><td class="table_em__td_code">53</td><td class="table_em__td_char">u</td><td class="table_em__td_code">85</td><td class="table_em__td_char">f2</td><td class="table_em__td_code">113</td><td class="table_em__td_char">&nbsp;</td><td class="table_em__td_code">&nbsp;</td></tr></tbody></table></article><article class="article"><a href="http://bakhirev.biz/book/" class="article__link" name="hkZDx"></a><h2 class="article__subtitle">Таблицы соответствия размеров в EM и PX</h2><p class="article__comment">Таблица №2. Соответствие размеров в EM и PX при font-size = 100% (1em = 16px).</p><table class="table_em"><thead class="table_em__tr__grey"><tr><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td></tr></thead><tbody><tr class="table_em__tr"><td class="table_em__td_em">0.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">8 <span class="table_em__comment">px</span></td><td class="table_em__td_em">10.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">168 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">328 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">488 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">648 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">808 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">16 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">176 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">336 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">496 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">656 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">816 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">24 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">184 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">344 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">504 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">664 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">824 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">32 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">192 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">352 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">512 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">672 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">832 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">40 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">200 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">360 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">520 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">680 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">840 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">48 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">208 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">368 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">528 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">688 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">848 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">56 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">216 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">376 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">536 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">696 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">856 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">64 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">224 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">384 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">544 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">704 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">864 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">72 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">232 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">392 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">552 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">712 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">872 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">80 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">240 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">400 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">560 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">720 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">880 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">88 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">248 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">408 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">568 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">728 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">888 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">96 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">256 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">416 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">576 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">736 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">896 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">104 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">264 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">424 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">584 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">744 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">904 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">112 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">272 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">432 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">592 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">752 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">912 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">120 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">280 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">440 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">600 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">760 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">920 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">128 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">288 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">448 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">608 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">768 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">928 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">136 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">296 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">456 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">616 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">776 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">936 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">144 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">304 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">464 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">624 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">784 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">944 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">152 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">312 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">472 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">632 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">792 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">952 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">10.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">160 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">320 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">480 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">640 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">800 <span class="table_em__comment">px</span></td><td class="table_em__td_em">60.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">960 <span class="table_em__comment">px</span></td></tr></tbody></table><p class="article__comment">Таблица №3. Соответствие размеров в EM и PX при font-size = 87.5% (1em = 14px).</p><table class="table_em"><thead class="table_em__tr__grey"><tr><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td></tr></thead><tbody><tr class="table_em__tr"><td class="table_em__td_em">0.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">7 <span class="table_em__comment">px</span></td><td class="table_em__td_em">10.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">147 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">287 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">427 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">567 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">707 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">14 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">154 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">294 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">434 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">574 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">714 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">21 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">161 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">301 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">441 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">581 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">721 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">28 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">168 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">308 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">448 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">588 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">728 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">35 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">175 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">315 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">455 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">595 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">735 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">42 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">182 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">322 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">462 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">602 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">742 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">49 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">189 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">329 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">469 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">609 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">749 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">56 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">196 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">336 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">476 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">616 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">756 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">63 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">203 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">343 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">483 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">623 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">763 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">70 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">210 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">350 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">490 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">630 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">770 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">77 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">217 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">357 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">497 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">637 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">777 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">84 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">224 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">364 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">504 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">644 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">784 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">91 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">231 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">371 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">511 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">651 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">791 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">98 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">238 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">378 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">518 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">658 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">798 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">105 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">245 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">385 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">525 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">665 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">805 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">112 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">252 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">392 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">532 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">672 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">812 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">119 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">259 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">399 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">539 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">679 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">819 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">126 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">266 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">406 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">546 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">686 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">826 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">133 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">273 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">413 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">553 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">693 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">833 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">10.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">140 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">280 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">420 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">560 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">700 <span class="table_em__comment">px</span></td><td class="table_em__td_em">60.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">840 <span class="table_em__comment">px</span></td></tr></tbody></table><p class="article__comment">Таблица №4. Соответствие размеров в EM и PX при font-size = 75% (1em = 12px).</p><table class="table_em"><thead class="table_em__tr__grey"><tr><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td></tr></thead><tbody><tr class="table_em__tr"><td class="table_em__td_em">0.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">6 <span class="table_em__comment">px</span></td><td class="table_em__td_em">10.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">126 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">246 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">366 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">486 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">606 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">12 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">132 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">252 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">372 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">492 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">612 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">18 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">138 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">258 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">378 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">498 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">618 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">24 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">144 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">264 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">384 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">504 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">624 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">30 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">150 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">270 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">390 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">510 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">630 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">36 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">156 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">276 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">396 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">516 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">636 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">42 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">162 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">282 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">402 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">522 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">642 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">48 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">168 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">288 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">408 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">528 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">648 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">54 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">174 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">294 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">414 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">534 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">654 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">60 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">180 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">300 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">420 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">540 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">660 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">66 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">186 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">306 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">426 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">546 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">666 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">72 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">192 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">312 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">432 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">552 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">672 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">78 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">198 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">318 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">438 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">558 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">678 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">84 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">204 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">324 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">444 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">564 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">684 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">90 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">210 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">330 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">450 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">570 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">690 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">96 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">216 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">336 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">456 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">576 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">696 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">102 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">222 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">342 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">462 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">582 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">702 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">108 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">228 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">348 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">468 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">588 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">708 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">114 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">234 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">354 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">474 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">594 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">714 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">10.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">120 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">240 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">360 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">480 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">600 <span class="table_em__comment">px</span></td><td class="table_em__td_em">60.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">720 <span class="table_em__comment">px</span></td></tr></tbody></table><p class="article__comment">Таблица №5. Соответствие размеров в EM и PX при font-size = 62.5% (1em = 10px).</p><table class="table_em"><thead class="table_em__tr__grey"><tr><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td><td class="table_em__head_td_em">EM</td><td class="table_em__head_td_px">PX</td></tr></thead><tbody><tr class="table_em__tr"><td class="table_em__td_em">0.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">5 <span class="table_em__comment">px</span></td><td class="table_em__td_em">10.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">105 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">205 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">305 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">405 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">505 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">10 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">110 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">210 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">310 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">410 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">510 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">1.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">15 <span class="table_em__comment">px</span></td><td class="table_em__td_em">11.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">115 <span class="table_em__comment">px</span></td><td class="table_em__td_em">21.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">215 <span class="table_em__comment">px</span></td><td class="table_em__td_em">31.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">315 <span class="table_em__comment">px</span></td><td class="table_em__td_em">41.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">415 <span class="table_em__comment">px</span></td><td class="table_em__td_em">51.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">515 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">20 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">120 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">220 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">320 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">420 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">520 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">2.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">25 <span class="table_em__comment">px</span></td><td class="table_em__td_em">12.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">125 <span class="table_em__comment">px</span></td><td class="table_em__td_em">22.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">225 <span class="table_em__comment">px</span></td><td class="table_em__td_em">32.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">325 <span class="table_em__comment">px</span></td><td class="table_em__td_em">42.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">425 <span class="table_em__comment">px</span></td><td class="table_em__td_em">52.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">525 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">30 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">130 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">230 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">330 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">430 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">530 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">3.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">35 <span class="table_em__comment">px</span></td><td class="table_em__td_em">13.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">135 <span class="table_em__comment">px</span></td><td class="table_em__td_em">23.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">235 <span class="table_em__comment">px</span></td><td class="table_em__td_em">33.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">335 <span class="table_em__comment">px</span></td><td class="table_em__td_em">43.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">435 <span class="table_em__comment">px</span></td><td class="table_em__td_em">53.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">535 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">40 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">140 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">240 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">340 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">440 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">540 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">4.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">45 <span class="table_em__comment">px</span></td><td class="table_em__td_em">14.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">145 <span class="table_em__comment">px</span></td><td class="table_em__td_em">24.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">245 <span class="table_em__comment">px</span></td><td class="table_em__td_em">34.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">345 <span class="table_em__comment">px</span></td><td class="table_em__td_em">44.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">445 <span class="table_em__comment">px</span></td><td class="table_em__td_em">54.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">545 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">50 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">150 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">250 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">350 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">450 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">550 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">5.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">55 <span class="table_em__comment">px</span></td><td class="table_em__td_em">15.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">155 <span class="table_em__comment">px</span></td><td class="table_em__td_em">25.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">255 <span class="table_em__comment">px</span></td><td class="table_em__td_em">35.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">355 <span class="table_em__comment">px</span></td><td class="table_em__td_em">45.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">455 <span class="table_em__comment">px</span></td><td class="table_em__td_em">55.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">555 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">60 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">160 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">260 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">360 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">460 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">560 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">6.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">65 <span class="table_em__comment">px</span></td><td class="table_em__td_em">16.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">165 <span class="table_em__comment">px</span></td><td class="table_em__td_em">26.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">265 <span class="table_em__comment">px</span></td><td class="table_em__td_em">36.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">365 <span class="table_em__comment">px</span></td><td class="table_em__td_em">46.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">465 <span class="table_em__comment">px</span></td><td class="table_em__td_em">56.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">565 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">70 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">170 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">270 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">370 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">470 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">570 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">7.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">75 <span class="table_em__comment">px</span></td><td class="table_em__td_em">17.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">175 <span class="table_em__comment">px</span></td><td class="table_em__td_em">27.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">275 <span class="table_em__comment">px</span></td><td class="table_em__td_em">37.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">375 <span class="table_em__comment">px</span></td><td class="table_em__td_em">47.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">475 <span class="table_em__comment">px</span></td><td class="table_em__td_em">57.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">575 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">80 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">180 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">280 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">380 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">480 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">580 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">8.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">85 <span class="table_em__comment">px</span></td><td class="table_em__td_em">18.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">185 <span class="table_em__comment">px</span></td><td class="table_em__td_em">28.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">285 <span class="table_em__comment">px</span></td><td class="table_em__td_em">38.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">385 <span class="table_em__comment">px</span></td><td class="table_em__td_em">48.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">485 <span class="table_em__comment">px</span></td><td class="table_em__td_em">58.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">585 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">90 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">190 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">290 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">390 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">490 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">590 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">9.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">95 <span class="table_em__comment">px</span></td><td class="table_em__td_em">19.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">195 <span class="table_em__comment">px</span></td><td class="table_em__td_em">29.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">295 <span class="table_em__comment">px</span></td><td class="table_em__td_em">39.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">395 <span class="table_em__comment">px</span></td><td class="table_em__td_em">49.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">495 <span class="table_em__comment">px</span></td><td class="table_em__td_em">59.5 <span class="table_em__comment">em</span></td><td class="table_em__td_px">595 <span class="table_em__comment">px</span></td></tr><tr class="table_em__tr"><td class="table_em__td_em">10.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">100 <span class="table_em__comment">px</span></td><td class="table_em__td_em">20.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">200 <span class="table_em__comment">px</span></td><td class="table_em__td_em">30.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">300 <span class="table_em__comment">px</span></td><td class="table_em__td_em">40.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">400 <span class="table_em__comment">px</span></td><td class="table_em__td_em">50.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">500 <span class="table_em__comment">px</span></td><td class="table_em__td_em">60.0 <span class="table_em__comment">em</span></td><td class="table_em__td_px">600 <span class="table_em__comment">px</span></td></tr></tbody></table></article></main>
<footer class="report__footer"><p class="report__signature"> Книга: «Сюрреализм на JavaScript»<br> Автор: Бахирев Алексей Михайлович<br> СИНЭЛ, Санкт-Петербург, 2014 год<br> ISBN: 978-5-9905660-7-1<br> ББК: 32.973.26-018.2<br> УДК: 004.432.42<br><br> Сайт: <a class="report__link" href="http://bakhirev.biz/">http://bakhirev.biz</a><br> Почта: <a class="report__link" href="mailto:alexey-bakhirev@yandex.ru">alexey-bakhirev@yandex.ru</a><br> Habrahabr: <a class="report__link" href="http://habrahabr.ru/users/bakhirev/">http://habrahabr.ru/users/bakhirev/</a><br> Linkedin: <a class="report__link" href="http://ru.linkedin.com/pub/alexey-bakhirev/89/838/7b0/">http://ru.linkedin.com/pub/alexey-bakhirev/89/838/7b0/</a></p></footer><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function () { try { w.yaCounter25799507 = new Ya.Metrika({id: 25799507, accurateTrackBounce: true}); } catch (e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }})(document, window, "yandex_metrika_callbacks");</script><noscript>&lt;div&gt;&lt;img src="//mc.yandex.ru/watch/25799507" style="position:absolute; left:-9999px;" alt=""/&gt;&lt;/div&gt;</noscript><script>!function(a){a=a||{},a.StalinGrad=a.StalinGrad||{},a.StalinGrad.module=a.StalinGrad.module||{};var b=[],c={is:{android:navigator.userAgent.toLowerCase().indexOf("android")>-1,operamini:navigator.userAgent.toLowerCase().indexOf("opera mini")>-1,ie:navigator.userAgent.toLowerCase().indexOf("msie")>-1,bada:navigator.userAgent.search(/Bada/)>0},addEvent:function(b,d,e,f){if(!b)return!1;var g=this,h=f?function(){e.call(f,arguments)}:e;b.addEventListener?g.is.android&&"click"==d?(g.addEvent(b,"touchstart",function(a){c.stopEvent(a),h(a)}),g.addEvent(b,"touchmove",g.stopEvent),g.addEvent(b,"touchend",g.stopEvent)):b.addEventListener(d,h,!1):b.attachEvent&&b.attachEvent("on"+d,h),a.test&&a.test.addFunction&&a.test.addFunction(h,d,b)},ready:function(a){b.push(a)},stopEvent:function(a){return a?(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,void(a.preventDefault&&a.preventDefault())):!1},event:{_events:{},listen:function(b,c){var d=this;return"string"!=typeof b?!1:(d._events[b]||(d._events[b]=[]),d._events[b].push(c),void(a.test&&a.test.addFunction&&a.test.addFunction(c,b)))},trigger:function(a,b){if("string"!=typeof a)return!1;var c=this._events[a];if(!c)return!1;for(var d=0,e=c.length;e>d;d++)try{c[d](b)}catch(f){}}},display:{width:function(){return window.innerWidth?windowWidth=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?windowWidth=document.documentElement.clientWidth:document.body.clientWidth&&(windowWidth=document.body.clientWidth),windowWidth},height:function(){return window.innerHeight?windowHeight=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?windowHeight=document.documentElement.clientHeight:document.body.clientHeight&&(windowHeight=document.body.clientHeight),windowHeight}},hasInArrayObjects:function(a,b,c){if(!a)return!1;for(var d=!1,e=0,f=a.length;f>e;e++)c==a[e][b]&&(d=e);return d},random:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},shuffle:function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},objectToArray:function(a){var b=[];for(var c in a)b.push(a[c]);return b},randomKey:function(){for(var a=5,b="",d="QWERTYUIOPLKJHGFDSAZXCVBNMqwertyuiopasdfghjklzxcvbnm".split(""),e=0,f=d.length;a>e;e++){var g=c.random(0,f-1);b+=d[g]}return b},inherit:function(a,b){var c=!1;for(c in b)a[c]=b[c],a[c]&&a[c]._parent&&(a[c]._parent=a)},console:function(a){console.log(a)},JSONP:function(a){function b(b,g){function h(){try{delete a[i]}catch(b){a[i]=null}f.removeChild(j),g.apply(this,arguments)}var i=d+c++,j=e.createElement("script");a[i]=h,j.addEventListener("error",function(){try{throw"error loaded jsonp script"}catch(a){f.removeChild(j);try{g.apply(this)}catch(a){}}});try{var k="?"==b[b.length-1]?"":"&"}catch(l){var k="&"}b+=k+"lang=ru&rand="+Math.random()+"&jsoncallback",f.insertBefore(j,f.lastChild).src=b+"="+i}var c=0,d="__JSONP__",e=a.document,f=e.documentElement;return b}(this)},d=!1,e=function(){if(d)return!1;d=!0;for(var a=0,c=b.length;c>a;a++)try{b[a]&&b[a]()}catch(e){}b=null};document.body&&(document.body.onload=e),c.addEvent(document,"DOMContentLoaded",e,!1),a.StalinGrad.utils=c}(this),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{};var b=a.StalinGrad.utils,c={_node:null,_timer:null,_isShow:!1,_createNode:function(){var a=document.createElement("DIV");a.className="button_scroll_up__hidden";var b=document.createElement("IMG");b.setAttribute("src","data:image/gif;base64,R0lGODlhDgAHAPEAAAAAAEVojgAAAAAAACH5BAEAAAIALAAAAAAOAAcAAAgfAAUIHBggwMCDBwsWRJhQ4UKGDh0ijBiRIMWKFy8GBAA7"),a.appendChild(b),document.body.appendChild(a),this._node=a},_setEvent:function(){var a=this;b.addEvent(a._node,"click",function(){window.scrollTo(0,0)}),b.addEvent(document,"scroll",function(){clearInterval(a._timer),a._timer=setTimeout(function(){a._inspect()},200)})},_inspect:function(){var a=this,b=a._getScroll();b.scroll>.4*b.height&&!a._isShow?(a._isShow=!0,a._show()):b.scroll<.4*b.height&&a._isShow&&(a._isShow=!1,a._hide())},_getScroll:function(){var a=document,b=window,c=a.documentElement,d=a.body;return{scroll:b.pageYOffset||c.scrollTop||d.scrollTop,height:c.clientHeight}},_show:function(){var a=this._node;a&&(a.className="button_scroll_up")},_hide:function(){var a=this._node;a&&(a.className="button_scroll_up__hidden")},init:function(){var a=this;a._createNode(),a._node&&a._setEvent()}};b.ready(function(){c.init()})}(this),function(a){a=a||window,a.StalinGrad=a.StalinGrad||{},a=a.StalinGrad;var b=a.utils,c={_html:{_style:{prefix:{},postfix:{}},_active:{prefix:[],postfix:[],index:{prefix:0,postfix:0}},_callback:null,_setStyle:function(a,b){var c=this._active,d=this._style[b]||null,e=c.prefix[c.index.prefix-1]||"",f=c.postfix[c.index.postfix-1]||"";d&&(a.className=e+d+f)},_setStyleFix:function(a,b){var c=this._style[b][a],d=this._active;c&&(d[b].push(c),d.index[b]++)},_removeStyleFix:function(a,b){var c=this._style[b][a],d=this._active;c&&(d[b].pop(c),d.index[b]--)},property:{className:"class"},createTag:function(a){return document.createElement(a||"div")},setAttribute:function(a,b,c){c instanceof Array&&(c=c.join(" ")),b=this.property[b]||b,a.setAttribute(b,c)},render:function(a,b){for(var c=this,d="",e=0,f=b.length;f>e;e++){var g=b[e],h=0,i=null;if("string"==typeof g){d=g.replace(/(\&mdash\;)/gim,"—"),d=d.replace(/(\&laquo\;)/gim,"«"),d=d.replace(/(\&raquo\;)/gim,"»");var j=document.createTextNode(d);a.appendChild(j)}else{c._callback(g);for(var k in g)d=g[k],c._setStyleFix(k,"prefix"),c._setStyleFix(k,"postfix"),0==h?(i=c.createTag(k),a.appendChild(i),"string"==typeof d?("IMG"==k.toUpperCase()?c.setAttribute(i,"src",d):i.innerHTML=d,"A"==k.toUpperCase()&&c.setAttribute(i,"href",d)):d instanceof Array?"PRE"==k.toUpperCase()?i.innerHTML=d.join("\r\n"):c.render(i,d):d&&c.render(i,d)):c.setAttribute(i,k,d),c._setStyle(i,k),h++,c._removeStyleFix(k,"prefix"),c._removeStyleFix(k,"postfix")}}}},render:function(a){var b=this,c=document.getElementById(a.id)||document.body||!1;return c?("object"==typeof a.style&&(b._html._style=a.style,b._html._style.prefix=a.style.prefix||{},b._html._style.postfix=a.style.postfix||{}),"function"==typeof a.callback&&(b._html._callback=a.callback),void b._html.render(c,a.content)):!1}};b.event.listen("templating",function(a){a&&c.render(a)})}(window),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{};var b=a.StalinGrad.utils||{},c={_images:null,_scroll:{timer:null,value:null},_isNeedUpdateOffset:!1,_addImage:function(a,c){var d=this,e={id:b.randomKey(),isShow:!1,node:a,url:c,type:a.getAttribute("data-type")||!1,offset:a.offsetTop};d._images.push(e),b.addEvent(a,"click",function(){d._loadAndShowImage(e),d._clearImages()})},_loadAndShowImage:function(a){var b=this,c=new Image;c.src=a.url,c.onload=function(){a.node.setAttribute("src",a.url),b._isNeedUpdateOffset=!0},a.isShow=!0},_showImages:function(){for(var a=this,b=0,c=a._images.length;c>b;b++){var d=a._images[b];if(a._isNeedUpdateOffset&&(d.offset=d.node.offsetTop),!d.isShow&&d.offset>a._scroll.value)return!1;a._loadAndShowImage(d)}a._isNeedUpdateOffset=!1},_clearImages:function(){for(var a=this,b=0,c=a._images.length;c>b;b++)a._images[b]&&a._images[b].isShow&&(a._images.splice(b,1),b--)},_getHeightVisiblePart:function(){var a=window,b=document.documentElement,c="scrollTop",d=a.pageYOffset?a.pageYOffset:b[c]?b[c]:document.body[c],e=1.5*b.clientHeight;return Math.floor(d+e)},_checkScrollValue:function(){var a=this,b=a._getHeightVisiblePart();return b<=a._scroll.value?!1:(a._scroll.value=b,a._showImages(),void a._clearImages())},_clearTimer:function(){clearInterval(this._scroll.timer)},_setInspectScroll:function(){var a=this;a._clearTimer(),a._scroll.timer=setInterval(function(){a._checkScrollValue(),a._images.length||a._clearTimer()},500)},_setEvents:function(){var a=this;b.event.listen("lazy_loading_images__update",function(b){a.update(b),a._setInspectScroll()}),b.event.listen("lazy_loading_images__clear",function(){a._clearTimer()})},update:function(a){var b=this;b._images=[];for(var c=0,d=document.images.length;d>c;c++){var e=document.images[c],f=e.getAttribute("src"),g=e.getAttribute("data-url");!g||a&&a!=f||b._addImage(e,g)}},init:function(){var a=this;a.update(),a._setEvents(),a._setInspectScroll()}};b.ready(function(){c.init()})}(this),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{};var b=a.StalinGrad.utils||{},c={_oldValue:0,_getScroll:function(){var a=window,b=document.documentElement,c="scrollTop";return a.pageYOffset?a.pageYOffset:b[c]?b[c]:document.body[c]},checkUpdate:function(){var a=this,c=a._getScroll();return a._oldValue==c?!1:(a._oldValue=c,void b.event.trigger("scroll__update",c))},_setUpdate:function(){var a=this;setInterval(function(){a.checkUpdate()},1e3)},_setEvent:function(){var a=this;b.event.listen("scroll__set",function(a){window.scrollTo(0,a||0)}),b.event.listen("scroll__get",function(){b.event.trigger("scroll__update",a._getScroll())})},init:function(){var a=this;a._setUpdate(),a._setEvent()}};b.ready(function(){c.init()}),a.test&&a.test.add&&a.test.add(c)}(this),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{},a.StalinGrad.module=a.StalinGrad.module||{};var b=(a.StalinGrad.utils||{},{_prefix:"",_storage:{save:{localStorage:"setItem",API:"save"},load:{localStorage:"getItem",API:"load"}},_setItem:function(b,c){var d=this._storage.save;for(var e in d)a[e]&&a[e][d[e]]&&a[e][d[e]](b,c)},_getItem:function(b,c){var d=this._storage.load,c=null;for(var e in d)a[e]&&a[e][d[e]]&&(c=a[e][d[e]](b));return this._getObject(c)},_getObject:function(b){try{if(a.JSON&&a.JSON.parse)return a.JSON.parse(b)}catch(c){}return b},_getString:function(b){var c=typeof b;if("object"==c&&a.JSON&&a.JSON.stringify)try{b=a.JSON.stringify(b)}catch(d){}return"string"==c?b:b.toString?b.toString():""},load:function(a){return"string"!=typeof a?!1:this._getItem(this._prefix+a)},save:function(a,b){return"string"!=typeof a?!1:this._setItem(this._prefix+a,this._getString(b))}});a.StalinGrad.module.memory={save:function(a,c){return b.save(a,c)},load:function(a){return b.load(a)}}}(this),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{};var b=a.StalinGrad.utils||{},c=a.StalinGrad.module,d={scroll:function(){setTimeout(function(){window.location.hash||b.event.trigger("scroll__set",c.memory.load("position_scroll")),b.event.listen("scroll__update",function(a){c.memory.save("position_scroll",a)})},500)}};b.ready(function(){d.scroll()})}(this),function(a){"use strict";a=a||{},a.StalinGrad=a.StalinGrad||{};var b=a.StalinGrad.utils,c=function(){var a=document.body.style,c=b.display.height(),d=a.minHeight;a.minHeight=c+100+"px",setTimeout(function(){scrollTo(0,1),a.minHeight=d||"0px"},300)};b.is.android&&c()}(this);</script><div class="button_scroll_up__hidden"><img src="data:image/gif;base64,R0lGODlhDgAHAPEAAAAAAEVojgAAAAAAACH5BAEAAAIALAAAAAAOAAcAAAgfAAUIHBggwMCDBwsWRJhQ4UKGDh0ijBiRIMWKFy8GBAA7"></div></body></html>
