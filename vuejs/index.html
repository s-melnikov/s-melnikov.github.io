<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LiveCodding</title>
  <style>
    * {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
    }
    body {
      margin: 0;
      padding: 0;
    }
    #editor, #result {
      height: 100%;
      float: left;
    }
    #result {
      border: none;
    }
    #editor {
      font: 12px/1.2 Consolas, Monaco, Menlo, 'Ubuntu Mono', monospace;
    }
    #result {
      right: 0;
    }
    .split {
      overflow-y: auto;
      overflow-x: hidden;
    }
    .gutter {
      background-color: #eee;
      background-repeat: no-repeat;
      background-position: 50%;
    }
    .gutter.gutter-horizontal {
      background-image: url('assets/vertical.png');
      cursor: ew-resize;
    }
    .gutter.gutter-vertical {
      background-image: url('assets/horizontal.png');
      cursor: ns-resize;
    }
    .split, .gutter.gutter-horizontal {
      height: 100%;
      float: left;
    }
  </style>
</head>
<body>
  <div id="editor"></div>
  <iframe id="result"></iframe>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js"></script>
  <script src='assets/split.min.js'></script>
  <script>
    function init() {
      var
        editor = ace.edit(document.querySelector('#editor')),
        doc = editor.getSession(),
        result = document.querySelector('#result'),
        hash = location.hash.slice(1)
      editor.$blockScrolling = Infinity
      editor.setTheme('ace/theme/chrome')
      doc.setMode('ace/mode/html')
      doc.setTabSize(2)
      editor.session.setUseWorker(false)
      if (hash) {
        var val = atob(hash)
        doc.setValue(val)
        result.srcdoc = val
      } else {
        get('assets/default.html', function(r) {
          doc.setValue(r)
        })
      }
      doc.on('change', function() {
        var val = doc.getValue()
        result.srcdoc = val
        location.hash = btoa(val)
      })
      function get(url, cb) {
        var r = new XMLHttpRequest()
        r.open('GET', url, true)
        r.onreadystatechange  = function() {
          if (r.status == 200) cb(r.response)
        }
        r.send()
      }
      Split(["#editor", "#result"], {
        sizes: [50, 50],
        minSize: 200
      })
    }
    document.addEventListener('DOMContentLoaded', init)
  </script>
</body>
</html>