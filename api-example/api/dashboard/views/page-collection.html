<page-collection>

  <div class="page-header">
    <h2>Collection</h2>
  </div>

  <ul class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="#">Home</a>
    </li>
    <li class="breadcrumb-item">
      <a href="#collections">Collection</a>
    </li>
    <li class="breadcrumb-item">
      <a href="#collections">{ collection.title }</a>
    </li>
  </ul>

  <div class="columns">
    <div class="column col-9">
      <div class="panel">
        <div class="panel-header"></div>
        <div class="panel-nav"></div>
        <div class="panel-body">
          <div class="text-right">
            <div class="columns">
              <div class="column col-6"></div>
              <div class="column col-6">
                <button class="btn col-3" onclick={ showAddFieldModal }>New field</button>
                <button class="btn col-3">Edit</button>
                <button class="btn col-3">Delete</button>
              </div>
            </div>
          </div>
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Title</th>
                <th>Name</th>
                <th>Type</th>
                <th></th>
              </tr>
            </thead>
            <tbody if={ collection }>
              <tr each={ collection.fields }>
                <td>{ title }</td>
                <td>{ name }</td>
                <td>{ type }</td>
                <td class="text-right">
                  <span>action</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="panel-footer"></div>
      </div>
    </div>
  </div>

  <div class="modal active modal-add-field" if={ isAddFieldModalShowed }>
    <div class="modal-overlay"></div>
    <form class="modal-container" onsubmit={ addFieldModalSubmit }>
      <div class="modal-header">
        <span class="btn btn-clear float-right" onclick={ hideAddFieldModal }></span>
        <div class="modal-title">Add field</div>
      </div>
      <div class="modal-body">
        <div class="content">
          <div class="form-group">
            <label>Field title</label>
            <input class="form-input" type="text" name="title" required>
          </div>
          <div class="form-group">
            <label>Field name</label>
            <input class="form-input" type="text" name="name" required>
          </div>
          <div class="form-group">
            <label>Field type</label>
            <select class="form-select" name="type">
              <option value="string">String</option>
              <option value="text">Text</option>
              <option value="number">Number</option>
              <option value="datetime">Date/Time</option>
              <option value="media">Media</option>
              <option value="boolean">Boolean</option>
              <option value="reference">Reference</option>
            </select>
          </div>
          <div class="form-group">
            <label>Default value</label>
            <input class="form-input" type="text" name="default">
          </div>
          <div class="form-group">
            <label class="form-checkbox is-error">
              <input type="checkbox" name="required">
              <i class="form-icon"></i> Required
            </label>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea name="description" class="form-input" rows="3"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <span class="btn btn-link btn-close" onclick={ hideAddFieldModal }>Close</span>
        <button class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>

  <div class="modal" id="edit-collection">
    <div class="modal-overlay"></div>
    <form class="modal-container" style="width:420px" method="post">
      <div class="modal-header">
        <a href="#" class="btn btn-clear float-right"></a>
        <div class="modal-title">Edit collection</div>
      </div>
      <div class="modal-body">
        <div class="content">
          <div class="form-group">
            <label>Field name</label>
            <input class="form-input" type="text" name="name"
              value="<?php print $collection['name'] ?>" required>
          </div>
          <div class="form-group">
            <label>Field type</label>
            <textarea class="form-input" name="description" rows="6"
              maxlength="500"><?php print $collection['description'] ?></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#" class="btn btn-link btn-close">Close</a>
        <button class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>

  <div class="modal" id="delete-collection">
    <div class="modal-overlay"></div>
    <form class="modal-container" style="width:420px" method="post">
      <div class="modal-header">
        <a href="#" class="btn btn-clear float-right"></a>
        <div class="modal-title">Delete collection</div>
      </div>
      <div class="modal-body">
        <div class="content text-center">
          <p>Are you <strong>ABSOLUTELY</strong> sure?</p>
          <p>This action <strong>CANNOT</strong> be undone.
            This will permanently delete the
            "<strong><?php print $collection['name'] ?></strong>" collection.</p>
          <p>Please type in the name of the repository to confirm.</p>
          <div class="form-group">
            <input class="form-input" type="text" name="to_delete" required>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-block" disabled>
          I understand the consequences, delete this collection
        </button>
      </div>
    </form>
  </div>

  <script>
    var self = this
    self.collection = {}

    showAddFieldModal() {
      self.isAddFieldModalShowed = true
    }

    hideAddFieldModal() {
      self.isAddFieldModalShowed = false
    }

    addFieldModalSubmit(e) {
      e.preventDefault()
      var data = getFormData(e.target)
      data.required = !!data.required
      data.uid = pushId()
      console.log("!", self.collection.fields[0])
      console.log("!!", data)
      // self.collection.field.push(data)
      // api.collections().update()
    }

    self.on("mount", () => {
      api.collection(opts.id).get().then(resp => {
        self.collection = resp.collection
        self.update()
      })
    })
  </script>
</page-collection>