<page-collections>

  <h2>Collections</h2>

  <div class="columns">
    <div class="column col-10">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Identifier</th>
            <th class="text-right">Updated</th>
            <th class="text-right">About</th>
          </tr>
        </thead>
        <tbody>
          <tr each={ collections }>
            <td><a href="#/collection/{ uid }/fields">{ title }</a></td>
            <td>{ name }</td>
            <td class="text-right">{ (new Date(updated)).toDateString() }</td>
            <td class="text-right">{ about.nickname }</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="divider-vert"></div>
    <div class="column">
      <div class="text-center pt-10">
        <span class="btn" onclick={ showModal }>New collection</span>
      </div>
    </div>
  </div>

  <div class="modal modal-add-collection active" show={ modalShowed }>
    <div class="modal-overlay"></div>
    <div class="modal-container">
      <div class="modal-header">
        <span class="btn btn-clear float-right"></span>
        <div class="modal-title">New collection</div>
      </div>
      <div class="modal-body">
        <div class="content">
          <div class={ "form-group": true, "has-error": formErrors.title }>
            <label>Title</label>
            <input class="form-input" type="text" ref="title">
          </div>
          <div class={ "form-group": true, "has-error": formErrors.name }>
            <label>Slug</label>
            <input class="form-input" type="text" ref="name">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea class="form-input" ref="description" rows="6" maxlength="500"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <span class="btn btn-link btn-close" onclick={ closeModal }>Close</span>
        <button class="btn btn-primary" onclick={ submitModal }>Submit</button>
      </div>
    </div>
  </div>

  <script>

    var self = this
    self.formErrors = {}

    showModal() {
      self.modalShowed = true
    }

    closeModal() {
      self.modalShowed = false
    }

    submitModal() {
      let title = self.refs.title.value
      let name = self.refs.name.value
      let description = self.refs.description.value;
      self.formErrors = {
        title: !title,
        name: !name,
        description: !description,
      }
      if (!title || !name || !description) {
        return
      }
    }

    self.on("mount", () => {
      api.get("collections").then(data => {
        self.collections = data.collections
        self.update()
      })
    })

    /*var input = $('[name=name]'),
      output = $('[name=id]')
    if (!output.val()) {
      input.on('input', function() {
        output.val(slugify(translit(this.value)))
      })
      output.on('input', function() {
        input.off('input')
        output.off('input')
      })
    }
    if ("<?php print $id ?>") {
      location.hash = "#add-collection"
    } else {
      location.hash = "#"
    }*/
  </script>
</page-collections>

