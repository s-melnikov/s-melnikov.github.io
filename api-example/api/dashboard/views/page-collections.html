<page-collections>

  <h2>Collections</h2>

  <div class="columns">
    <div class="column col-10">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Identifier</th>
            <th class="text-right">Updated</th>
            <th class="text-right">About</th>
          </tr>
        </thead>
        <tbody>
          <tr each={ collections }>
            <td><a href="#/collection/{ uid }/fields">{ title }</a></td>
            <td>{ name }</td>
            <td class="text-right">{ (new Date(updated)).toDateString() }</td>
            <td class="text-right">{ about.nickname }</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="divider-vert"></div>
    <div class="column">
      <div class="text-center pt-10">
        <span class="btn" onclick={ showModal }>New collection</span>
      </div>
    </div>
  </div>

  <div class="modal modal-add-collection active" show={ modalShowed }>
    <div class="modal-overlay"></div>
    <form class="modal-container" onsubmit={ submitModal }>
      <div class="modal-header">
        <span class="btn btn-clear float-right"></span>
        <div class="modal-title">New collection</div>
      </div>
      <div class="modal-body">
        <div class="content">
          <div class="form-group" required>
            <label>Title</label>
            <input class="form-input" type="text" name="title" required oninput={ onTitleInput }>
          </div>
          <div class="form-group" required>
            <label>Slug</label>
            <input class="form-input" type="text" name="name" ref="name" required oninput={ onNameInput }>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea class="form-input" name="description" rows="6" maxlength="500"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <span class="btn btn-link btn-close" onclick={ closeModal }>Close</span>
        <button class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>

  <script>

    var self = this

    showModal() {
      self.modalShowed = true
    }

    closeModal() {
      self.modalShowed = false
    }

    submitModal(e) {
      e.preventDefault()
      var data = getFormData(e.target)
      api.collections().push(data).then(resp => {
        data.uid = resp.uid
        data.updated = new Date().toDateString()
        self.collections.push(data)
        self.update()
        e.target.reset()
      })
    }

    onTitleInput(e) {
      if (!self.stopListenTitle) {
        self.refs.name.value = slugify(translit(e.target.value))
      }
    }

    onNameInput(e) {
      self.stopListenTitle = true
    }

    self.on("mount", () => {
      api.collections().get().then(resp => {
        self.collections = resp.collections
        self.update()
      })
    })
  </script>
</page-collections>

