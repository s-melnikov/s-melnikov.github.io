<app>

  <div class="main-header" if={ user }>
    <div class="container">
      <div class="navbar">
        <div class="navbar-section">
          <a href="#" class="navbar-brand">Content System</a>
        </div>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <ul class="nav">
      <li class="nav-item">
        <a href="#collections">Collections</a>
      </li>
      <li class="nav-item">
        <a href="#content">Content</a>
      </li>
      <li class="nav-item">
        <a href="#settings">Settings</a>
      </li>
      <li class="nav-item">
        <a href="#logout">Logout</a>
      </li>
    </ul>
  </div>

  <router class="container"></router>

  <div id="alerts">
    <div each={ alerts } class="toast toast-error">
      <button class="btn btn-clear float-right"></button>
      <p>{ text }</p>
    </div>
  </div>

  <script>
    var self = this
    var currentPage
    self.user = null

    route((page, id) => {
      page = page || "index"
      if (self.user) {
        if (page == "signin")
          return route("index")
      } else {
        if (page !== "signin") {
          return route("signin")
        }
      }
      if (page == "logout") {
        api.auth().signout()
        self.user = null
        self.update()
        return route("signin")
      }
      if (currentPage) {
        currentPage.unmount(true)
        currentPage = null
      }
      try {
        currentPage = riot.mount("router", "page-" + page, { id, app: self })[0]
      } catch(e) {}
      if (!currentPage) {
       currentPage = riot.mount("router", "page-404")[0]
      }
    })

    self.on("mount", () => {
      api.auth().status().then(resp => {
        if (resp.user) {
          self.user = resp.user
          self.update()
        }
        route.start(true)
      })
    })
  </script>
</app>