<app>

  <div class="main-header" if={ user }>
    <div class="container">
      <div class="navbar">
        <div class="navbar-section">
          <a href="#" class="navbar-brand">Content System</a>
        </div>
        <div class="navbar-section">
          <a href="#/collections" class="btn btn-link">Collections</a>
          <a href="#/content" class="btn btn-link">Content</a>
          <a href="#/settings" class="btn btn-link">Settings</a>
          <a href="#/logout" class="btn btn-link">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <router class="container"></router>

  <div id="alerts">
    <div each={ alerts } class="toast toast-error">
      <button class="btn btn-clear float-right"></button>
      <p>{ text }</p>
    </div>
  </div>

  <script>
    var self = this
    var pages = []

    self.user = null

    route((page, action, id) => {
      page = page || "index"
      if (!self.user && page !== "signin") {
        route("//signin")
      }
      if (page == "logout") {
        api.auth().signout()
        self.user == null
        route("//signin")
      } else {
        if (self.page) {
          self.page.unmount(true)
          self.page = null
        }
        try {
          self.page = riot.mount("router", "page-" + page, { action, id })[0]
        } catch(e) {}
        if (!self.page) {
          self.page = riot.mount("router", "page-404")[0]
        }
      }
    })

    self.on("mount", () => {
      api.auth().status().then(resp => {
        if (resp.user) {
          self.user = resp.user
          self.update()
        }
        route.start(true)
      })
    })
  </script>
</app>