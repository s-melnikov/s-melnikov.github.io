<app>

  <div class="main-header" if={ user }>
    <div class="container">
      <div class="navbar">
        <div class="navbar-section">
          <a href="#" class="navbar-brand">Content System</a>
        </div>
        <div class="navbar-section">
          <div class="dropdown dropdown-right">
            <div href="#" class="dropdown-toggle c-hand" tabindex="0">
              <figure class="avatar avatar" data-initial={ user.first_name[0] + user.last_name[0] }></figure>
              <i class="icon icon-caret"></i>
            </div>
            <ul class="menu">
              <li class="menu-item">
                <div class="tile tile-centered">
                  <div class="tile-icon">
                    <figure class="avatar avatar" data-initial={ user.first_name[0] + user.last_name[0] }></figure>
                  </div>
                  <div class="tile-content">{ user.first_name } { user.last_name }</div>
                </div>
              </li>
              <li class="divider"></li>
              <li class="menu-item">
                <a href="#profile">Profile</a>
              </li>
              <li class="menu-item">
                <a href="#logout">Logout</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sidebar" if={ user }>
    <ul class="nav">
      <li class="nav-item">
        <a href="#collections">Collections</a>
      </li>
      <li class="nav-item">
        <a href="#content">Content</a>
      </li>
      <li class="nav-item">
        <a href="#settings">Settings</a>
      </li>
      <li class="nav-item">
        <a href="#logout">Logout</a>
      </li>
    </ul>
  </div>

  <router class="container { auth: user }"></router>

  <script>
    var self = this
    var currentPage
    self.user = null

    route((page, id) => {
      page = page || "index"
      if (self.user) {
        if (page == "signin")
          return route("index")
      } else {
        if (page !== "signin") {
          return route("signin")
        }
      }
      if (page == "logout") {
        api.auth().signout()
        self.user = null
        self.update()
        return route("signin")
      }
      if (currentPage) {
        currentPage.unmount(true)
        currentPage = null
      }
      try {
        currentPage = riot.mount("router", "page-" + page, { id, app: self })[0]
      } catch(e) {}
      if (!currentPage) {
       currentPage = riot.mount("router", "page-404")[0]
      }
    })

    self.on("mount", () => {
      api.auth().status().then(resp => {
        if (resp.user) {
          self.user = resp.user
          self.update()
        }
        route.start(true)
      })
    })
  </script>
</app>