<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" href="https://unpkg.com/wingcss@1.0.0-beta/dist/wing.min.css">
  <style></style>
</head>
<body>
  <app></app>
  <script src="https://unpkg.com/riot@3.12.0/riot.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-database.js"></script>

  <script type="text/html" id="app-template">
  </script>
  <script>
    firebase.initializeApp({
      apiKey: 'AIzaSyAYoWsXOGnwLjlzbqR2uokozrDqXQCuuJU',
      databaseURL: 'https://timetracker-2dbde.firebaseio.com'
    });
    let auth = firebase.auth();

    const signIn = email => {
      let { origin, pathname } = location;
      auth
        .sendSignInLinkToEmail(email, {
          url: url,
          handleCodeInApp: true
        })
        .then(() => {
          console.log('signIn() success; link:', origin + pathname);
          localStorage.setItem('emailForSignIn', email);
        })
        .catch(error => console.log('signIn() error:', error.code));
    }

    const signOut = () => {
      firebase.auth().signOut()
        .then(() => console.log('signOut() success'))
        .catch(error => console.log('signOut() error:', error.code));
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        console.log(user)
      }
    });

    if (firebase.auth().isSignInWithEmailLink(location.href)) {
      email = localStorage.getItem('emailForSignIn');
      if (email) {
        firebase.auth().signInWithEmailLink(email, location.href)
        .then(result=> {
          console.log('signInWithEmailLink() success; email:', email)
          localStorage.removeItem('emailForSignIn');
        })
        .catch(function(error) {
          console.log('signInWithEmailLink() error:', error.code)
          alert(error.message)
          location.replace(location.href.replace(location.search, ''))
        });
      } else {
        console.log('error: email for confirmation is empty');
      }
    }


    // auth.signInAnonymously();
    // riot.tag('app', 'Test!!!', function(opts) {
    //   console.log(opts);
    // })
    // riot.mount('*');
  </script>
</body>
</html>